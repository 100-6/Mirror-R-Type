{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"R-Type","text":"<p>A modern, modular game engine for building R-Type and other multiplayer games</p> <p> </p>"},{"location":"#about","title":"About","text":"<p>R-Type is a game engine built from scratch in C++20, designed to recreate the classic R-Type shoot 'em up game with modern architecture and extensibility. The engine features a plugin-based system, allowing developers to swap graphics, audio, and networking implementations seamlessly.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Plugin Architecture - Modular design with hot-swappable plugins for graphics, audio, and networking</li> <li>Multiplayer Ready - Built-in client-server architecture with UDP networking via Boost.Asio</li> <li>Multiple Renderers - Support for Raylib graphics backend (extensible to SFML, SDL, etc.)</li> <li>Audio System - Integrated audio plugin based on MiniAudio</li> <li>Event Bus - Decoupled communication system for game events</li> <li>ECS Architecture - Entity Component System for efficient game object management</li> <li>Cross-Platform - Windows, Linux, and macOS support via vcpkg</li> </ul>"},{"location":"#documentation","title":"Documentation","text":""},{"location":"#getting-started","title":"Getting Started","text":"<ul> <li>Setup Guide - Get started with building and running the project</li> <li>Developer Guide - Contributing guidelines and development workflow</li> </ul>"},{"location":"#architecture","title":"Architecture","text":"<ul> <li>\ud83d\udcda Documentation Hub - Point d'entr\u00e9e de toute la documentation</li> <li>Server Architecture - Architecture d\u00e9taill\u00e9e du serveur</li> <li>Client Architecture - Architecture d\u00e9taill\u00e9e du client</li> </ul>"},{"location":"#game-systems","title":"Game Systems","text":"<ul> <li>Wave System Guide - JSON-based wave spawning system documentation</li> <li>Procedural Generation - Runtime procedural map generation system</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":""},{"location":"#prerequisites","title":"Prerequisites","text":"<ul> <li>CMake 3.20+</li> <li>C++20 compatible compiler (GCC 12+, Clang 15+, or MSVC 2022+)</li> <li>vcpkg (automatically setup by the project)</li> </ul>"},{"location":"#build","title":"Build","text":"<pre><code># Clone vcpkg (first time only)\ngit clone https://github.com/Microsoft/vcpkg.git\ncd vcpkg &amp;&amp; ./bootstrap-vcpkg.sh &amp;&amp; cd ..\n\n# Build the project\ncmake -B build\ncmake --build build\n\n# Run the game\n./build/r_type_client\n./build/r_type_server\n</code></pre> <p>For detailed build instructions, see Setup Guide.</p>"},{"location":"#downloads-releases","title":"Downloads &amp; Releases","text":"<p>Looking for a ready-to-play version? Check out our GitHub Releases page!</p>"},{"location":"#windows-users","title":"Windows Users","text":"<p>Download <code>RType-Setup.exe</code> for an easy installation with shortcuts, or <code>RType-Windows-x64.zip</code> for a portable version.</p>"},{"location":"#for-developers","title":"For Developers","text":"<p>Want to create a release? See the Release Guide for instructions on building Windows installers.</p>"},{"location":"#project-structure","title":"Project Structure","text":"<pre><code>Mirror-R-Type/\n\u251c\u2500\u2500 engine/               # Core engine code\n\u2502   \u251c\u2500\u2500 include/         # Public engine headers\n\u2502   \u251c\u2500\u2500 src/             # Engine implementation\n\u2502   \u251c\u2500\u2500 plugin_manager/  # Plugin loading system\n\u2502   \u2514\u2500\u2500 plugins/         # Official plugins\n\u2502       \u251c\u2500\u2500 graphics/    # Graphics backends (Raylib)\n\u2502       \u251c\u2500\u2500 audio/       # Audio backends (MiniAudio)\n\u2502       \u2514\u2500\u2500 network/     # Network backends (Asio)\n\u251c\u2500\u2500 client/              # Game client application\n\u251c\u2500\u2500 server/              # Game server application\n\u251c\u2500\u2500 tests/               # Unit and integration tests\n\u251c\u2500\u2500 assets/              # Game assets (sprites, sounds, etc.)\n\u2514\u2500\u2500 docs/                # Documentation\n</code></pre>"},{"location":"#plugin-system","title":"Plugin System","text":"<p>The engine uses a dynamic plugin architecture:</p> <ul> <li>Graphics Plugins - Rendering backends (Raylib, SFML, etc.)</li> <li>Audio Plugins - Sound systems (MiniAudio, OpenAL, etc.)</li> <li>Network Plugins - Networking implementations (Asio UDP/TCP, ENet, etc.)</li> <li>Input Plugins - Input handling systems</li> </ul> <p>Create your own plugins by implementing the provided interfaces. See the Plugin Creation Guide.</p>"},{"location":"#gameplay","title":"Gameplay","text":"<p>R-Type is a faithful recreation of the classic shoot 'em up:</p> <ul> <li>Side-scrolling shooter with procedurally generated levels</li> <li>Multiplayer co-op support up to 4 players</li> <li>Power-ups and weapons system</li> <li>Enemy AI with various patterns</li> <li>Boss battles with multiple phases</li> </ul>"},{"location":"#development","title":"Development","text":""},{"location":"#building-from-source","title":"Building from Source","text":"<p>See the detailed Setup Guide for platform-specific instructions.</p>"},{"location":"#contributing","title":"Contributing","text":"<p>We welcome contributions! Please read our Developer Guide and Contributing Guidelines before submitting a PR.</p>"},{"location":"#code-quality","title":"Code Quality","text":"<ul> <li>C++20 modern C++ practices</li> <li>clang-tidy linting (optional, see Developer Guide)</li> <li>Unit tests with Google Test</li> <li>Documentation with inline comments and separate guides</li> </ul>"},{"location":"#networking","title":"Networking","text":"<p>The engine implements a robust client-server architecture:</p> <ul> <li>UDP Protocol for real-time gameplay</li> <li>Client Prediction for responsive controls</li> <li>Server Reconciliation for authoritative gameplay</li> <li>Entity Interpolation for smooth visuals</li> </ul>"},{"location":"#dependencies","title":"Dependencies","text":"<p>All dependencies are managed via vcpkg:</p> <ul> <li>Boost.Asio - Async networking</li> <li>Raylib - Graphics rendering</li> <li>MiniAudio - Audio playback</li> </ul> <p>For system dependencies and development tools, see Setup Guide.</p>"},{"location":"#license","title":"License","text":"<p>This project is part of the EPITECH curriculum.</p>"},{"location":"#authors","title":"Authors","text":"<p>EPITECH Project 2025 - R-Type</p>"},{"location":"#links","title":"Links","text":"<ul> <li>Original R-Type</li> <li>Project Documentation</li> </ul>"},{"location":"ACCESSIBILITY/","title":"Accessibility System Documentation","text":""},{"location":"ACCESSIBILITY/#overview","title":"Overview","text":"<p>The Mirror-R-Type engine includes a built-in accessibility system designed to support players with color vision deficiencies (colorblindness). This feature is implemented as a graphical Post-Processing effect, ensuring that the correction is applied globally to the entire game (sprites, UI, particles, background) without requiring changes to individual assets or game logic.</p>"},{"location":"ACCESSIBILITY/#supported-modes","title":"Supported Modes","text":"<p>The system currently supports the three major types of color blindness:</p> <ol> <li>Protanopia (Red-blind): Simulates/Corrects for missing red cones.</li> <li>Deuteranopia (Green-blind): Simulates/Corrects for missing green cones.</li> <li>Tritanopia (Blue-blind): Simulates/Corrects for missing blue cones.</li> </ol>"},{"location":"ACCESSIBILITY/#technical-architecture","title":"Technical Architecture","text":"<p>The implementation uses a Render-to-Texture approach combined with GLSL Shaders.</p>"},{"location":"ACCESSIBILITY/#1-the-rendering-pipeline","title":"1. The Rendering Pipeline","text":"<p>Instead of drawing directly to the screen's backbuffer, the rendering pipeline is intercepted in the Graphics Plugin layer:</p> <ol> <li>Initialization: A <code>RenderTexture</code> (Framebuffer) is created matching the window dimensions.</li> <li>Drawing Phase:<ul> <li><code>IGraphicsPlugin::clear()</code> redirects rendering target to the <code>RenderTexture</code>.</li> <li>All standard draw calls (<code>draw_sprite</code>, <code>draw_rect</code>, etc.) occur on this texture.</li> </ul> </li> <li>Display Phase:<ul> <li><code>IGraphicsPlugin::display()</code> binds the <code>RenderTexture</code> as the source.</li> <li>The Colorblind Shader is activated.</li> <li>The texture is drawn as a full-screen quad onto the actual screen.</li> <li>The shader modifies pixel colors in real-time during this pass.</li> </ul> </li> </ol>"},{"location":"ACCESSIBILITY/#2-shader-logic","title":"2. Shader Logic","text":"<p>The shader utilizes a color matrix transformation approach. It takes the original RGB color and applies a transformation based on the selected mode.</p> <p>Shader Source (Simplified): <pre><code>uniform int mode; // 0:None, 1:Protanopia, 2:Deuteranopia, 3:Tritanopia\n\nvoid main() {\n    vec4 color = texture(texture0, fragTexCoord);\n\n    if (mode == 1) { // Protanopia\n        // Mix Red and Green channels to simulate red deficiency\n        float r = 0.567 * color.r + 0.433 * color.g;\n        float g = 0.558 * color.r + 0.442 * color.g;\n        float b = 0.242 * color.g + 0.758 * color.b;\n        color.rgb = vec3(r, g, b);\n    }\n    // ... logic for other modes\n}\n</code></pre></p>"},{"location":"ACCESSIBILITY/#integration","title":"Integration","text":""},{"location":"ACCESSIBILITY/#engine-core","title":"Engine Core","text":"<ul> <li><code>CommonTypes.hpp</code>: Defines the <code>enum class ColorBlindMode</code>.</li> <li><code>IGraphicsPlugin.hpp</code>: Exposes the interface <code>virtual void set_colorblind_mode(ColorBlindMode mode) = 0;</code>.</li> </ul>"},{"location":"ACCESSIBILITY/#plugins","title":"Plugins","text":"<p>Both major graphics backends implement this interface: *   Raylib (<code>RaylibGraphicsPlugin</code>): Uses <code>LoadShaderFromMemory</code>, <code>BeginTextureMode</code>, and <code>BeginShaderMode</code>.</p>"},{"location":"ACCESSIBILITY/#client-ui","title":"Client UI","text":"<p>The setting is managed in <code>SettingsScreen.cpp</code> (Display Tab). It toggles the mode, which immediately calls the graphics plugin to update the shader uniform.</p>"},{"location":"ACCESSIBILITY/#how-to-add-new-modes","title":"How to Add New Modes","text":"<ol> <li>Define: Add the new mode to <code>engine::ColorBlindMode</code> in <code>CommonTypes.hpp</code>.</li> <li>Update UI: Add the case to <code>SettingsScreen::update_colorblind_label()</code>.</li> <li>Update Shaders:<ul> <li>Modify <code>RAYLIB_COLORBLIND_SHADER</code> in <code>RaylibGraphicsPlugin.cpp</code>.</li> <li>Add the mathematical logic for the new color transformation.</li> </ul> </li> </ol>"},{"location":"ACCESSIBILITY/#troubleshooting","title":"Troubleshooting","text":"<ul> <li>No Effect: Ensure the correct Graphics Plugin is loaded. Check console logs for \"Shader loaded successfully\".</li> <li>Performance: The shader is lightweight (simple vector multiplication), but on extremely low-end hardware, disabling the mode (Mode 0) skips the shader pass entirely.</li> </ul>"},{"location":"CLIENT_ARCHITECTURE/","title":"R-Type Client Architecture","text":""},{"location":"CLIENT_ARCHITECTURE/#overview","title":"Overview","text":"<p>The R-Type client is a multiplayer graphical application that connects to the game server, displays the game rendering, and sends player inputs.</p>"},{"location":"CLIENT_ARCHITECTURE/#global-architecture","title":"Global Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       main.cpp                              \u2502\n\u2502                    (Entry point)                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     ClientGame                              \u2502\n\u2502              (Game orchestration)                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Texture  \u2502 \u2502 Input   \u2502 \u2502 Screen   \u2502 \u2502    Entity     \u2502 \u2502\n\u2502  \u2502 Manager  \u2502 \u2502 Handler \u2502 \u2502 Manager  \u2502 \u2502   Manager     \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502  \u2502    Status    \u2502 \u2502    Chat    \u2502 \u2502    NetworkClient     \u2502\u2502\n\u2502  \u2502   Overlay    \u2502 \u2502   Overlay  \u2502 \u2502   (Network mgmt)     \u2502\u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502                        \u2502                    \u2502\n          \u25bc                        \u25bc                    \u25bc\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502   Registry    \u2502       \u2502   Plugins    \u2502    \u2502  INetwork     \u2502\n  \u2502     (ECS)     \u2502       \u2502 (Graphics,   \u2502    \u2502   Plugin      \u2502\n  \u2502               \u2502       \u2502  Input, etc) \u2502    \u2502               \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"CLIENT_ARCHITECTURE/#main-components","title":"Main Components","text":""},{"location":"CLIENT_ARCHITECTURE/#1-clientgame-main-class","title":"1. ClientGame (Main Class)","text":"<p>File: <code>src/r-type/client/include/ClientGame.hpp</code></p> <p>Responsibilities: - Orchestration of all game components - Plugin initialization (graphics, input, audio, network) - ECS registry configuration - Game systems setup - Main game loop - Network callback management</p> <p>Key Members: <pre><code>class ClientGame {\nprivate:\n    // Plugins\n    engine::IGraphicsPlugin* graphics_plugin_;\n    engine::IInputPlugin* input_plugin_;\n    engine::IAudioPlugin* audio_plugin_;\n    engine::INetworkPlugin* network_plugin_;\n\n    // ECS\n    std::unique_ptr&lt;Registry&gt; registry_;\n\n    // Game components\n    std::unique_ptr&lt;TextureManager&gt; texture_manager_;\n    std::unique_ptr&lt;ScreenManager&gt; screen_manager_;\n    std::unique_ptr&lt;EntityManager&gt; entity_manager_;\n    std::unique_ptr&lt;StatusOverlay&gt; status_overlay_;\n    std::unique_ptr&lt;InputHandler&gt; input_handler_;\n\n    // Overlays\n    std::unique_ptr&lt;ChatOverlay&gt; chat_overlay_;\n    std::unique_ptr&lt;ConsoleOverlay&gt; console_overlay_;\n\n    // Network\n    std::unique_ptr&lt;NetworkClient&gt; network_client_;\n};\n</code></pre></p> <p>Lifecycle: <pre><code>initialize()\n    \u251c\u2500\u25ba load_plugins()\n    \u251c\u2500\u25ba setup_registry()\n    \u251c\u2500\u25ba setup_systems()\n    \u251c\u2500\u25ba load_textures()\n    \u251c\u2500\u25ba setup_background()\n    \u251c\u2500\u25ba setup_network_callbacks()\n    \u2514\u2500\u25ba connect()\n        \u2193\nrun()  [Main loop]\n    \u251c\u2500\u25ba update(dt)\n    \u251c\u2500\u25ba handle_input()\n    \u251c\u2500\u25ba update_projectiles()\n    \u251c\u2500\u25ba run_systems()\n    \u2514\u2500\u25ba display()\n        \u2193\nshutdown()\n    \u251c\u2500\u25ba disconnect()\n    \u2514\u2500\u25ba cleanup_plugins()\n</code></pre></p>"},{"location":"CLIENT_ARCHITECTURE/#2-texturemanager","title":"2. TextureManager","text":"<p>File: <code>src/r-type/client/include/TextureManager.hpp</code></p> <p>Responsibilities: - Loading all textures at startup - Centralized management of texture handles - Fallbacks for missing textures</p> <p>Managed Textures: - <code>background</code> - Scrolling background - <code>menu_background</code> - Menu background - <code>player_frames[4]</code> - Player animation frames - <code>enemy</code> - Enemy sprites - <code>projectile</code> - Projectile sprites - <code>wall</code> - Obstacle sprites</p> <p>Main Methods: <pre><code>bool load_all();  // Load all textures\nengine::TextureHandle get_background() const;\nengine::TextureHandle get_player_frame(size_t index) const;\n// ... etc\n</code></pre></p>"},{"location":"CLIENT_ARCHITECTURE/#3-inputhandler","title":"3. InputHandler","text":"<p>File: <code>src/r-type/client/include/InputHandler.hpp</code></p> <p>Responsibilities: - Reading player inputs - Conversion to network flags (protocol) - Special key detection</p> <p>Key Mapping: <pre><code>W / Up Arrow    \u2192 INPUT_UP\nS / Down Arrow  \u2192 INPUT_DOWN\nA / Left Arrow  \u2192 INPUT_LEFT\nD / Right Arrow \u2192 INPUT_RIGHT\nSpace           \u2192 INPUT_SHOOT\nShift           \u2192 INPUT_CHARGE\nCtrl            \u2192 INPUT_SPECIAL\nE               \u2192 INPUT_SWITCH_WEAPON\nT               \u2192 Open chat\nF1              \u2192 Close chat\nTab             \u2192 Open admin console\nEscape          \u2192 Quit game\n</code></pre></p> <p>Usage: <pre><code>uint16_t flags = input_handler_-&gt;gather_input();\nnetwork_client_-&gt;send_input(flags, client_tick_);\n</code></pre></p>"},{"location":"CLIENT_ARCHITECTURE/#4-screenmanager","title":"4. ScreenManager","text":"<p>File: <code>src/r-type/client/include/ScreenManager.hpp</code></p> <p>Responsibilities: - Screen state management (State Pattern) - Screen transitions - Overlay show/hide - Result screen management</p> <p>Available States: <pre><code>enum class GameScreen {\n    WAITING,   // Waiting for players\n    PLAYING,   // In game\n    VICTORY,   // Victory\n    DEFEAT     // Defeat\n};\n</code></pre></p> <p>Transitions: <pre><code>WAITING (Lobby)\n    \u2193\nPLAYING (Game start)\n    \u2193\nVICTORY / DEFEAT (Game over)\n    \u2193\n(Possible return to lobby)\n</code></pre></p> <p>Managed Screens: - Waiting screen (background + \"Waiting for players...\" text) - Result screen (background + \"VICTORY!\" or \"DEFEAT...\" text) - Status overlay (connection, lobby, ping)</p>"},{"location":"CLIENT_ARCHITECTURE/#5-statusoverlay","title":"5. StatusOverlay","text":"<p>File: <code>src/r-type/client/include/StatusOverlay.hpp</code></p> <p>Responsibilities: - Connection status display - Lobby state display - Current session display - Ping display</p> <p>Display Format: <pre><code>Connected (Player 1234) | Lobby 1: 3/4 | In game (session 5678) | Ping: 25ms\n</code></pre></p> <p>Methods: <pre><code>void set_connection(const std::string&amp; status);\nvoid set_lobby(const std::string&amp; status);\nvoid set_session(const std::string&amp; status);\nvoid set_ping(int ping_ms);\nvoid refresh();  // Update display\n</code></pre></p>"},{"location":"CLIENT_ARCHITECTURE/#6-chatoverlay","title":"6. ChatOverlay","text":"<p>File: <code>src/r-type/client/include/ui/ChatOverlay.hpp</code></p> <p>Responsibilities: - Chat display as overlay (non-blocking) - Message history management (scrollable) - Message input and sending - Unread message notifications</p> <p>Controls: <pre><code>T           \u2192 Open chat\nF1          \u2192 Close chat\nEnter       \u2192 Send message\nPageUp/Down \u2192 Scroll through history\n</code></pre></p> <p>Features: - Works in lobby (RoomLobbyScreen) and in-game (ClientGame) - Game continues while chat is open - Unique colors per player (based on player_id) - Notification badge when chat is closed</p> <p>Methods: <pre><code>void toggle();                    // Open/close chat\nvoid set_visible(bool visible);   // Visibility control\nbool is_visible() const;\nvoid add_message(sender_id, sender_name, message);  // Add received message\nvoid set_send_callback(callback); // Callback to send message\nint get_unread_count() const;     // Number of unread messages\nvoid clear_unread();              // Reset counter\nvoid update(graphics, input);     // Update (input handling)\nvoid draw(graphics);              // Rendering\nvoid draw_notification_badge(graphics);  // Notification badge\n</code></pre></p>"},{"location":"CLIENT_ARCHITECTURE/#7-entitymanager","title":"7. EntityManager","text":"<p>File: <code>src/r-type/client/include/EntityManager.hpp</code></p> <p>Responsibilities: - Complete network entity management - Server synchronization - Entity spawn/update/destroy - Client-side prediction (projectiles) - Stale entity management - Player name tags</p> <p>Entity Tracking: <pre><code>std::unordered_map&lt;uint32_t, Entity&gt; server_to_local_;      // server_id \u2192 entity\nstd::unordered_map&lt;uint32_t, EntityType&gt; server_types_;     // Entity type\nstd::unordered_map&lt;uint32_t, uint8_t&gt; stale_counters_;      // Aging counter\nstd::unordered_set&lt;uint32_t&gt; locally_integrated_;           // Projectiles (prediction)\n</code></pre></p> <p>Main Methods: <pre><code>Entity spawn_or_update_entity(server_id, type, x, y, health, subtype);\nvoid remove_entity(server_id);\nvoid clear_all();  // Complete cleanup\nvoid process_snapshot_update(updated_ids);  // Stale entity detection\nvoid update_projectiles(delta_time);  // Local prediction\nvoid update_name_tags();  // Position update\n</code></pre></p> <p>Sprite Construction:</p> <p>Each entity type has a specific sprite: <pre><code>switch (type) {\n    case PLAYER:        \u2192 Animated cyan/white sprite\n    case ENEMY_BASIC:   \u2192 Standard enemy sprite\n    case ENEMY_FAST:    \u2192 Orange sprite\n    case ENEMY_TANK:    \u2192 Red sprite\n    case ENEMY_BOSS:    \u2192 Purple sprite\n    case PROJECTILE:    \u2192 Cyan/red sprite\n    case POWERUP:       \u2192 Green sprite\n    // ...\n}\n</code></pre></p>"},{"location":"CLIENT_ARCHITECTURE/#8-networkclient","title":"8. NetworkClient","text":"<p>File: <code>src/r-type/client/include/NetworkClient.hpp</code></p> <p>Responsibilities: - TCP/UDP connection management with server - Packet sending - Packet reception and decoding - Network event callbacks</p> <p>Main Methods: <pre><code>bool connect(host, tcp_port);\nvoid disconnect();\nvoid update();  // Process packets\n\n// Sending\nvoid send_connect(player_name);\nvoid send_join_lobby(mode, difficulty);\nvoid send_input(flags, tick);\nvoid send_ping();\nvoid send_chat_message(message);  // Chat\n\n// Callbacks\nvoid set_on_accepted(callback);\nvoid set_on_lobby_state(callback);\nvoid set_on_game_start(callback);\nvoid set_on_entity_spawn(callback);\nvoid set_on_snapshot(callback);\nvoid set_on_chat_message(callback);  // Chat\n// ... etc\n</code></pre></p>"},{"location":"CLIENT_ARCHITECTURE/#ecs-architecture-entity-component-system","title":"ECS Architecture (Entity Component System)","text":""},{"location":"CLIENT_ARCHITECTURE/#registry","title":"Registry","text":"<p>The ECS registry manages all game components and entities.</p> <p>Registered Components: <pre><code>registry-&gt;register_component&lt;Position&gt;();\nregistry-&gt;register_component&lt;Velocity&gt;();\nregistry-&gt;register_component&lt;Sprite&gt;();\nregistry-&gt;register_component&lt;SpriteAnimation&gt;();\nregistry-&gt;register_component&lt;Collider&gt;();\nregistry-&gt;register_component&lt;Health&gt;();\nregistry-&gt;register_component&lt;Score&gt;();\nregistry-&gt;register_component&lt;Controllable&gt;();\nregistry-&gt;register_component&lt;NetworkId&gt;();\nregistry-&gt;register_component&lt;UIText&gt;();\n// ... etc\n</code></pre></p>"},{"location":"CLIENT_ARCHITECTURE/#systems","title":"Systems","text":"<p>Execution Order (each frame): 1. <code>ScrollingSystem</code> - Background scrolling 2. <code>SpriteAnimationSystem</code> - Sprite animation 3. <code>RenderSystem</code> - Graphics rendering 4. <code>HUDSystem</code> - Interface display</p>"},{"location":"CLIENT_ARCHITECTURE/#network-flow","title":"Network Flow","text":""},{"location":"CLIENT_ARCHITECTURE/#server-connection","title":"Server Connection","text":"<pre><code>Client                                  Server\n  \u2502                                       \u2502\n  \u251c\u2500\u2500\u25ba connect(host, tcp_port) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502                                       \u2502\n  \u251c\u2500\u2500\u25ba CLIENT_CONNECT \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502     (player_name)                     \u2502\n  \u2502                                       \u2502\n  \u2502\u25c4\u2500\u2500\u2500\u2500 SERVER_ACCEPT \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n  \u2502      (assigned_player_id)             \u2502\n  \u2502                                       \u2502\n  \u2502  [Callback: on_accepted()]            \u2502\n  \u2502                                       \u2502\n  \u251c\u2500\u2500\u25ba CLIENT_JOIN_LOBBY \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502                                       \u2502\n  \u2502\u25c4\u2500\u2500\u2500\u2500 SERVER_LOBBY_STATE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n  \u2502                                       \u2502\n</code></pre>"},{"location":"CLIENT_ARCHITECTURE/#game-start","title":"Game Start","text":"<pre><code>Client                                  Server\n  \u2502                                       \u2502\n  \u2502\u25c4\u2500\u2500\u2500\u2500 SERVER_GAME_START_COUNTDOWN \u2500\u2500\u2500\u2500\u2524\n  \u2502      (10, 9, 8, ...)                  \u2502\n  \u2502                                       \u2502\n  \u2502  [Callback: on_countdown()]           \u2502\n  \u2502                                       \u2502\n  \u2502\u25c4\u2500\u2500\u2500\u2500 SERVER_GAME_START \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n  \u2502      (session_id, udp_port)           \u2502\n  \u2502                                       \u2502\n  \u2502  [Callback: on_game_start()]          \u2502\n  \u2502  - Clear entities                     \u2502\n  \u2502  - Switch to PLAYING screen           \u2502\n  \u2502                                       \u2502\n  \u251c\u2550\u2550\u25ba CLIENT_UDP_HANDSHAKE \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u25ba\u2502\n  \u2502                                       \u2502\n  \u2502\u25c4\u2550\u2550\u2550 SERVER_ENTITY_SPAWN \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2524\n  \u2502     (players, enemies, walls...)      \u2502\n  \u2502                                       \u2502\n</code></pre> <p>Legend: <code>\u2500\u2500\u2500\u25ba</code> TCP, <code>\u2550\u2550\u2550\u25ba</code> UDP</p>"},{"location":"CLIENT_ARCHITECTURE/#game-loop","title":"Game Loop","text":"<pre><code>Client                                  Server\n  \u2502                                       \u2502\n  \u2502  [Every 30ms]                         \u2502\n  \u251c\u2550\u2550\u25ba CLIENT_INPUT \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u25ba\u2502\n  \u2502     (input_flags, client_tick)        \u2502\n  \u2502                                       \u2502\n  \u2502  [Every ~16ms]                        \u2502\n  \u2502\u25c4\u2550\u2550\u2550 SERVER_DELTA_SNAPSHOT \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2524\n  \u2502     (entity states)                   \u2502\n  \u2502                                       \u2502\n  \u2502  [EntityManager processes]            \u2502\n  \u2502  - Update positions                   \u2502\n  \u2502  - Update velocities                  \u2502\n  \u2502  - Update health                      \u2502\n  \u2502  - Remove stale entities              \u2502\n  \u2502                                       \u2502\n  \u2502\u25c4\u2550\u2550\u2550 SERVER_ENTITY_SPAWN \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2524\n  \u2502\u25c4\u2550\u2550\u2550 SERVER_ENTITY_DESTROY \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2524\n  \u2502\u25c4\u2550\u2550\u2550 SERVER_PROJECTILE_SPAWN \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2524\n  \u2502                                       \u2502\n</code></pre>"},{"location":"CLIENT_ARCHITECTURE/#client-side-prediction-projectiles","title":"Client-Side Prediction (Projectiles)","text":"<p>To reduce perceived latency, projectiles are updated locally:</p> <pre><code>// Marking during spawn\nlocally_integrated_.insert(projectile_id);\n\n// Local update each frame\nvoid EntityManager::update_projectiles(float dt) {\n    for (auto projectile_id : locally_integrated_) {\n        if (!in_latest_snapshot) {\n            // Predictive update\n            pos.x += vel.x * dt;\n            pos.y += vel.y * dt;\n\n            // Despawn if off-screen\n            if (out_of_bounds) {\n                remove_entity(projectile_id);\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"CLIENT_ARCHITECTURE/#game-end","title":"Game End","text":"<pre><code>Client                                  Server\n  \u2502                                       \u2502\n  \u2502\u25c4\u2550\u2550\u2550 SERVER_GAME_OVER \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2524\n  \u2502     (result: VICTORY/DEFEAT)          \u2502\n  \u2502                                       \u2502\n  \u2502  [Callback: on_game_over()]           \u2502\n  \u2502  - Show result screen                 \u2502\n  \u2502  - Update status overlay              \u2502\n  \u2502                                       \u2502\n</code></pre>"},{"location":"CLIENT_ARCHITECTURE/#stale-entity-management","title":"Stale Entity Management","text":"<p>To detect entities that no longer exist server-side but haven't received a DESTROY packet:</p> <pre><code>void EntityManager::process_snapshot_update(updated_ids) {\n    for (auto&amp; [server_id, entity] : server_to_local_) {\n        if (!updated_ids.contains(server_id)) {\n            // Entity not updated in this snapshot\n            stale_counters_[server_id]++;\n\n            if (stale_counters_[server_id] &gt; THRESHOLD) {\n                // Removal after ~6 frames without update\n                remove_entity(server_id);\n            }\n        } else {\n            // Reset counter\n            stale_counters_[server_id] = 0;\n        }\n    }\n}\n</code></pre>"},{"location":"CLIENT_ARCHITECTURE/#audio-visual-synchronization","title":"Audio-Visual Synchronization","text":""},{"location":"CLIENT_ARCHITECTURE/#network-callbacks-visualaudio-effects","title":"Network Callbacks \u2192 Visual/Audio Effects","text":"<pre><code>network_client_-&gt;set_on_projectile_spawn([this](...) {\n    // Visual spawn\n    entity_manager_-&gt;spawn_or_update_entity(...);\n\n    // Shot sound (if audio_plugin available)\n    if (audio_plugin_) {\n        audio_plugin_-&gt;play_sound(\"laser.wav\");\n    }\n});\n\nnetwork_client_-&gt;set_on_entity_destroy([this](...) {\n    // Explosion effect\n    create_particle_effect(...);\n\n    // Explosion sound\n    if (audio_plugin_) {\n        audio_plugin_-&gt;play_sound(\"explosion.wav\");\n    }\n});\n</code></pre>"},{"location":"CLIENT_ARCHITECTURE/#screen-resolution-and-scaling","title":"Screen Resolution and Scaling","text":"<p>Default Resolution: 1920x1080</p> <p>The game uses relative dimensions to adapt: <pre><code>constexpr int SCREEN_WIDTH = 1920;\nconstexpr int SCREEN_HEIGHT = 1080;\n\n// Centered positions\nfloat center_x = SCREEN_WIDTH / 2.0f;\nfloat center_y = SCREEN_HEIGHT / 2.0f;\n</code></pre></p>"},{"location":"CLIENT_ARCHITECTURE/#performance-and-optimization","title":"Performance and Optimization","text":""},{"location":"CLIENT_ARCHITECTURE/#update-frequencies","title":"Update Frequencies","text":"<ul> <li>Network (input sending): 30 Hz (~33ms)</li> <li>Network (snapshot reception): 60 Hz (~16ms)</li> <li>Rendering: VSync (typically 60 FPS)</li> <li>Overlay update: 2 Hz (500ms)</li> <li>Ping: Every 5 seconds</li> </ul>"},{"location":"CLIENT_ARCHITECTURE/#optimizations","title":"Optimizations","text":"<ol> <li>Local Prediction: Client-side projectile updates</li> <li>Delta Snapshots: Only changed entities</li> <li>Stale Entity Removal: Automatic cleanup</li> <li>Sprite Batching: By RenderSystem</li> <li>Dirty Flags: Conditional name tag updates</li> </ol>"},{"location":"CLIENT_ARCHITECTURE/#configuration","title":"Configuration","text":"<p>Command Line: <pre><code>./r-type_client [host] [tcp_port] [player_name]\n\n# Examples:\n./r-type_client                           # Defaults: 127.0.0.1:4242, \"Pilot\"\n./r-type_client 192.168.1.100             # Custom host\n./r-type_client 192.168.1.100 5000        # Custom host + port\n./r-type_client 192.168.1.100 5000 \"Bob\"  # + custom name\n</code></pre></p>"},{"location":"CLIENT_ARCHITECTURE/#error-handling","title":"Error Handling","text":""},{"location":"CLIENT_ARCHITECTURE/#connection-failure","title":"Connection Failure","text":"<pre><code>if (!network_client_-&gt;connect(host, tcp_port)) {\n    std::cerr &lt;&lt; \"Failed to connect to server\\n\";\n    return 1;\n}\n</code></pre>"},{"location":"CLIENT_ARCHITECTURE/#unexpected-disconnection","title":"Unexpected Disconnection","text":"<pre><code>network_client_-&gt;set_on_disconnected([this]() {\n    status_overlay_-&gt;set_connection(\"Disconnected\");\n    status_overlay_-&gt;refresh();\n    running_ = false;  // Stop game loop\n});\n</code></pre>"},{"location":"CLIENT_ARCHITECTURE/#server-rejection","title":"Server Rejection","text":"<pre><code>network_client_-&gt;set_on_rejected([this](reason, message) {\n    status_overlay_-&gt;set_connection(\"Rejected: \" + message);\n    status_overlay_-&gt;refresh();\n});\n</code></pre>"},{"location":"CLIENT_ARCHITECTURE/#complete-flow-diagram","title":"Complete Flow Diagram","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  main() \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  ClientGame::initialize()               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  1. Load plugins                        \u2502\n\u2502  2. Create window                       \u2502\n\u2502  3. Setup Registry + Systems            \u2502\n\u2502  4. Load textures (TextureManager)      \u2502\n\u2502  5. Create managers                     \u2502\n\u2502  6. Setup network callbacks             \u2502\n\u2502  7. Connect to server                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  ClientGame::run()                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  GAME LOOP (60 FPS)             \u2502   \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502  \u2502  1. Network update              \u2502   \u2502\n\u2502  \u2502  2. Process packets             \u2502   \u2502\n\u2502  \u2502  3. Handle input                \u2502   \u2502\n\u2502  \u2502  4. Update projectiles          \u2502   \u2502\n\u2502  \u2502  5. Update name tags            \u2502   \u2502\n\u2502  \u2502  6. Run ECS systems             \u2502   \u2502\n\u2502  \u2502  7. Render                      \u2502   \u2502\n\u2502  \u2502  8. Check exit condition        \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  ClientGame::shutdown()                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  1. Disconnect from server              \u2502\n\u2502  2. Clear entities                      \u2502\n\u2502  3. Shutdown plugins                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"CLIENT_ARCHITECTURE/#deployment","title":"Deployment","text":""},{"location":"CLIENT_ARCHITECTURE/#compilation","title":"Compilation","text":"<pre><code>cmake -B build\ncmake --build build --target r-type_client\n</code></pre>"},{"location":"CLIENT_ARCHITECTURE/#required-resources","title":"Required Resources","text":"<p>The client requires the <code>assets/</code> folder with: - <code>sprite/symmetry.png</code> - Background - <code>sprite/background_rtype_menu.png</code> - Menu background - <code>sprite/ship1.png</code>, <code>ship2.png</code>, <code>ship3.png</code>, <code>ship4.png</code> - Player frames - <code>sprite/enemy.png</code> - Enemy sprite - <code>sprite/bullet.png</code> - Projectile sprite - <code>sprite/lock.png</code> - Wall sprite</p>"},{"location":"CLIENT_ARCHITECTURE/#dependencies","title":"Dependencies","text":"<ul> <li>game_engine: ECS, plugins, systems</li> <li>rtype_logic: Shared logic (dimensions, etc.)</li> <li>Raylib: Graphics and input via plugins</li> <li>Miniaudio: Audio via plugin</li> <li>Boost.Asio: Network via plugin</li> </ul>"},{"location":"CLIENT_ARCHITECTURE/#conclusion","title":"Conclusion","text":"<p>The client's modular architecture provides: - Separation of Concerns: Each component has a clear role - Maintainability: Organized and easy-to-modify code - Extensibility: Simplified feature additions - Performance: Network and rendering optimizations - UX: Clear visual feedback and responsiveness</p>"},{"location":"DEVELOPER/","title":"Developer Guide","text":"<p>Welcome to the Mirror R-Type development team! This guide will help you set up your development environment and understand our workflow.</p>"},{"location":"DEVELOPER/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Development Environment</li> <li>Code Style</li> <li>Development Workflow</li> <li>Testing</li> <li>Documentation</li> <li>Common Tasks</li> </ul>"},{"location":"DEVELOPER/#development-environment","title":"Development Environment","text":""},{"location":"DEVELOPER/#required-tools","title":"Required Tools","text":"<p>In addition to the Setup Guide requirements, developers should install:</p>"},{"location":"DEVELOPER/#linuxmacos","title":"Linux/macOS","text":"<pre><code># clang-tidy (C++ linter)\nsudo apt-get install clang-tidy  # Debian/Ubuntu\nbrew install llvm                 # macOS\n\n# clang-format (C++ formatter)\nsudo apt-get install clang-format # Debian/Ubuntu\nbrew install clang-format         # macOS\n\n# Optional: gdb or lldb for debugging\nsudo apt-get install gdb          # Linux\nbrew install lldb                 # macOS\n</code></pre>"},{"location":"DEVELOPER/#windows","title":"Windows","text":"<p>Install via Visual Studio Installer: - Clang tools - C++ AddressSanitizer - C++ profiling tools</p>"},{"location":"DEVELOPER/#ide-setup","title":"IDE Setup","text":""},{"location":"DEVELOPER/#visual-studio-code","title":"Visual Studio Code","text":"<p>Recommended extensions:</p> <pre><code>{\n  \"recommendations\": [\n    \"ms-vscode.cpptools\",\n    \"ms-vscode.cmake-tools\",\n    \"llvm-vs-code-extensions.vscode-clangd\",\n    \"xaver.clang-format\",\n    \"notskm.clang-tidy\"\n  ]\n}\n</code></pre>"},{"location":"DEVELOPER/#clion","title":"CLion","text":"<p>CLion has native CMake support. Simply open the project directory.</p>"},{"location":"DEVELOPER/#code-style","title":"Code Style","text":""},{"location":"DEVELOPER/#c-standards","title":"C++ Standards","text":"<ul> <li>C++20 features encouraged</li> <li>Use modern C++ idioms (RAII, smart pointers, STL containers)</li> <li>Avoid raw pointers and manual memory management</li> <li>Prefer <code>constexpr</code> and <code>const</code> where possible</li> </ul>"},{"location":"DEVELOPER/#naming-conventions","title":"Naming Conventions","text":"<pre><code>// Classes: PascalCase\nclass NetworkPlugin {};\n\n// Functions/Methods: snake_case\nvoid send_packet();\n\n// Variables: snake_case\nint player_count = 0;\n\n// Constants: UPPER_SNAKE_CASE\nconstexpr int MAX_PLAYERS = 4;\n\n// Private members: trailing underscore\nclass Player {\nprivate:\n    int health_;\n    Vector2f position_;\n};\n</code></pre>"},{"location":"DEVELOPER/#file-structure","title":"File Structure","text":"<pre><code>// Header file (.hpp)\n#pragma once\n\nnamespace engine {\n\nclass ClassName {\npublic:\n    // Public interface\n\nprivate:\n    // Private implementation\n};\n\n} // namespace engine\n</code></pre> <pre><code>// Implementation file (.cpp)\n#include \"ClassName.hpp\"\n\nnamespace engine {\n\n// Implementation\n\n} // namespace engine\n</code></pre>"},{"location":"DEVELOPER/#code-formatting","title":"Code Formatting","text":"<p>We use clang-format with the project's <code>.clang-format</code> configuration.</p>"},{"location":"DEVELOPER/#format-your-code","title":"Format your code:","text":"<pre><code># Format a single file\nclang-format -i src/MyFile.cpp\n\n# Format all files\nfind engine client server -name \"*.cpp\" -o -name \"*.hpp\" | xargs clang-format -i\n</code></pre>"},{"location":"DEVELOPER/#auto-format-in-vs-code","title":"Auto-format in VS Code:","text":"<p>Set in <code>.vscode/settings.json</code>:</p> <pre><code>{\n  \"editor.formatOnSave\": true,\n  \"C_Cpp.clang_format_style\": \"file\"\n}\n</code></pre>"},{"location":"DEVELOPER/#linting-with-clang-tidy","title":"Linting with clang-tidy","text":""},{"location":"DEVELOPER/#enable-during-build","title":"Enable during build:","text":"<pre><code>cmake -B build -DENABLE_CLANG_TIDY=ON\ncmake --build build\n</code></pre>"},{"location":"DEVELOPER/#run-manually","title":"Run manually:","text":"<pre><code>clang-tidy engine/src/*.cpp -- -I engine/include\n</code></pre>"},{"location":"DEVELOPER/#configuration","title":"Configuration","text":"<p>See <code>.clang-tidy</code> in the project root for our ruleset.</p>"},{"location":"DEVELOPER/#development-workflow","title":"Development Workflow","text":""},{"location":"DEVELOPER/#branching-strategy","title":"Branching Strategy","text":"<p>We follow Git Flow:</p> <ul> <li><code>main</code> - Production-ready code</li> <li><code>develop</code> - Integration branch for features</li> <li><code>feature/*</code> - New features</li> <li><code>bugfix/*</code> - Bug fixes</li> <li><code>hotfix/*</code> - Urgent production fixes</li> </ul>"},{"location":"DEVELOPER/#creating-a-feature","title":"Creating a Feature","text":"<pre><code># Create feature branch\ngit checkout develop\ngit pull origin develop\ngit checkout -b feature/my-awesome-feature\n\n# Make changes and commit\ngit add .\ngit commit -m \"feat: add awesome feature\"\n\n# Push and create PR\ngit push origin feature/my-awesome-feature\n</code></pre>"},{"location":"DEVELOPER/#commit-message-format","title":"Commit Message Format","text":"<p>We follow Conventional Commits:</p> <pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;description&gt;\n\n[optional body]\n\n[optional footer]\n</code></pre> <p>Types: - <code>feat</code>: New feature - <code>fix</code>: Bug fix - <code>docs</code>: Documentation changes - <code>style</code>: Code style changes (formatting) - <code>refactor</code>: Code refactoring - <code>test</code>: Adding or updating tests - <code>chore</code>: Build process or auxiliary tool changes</p> <p>Examples:</p> <pre><code>git commit -m \"feat(network): implement UDP packet fragmentation\"\ngit commit -m \"fix(graphics): resolve memory leak in texture loading\"\ngit commit -m \"docs: update plugin creation guide\"\ngit commit -m \"refactor(ecs): simplify entity component lookup\"\n</code></pre>"},{"location":"DEVELOPER/#pull-request-process","title":"Pull Request Process","text":"<ol> <li>Create PR from your feature branch to <code>develop</code></li> <li>Fill out PR template with:</li> <li>Description of changes</li> <li>Related issue numbers</li> <li>Testing performed</li> <li>Request review from at least one team member</li> <li>Address feedback and update PR</li> <li>Squash and merge once approved</li> </ol>"},{"location":"DEVELOPER/#testing","title":"Testing","text":""},{"location":"DEVELOPER/#running-tests","title":"Running Tests","text":"<pre><code># Build tests\ncmake -B build -DBUILD_TESTS=ON\ncmake --build build\n\n# Run all tests\nctest --test-dir build --output-on-failure\n\n# Run specific test\n./build/tests/plugin_manager_test\n./build/tests/network_test\n</code></pre>"},{"location":"DEVELOPER/#writing-tests","title":"Writing Tests","text":"<p>We use Google Test:</p> <pre><code>#include &lt;gtest/gtest.h&gt;\n#include \"MyClass.hpp\"\n\nTEST(MyClassTest, DoSomething) {\n    MyClass obj;\n    EXPECT_EQ(obj.getValue(), 42);\n    ASSERT_TRUE(obj.isValid());\n}\n</code></pre> <p>Place tests in <code>tests/</code> directory with <code>_test.cpp</code> suffix.</p>"},{"location":"DEVELOPER/#code-coverage","title":"Code Coverage","text":"<pre><code># Build with coverage flags\ncmake -B build -DCMAKE_BUILD_TYPE=Debug -DENABLE_COVERAGE=ON\ncmake --build build\n\n# Run tests\nctest --test-dir build\n\n# Generate coverage report\nlcov --capture --directory build --output-file coverage.info\ngenhtml coverage.info --output-directory coverage_report\n</code></pre> <p>Open <code>coverage_report/index.html</code> in a browser.</p>"},{"location":"DEVELOPER/#documentation","title":"Documentation","text":""},{"location":"DEVELOPER/#inline-documentation","title":"Inline Documentation","text":"<p>Use Doxygen-style comments:</p> <pre><code>/**\n * @brief Sends a network packet to the specified client\n *\n * @param packet The packet to send\n * @param client_id Target client identifier\n * @return true if packet was sent successfully, false otherwise\n *\n * @throws NetworkException if connection is lost\n */\nbool send_to(const NetworkPacket&amp; packet, ClientId client_id);\n</code></pre>"},{"location":"DEVELOPER/#documentation-files","title":"Documentation Files","text":"<ul> <li>Architecture docs in <code>docs/</code></li> <li>API docs inline in headers</li> <li>README files in relevant directories</li> </ul>"},{"location":"DEVELOPER/#generating-api-docs","title":"Generating API Docs","text":"<pre><code>doxygen Doxyfile\n# Output in docs/api/html/\n</code></pre>"},{"location":"DEVELOPER/#common-tasks","title":"Common Tasks","text":""},{"location":"DEVELOPER/#adding-a-new-plugin","title":"Adding a New Plugin","text":"<p>See Plugin Creation Guide</p>"},{"location":"DEVELOPER/#adding-a-new-system","title":"Adding a New System","text":"<ol> <li>Create header in <code>engine/include/systems/</code></li> <li>Implement in <code>engine/src/systems/</code></li> <li>Register in engine initialization</li> <li>Add tests in <code>tests/systems/</code></li> </ol>"},{"location":"DEVELOPER/#adding-a-new-component","title":"Adding a New Component","text":"<pre><code>// engine/include/components/MyComponent.hpp\n#pragma once\n\nnamespace engine {\n\nstruct MyComponent {\n    int value;\n    float multiplier;\n};\n\n} // namespace engine\n</code></pre> <p>Register with ECS:</p> <pre><code>registry.register_component&lt;MyComponent&gt;();\n</code></pre>"},{"location":"DEVELOPER/#debugging","title":"Debugging","text":""},{"location":"DEVELOPER/#gdb-linux","title":"GDB (Linux)","text":"<pre><code>gdb ./build/r_type_client\n(gdb) run\n(gdb) backtrace  # On crash\n</code></pre>"},{"location":"DEVELOPER/#lldb-macos","title":"LLDB (macOS)","text":"<pre><code>lldb ./build/r_type_client\n(lldb) run\n(lldb) bt  # On crash\n</code></pre>"},{"location":"DEVELOPER/#visual-studio-windows","title":"Visual Studio (Windows)","text":"<p>Press F5 to debug with breakpoints.</p>"},{"location":"DEVELOPER/#performance-profiling","title":"Performance Profiling","text":""},{"location":"DEVELOPER/#linux-perf","title":"Linux (perf)","text":"<pre><code>perf record ./build/r_type_server\nperf report\n</code></pre>"},{"location":"DEVELOPER/#macos-instruments","title":"macOS (Instruments)","text":"<pre><code>instruments -t \"Time Profiler\" ./build/r_type_server\n</code></pre>"},{"location":"DEVELOPER/#windows-visual-studio-profiler","title":"Windows (Visual Studio Profiler)","text":"<p>Debug \u2192 Performance Profiler \u2192 CPU Usage</p>"},{"location":"DEVELOPER/#best-practices","title":"Best Practices","text":""},{"location":"DEVELOPER/#dos","title":"Do's \u2705","text":"<ul> <li>Write unit tests for new features</li> <li>Document public APIs</li> <li>Use const-correctness</li> <li>Handle errors gracefully</li> <li>Keep functions small and focused</li> <li>Use meaningful variable names</li> <li>Follow the existing code style</li> </ul>"},{"location":"DEVELOPER/#donts","title":"Don'ts \u274c","text":"<ul> <li>Don't commit commented-out code</li> <li>Don't hardcode magic numbers</li> <li>Don't use <code>goto</code></li> <li>Don't ignore compiler warnings</li> <li>Don't leak memory</li> <li>Don't expose implementation details in headers</li> <li>Don't commit directly to <code>main</code> or <code>develop</code></li> </ul>"},{"location":"DEVELOPER/#code-review-checklist","title":"Code Review Checklist","text":"<ul> <li>[ ] Code follows style guide</li> <li>[ ] Tests pass locally</li> <li>[ ] New tests added for new features</li> <li>[ ] Documentation updated</li> <li>[ ] No compiler warnings</li> <li>[ ] clang-tidy passes</li> <li>[ ] Commit messages follow convention</li> <li>[ ] PR description is clear</li> </ul>"},{"location":"DEVELOPER/#resources","title":"Resources","text":"<ul> <li>C++ Core Guidelines</li> <li>Modern CMake</li> <li>Google Test Documentation</li> <li>Boost.Asio Documentation</li> </ul>"},{"location":"DEVELOPER/#getting-help","title":"Getting Help","text":"<ul> <li>Ask in team chat</li> <li>Check GitHub Issues</li> <li>Read existing documentation</li> <li>Pair program with a team member</li> </ul> <p>Happy Coding! \ud83d\ude80</p>"},{"location":"ENEMIES/","title":"Enemy Guide","text":"<p>This document catalogs the various enemy types, their statistics, behaviors, and visual representations in Mirror R-Type.</p>"},{"location":"ENEMIES/#stats-overview","title":"Stats Overview","text":"<p>Base statistics for enemies (Difficuly: Normal). Stats scale with difficulty settings.</p> Class Health (HP) Speed (px/s) Dimensions (px) Damage Basic 50 100 120x120 25 Fast 30 200 100x100 25 Tank 150 50 160x160 40 Boss 500+ 30 280x280 50"},{"location":"ENEMIES/#difficulty-scaling","title":"Difficulty Scaling","text":"<p>Game difficulty adjusts enemy attributes by the following multipliers:</p> Difficulty Health Multiplier Speed Multiplier Damage Multiplier Easy 0.7x 0.8x 0.7x Normal 1.0x 1.0x 1.0x Hard 1.5x 1.3x 1.5x"},{"location":"ENEMIES/#enemy-classes","title":"Enemy Classes","text":""},{"location":"ENEMIES/#basic-class","title":"Basic Class","text":"<p>The standard fodder enemy. They generally move in simple patterns (straight lines) and serve as the primary obstacle.</p> <ul> <li>Sprite: Varied (Enemie9 - Enemie13).<ul> <li>Variants: <code>basic</code>, <code>basic_v1</code> through <code>basic_v5</code>.</li> <li>Note: Variants are visually distinct but functionally identical to provide visual variety.</li> </ul> </li> <li>Special Variations:<ul> <li>Bouncer: Moves left but bounces off the top and bottom of the screen. (Uses Enemie11 sprite visually).</li> </ul> </li> </ul>"},{"location":"ENEMIES/#fast-class","title":"Fast Class","text":"<p>Low health but high speed enemies designed to flank or surprise the player.</p> <ul> <li>Sprite: Uniformly uses Enemie13 (Sleek Gold/Blue ship).</li> <li>Variations:<ul> <li>Standard Fast: Moves rapidly in a straight line.</li> <li>Zigzag: Moves in a sine-wave pattern.</li> <li>Kamikaze: Special variant that charges directly at the player.<ul> <li>Visual Exception: Uses a unique Kamikaze sprite (not Enemie13).</li> </ul> </li> <li>Coward: Approaches then retreats.</li> <li>Chaser: Actively follows the player's Y-coordinate.</li> </ul> </li> </ul>"},{"location":"ENEMIES/#tank-class","title":"Tank Class","text":"<p>Heavily armored enemies that act as damage sponges. They act as moving walls.</p> <ul> <li>Sprite: Uniformly uses Enemie11 (Bulky Red ship).</li> <li>Variations:<ul> <li>Standard Tank: Moves very slowly in a straight line.</li> <li>Patrol: Moves vertically or loops in a specific area.</li> <li>Spiral: Moves in a circular spiral pattern.</li> </ul> </li> </ul>"},{"location":"ENEMIES/#boss-class","title":"Boss Class","text":"<p>End-of-level guardians with massive health pools and unique scripts.</p> <ul> <li>Mars Boss: The standard boss for Level 1.</li> <li>Jupiter Boss: The boss for Level 4.</li> <li>Uranus Boss: The boss for Level 3.</li> <li>Health: Starts at 500 HP, scales significantly.</li> </ul>"},{"location":"ENEMIES/#configuration","title":"Configuration","text":"<p>Enemy definitions are loaded from <code>assets/config/enemies.json</code>. Lua scripts in <code>assets/scripts/</code> define the movement patterns (AI).</p> <pre><code>\"basic\": {\n    \"script\": \"basic.lua\",\n    \"description\": \"Standard enemy - moves left steadily\"\n}\n</code></pre>"},{"location":"LEVEL_SYSTEM/","title":"Level System","text":"<p>This document explains how the level system works in Mirror R-Type, including level progression, boss spawning, and level transitions.</p>"},{"location":"LEVEL_SYSTEM/#overview","title":"Overview","text":"<p>The level system manages: - Level state machine (start, waves, boss, complete) - Wave spawning based on scroll distance - Boss spawning and defeat detection - Level transitions and victory conditions</p>"},{"location":"LEVEL_SYSTEM/#level-state-machine","title":"Level State Machine","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  LEVEL_START    \u2502  (0.5s intro)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     WAVES       \u2502  (enemy waves based on scroll)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502 all waves complete + no enemies\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 BOSS_TRANSITION \u2502  (3s warning)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   BOSS_FIGHT    \u2502  (scroll stops, boss spawns)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502 boss defeated\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 LEVEL_COMPLETE  \u2502  (5s victory)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Next Level or   \u2502\n\u2502 FINAL VICTORY   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"LEVEL_SYSTEM/#state-descriptions","title":"State Descriptions","text":"State Duration Description <code>LEVEL_START</code> 0.5s Brief intro, scroll begins <code>WAVES</code> Variable Enemy waves spawn based on scroll distance <code>BOSS_TRANSITION</code> 3s \"WARNING: BOSS APPROACHING!\" message <code>BOSS_FIGHT</code> Variable Scroll stops, boss spawns and fights <code>LEVEL_COMPLETE</code> 5s Victory animation, score display <code>GAME_OVER</code> - All players dead or final victory"},{"location":"LEVEL_SYSTEM/#scroll-system","title":"Scroll System","text":"<p>The game scrolls automatically at a constant speed defined per level.</p>"},{"location":"LEVEL_SYSTEM/#scroll-configuration","title":"Scroll Configuration","text":"<pre><code>{\n    \"level_id\": 1,\n    \"base_scroll_speed\": 60.0,\n    \"total_scroll_distance\": 7000.0\n}\n</code></pre> Parameter Description Example <code>base_scroll_speed</code> Pixels per second 60.0 <code>base_scroll_speed</code> Pixels per second 60.0 <code>total_chunks</code> Total level length in chunks (1 chunk = 480px = 30 tiles) 20"},{"location":"LEVEL_SYSTEM/#chunk-coordinate-system","title":"Chunk Coordinate System","text":"<p>Calculations are now based on Chunk Segments rather than absolute pixels to ensure map sync. - 1 Chunk = 30 Tiles width = 480 Pixels - Total Scroll Distance = <code>total_chunks</code> * 480.0</p>"},{"location":"LEVEL_SYSTEM/#when-does-scroll-stop","title":"When Does Scroll Stop?","text":"<p>Scroll stops when the boss spawns (state = <code>BOSS_FIGHT</code>): - Camera velocity is set to 0 - Boss appears at configured spawn position - Players fight boss in fixed arena</p>"},{"location":"LEVEL_SYSTEM/#wave-spawning","title":"Wave Spawning","text":"<p>Waves spawn based on scroll distance, not time.</p>"},{"location":"LEVEL_SYSTEM/#wave-configuration","title":"Wave Configuration","text":"<pre><code>{\n    \"wave_number\": 1,\n    \"trigger\": {\n    \"trigger\": {\n        \"chunkId\": 1,\n        \"offset\": 0.5,\n        \"timeDelay\": 0\n    },\n    },\n    \"spawns\": [\n        {\n            \"type\": \"enemy\",\n            \"enemyType\": \"basic\",\n            \"positionX\": 2100,\n            \"positionY\": 300,\n            \"count\": 3,\n            \"pattern\": \"line\",\n            \"spacing\": 100\n        }\n    ]\n}\n</code></pre>"},{"location":"LEVEL_SYSTEM/#trigger-conditions","title":"Trigger Conditions","text":"Field Description <code>chunkId</code> Index of the map chunk to trigger (0-based) <code>offset</code> Percentage progression within chunk (0.0 to 1.0) <code>scrollDistance</code> (Legacy/Backup) Absolute pixel distance <code>timeDelay</code> Additional delay after scroll trigger (seconds)"},{"location":"LEVEL_SYSTEM/#spawn-patterns","title":"Spawn Patterns","text":"Pattern Description <code>single</code> Single entity <code>line</code> Horizontal line with spacing <code>formation</code> Custom formation"},{"location":"LEVEL_SYSTEM/#boss-spawning","title":"Boss Spawning","text":""},{"location":"LEVEL_SYSTEM/#when-does-the-boss-spawn","title":"When Does the Boss Spawn?","text":"<ol> <li>All waves triggered (<code>all_waves_triggered = true</code>)</li> <li>No enemies remaining (all wave enemies defeated)</li> <li>State transitions to <code>BOSS_TRANSITION</code> (3s warning)</li> <li>State transitions to <code>BOSS_FIGHT</code></li> <li>Boss spawns at configured position</li> <li>Scroll stops</li> </ol>"},{"location":"LEVEL_SYSTEM/#boss-configuration","title":"Boss Configuration","text":"<pre><code>\"boss\": {\n    \"boss_name\": \"Mars Guardian\",\n    \"spawn_scroll_distance\": 6500.0,\n    \"spawn_position_x\": 1600.0,\n    \"spawn_position_y\": 540.0,\n    \"script_path\": \"boss/boss1_mars_guardian.lua\",\n    \"total_phases\": 3\n}\n</code></pre> Field Description <code>boss_name</code> Display name <code>spawn_scroll_distance</code> Minimum scroll before boss can spawn <code>spawn_position_x</code> X position where boss appears <code>spawn_position_y</code> Y position where boss appears <code>script_path</code> Lua script for boss behavior <code>total_phases</code> Number of boss phases (usually 3)"},{"location":"LEVEL_SYSTEM/#boss-defeat-detection","title":"Boss Defeat Detection","text":"<p>Boss is considered defeated when: - Boss entity no longer exists in registry, OR - Boss health reaches 0</p>"},{"location":"LEVEL_SYSTEM/#level-transitions","title":"Level Transitions","text":""},{"location":"LEVEL_SYSTEM/#next-level-loading","title":"Next Level Loading","text":"<p>When a level is completed:</p> <ol> <li>Wait 5 seconds (victory animation)</li> <li>Check level number:</li> <li>Level &lt; 3: Load next level</li> <li>Level &gt;= 3: Final victory</li> <li>Clear all enemies and projectiles</li> <li>Reset level controller</li> <li>Transition to <code>LEVEL_START</code></li> </ol>"},{"location":"LEVEL_SYSTEM/#victory-conditions","title":"Victory Conditions","text":"Condition Result Level 1 complete Load Level 2 Level 2 complete Load Level 3 Level 3 complete FINAL VICTORY"},{"location":"LEVEL_SYSTEM/#level-configuration-files","title":"Level Configuration Files","text":""},{"location":"LEVEL_SYSTEM/#file-location","title":"File Location","text":"<pre><code>assets/levels/\n\u251c\u2500\u2500 level_1_mars_assault.json\n\u251c\u2500\u2500 level_2_nebula_station.json\n\u251c\u2500\u2500 level_3_uranus_station.json\n\u2514\u2500\u2500 level_4_jupiter_orbit.json\n</code></pre>"},{"location":"LEVEL_SYSTEM/#full-level-structure","title":"Full Level Structure","text":"<pre><code>{\n    \"level_id\": 1,\n    \"level_name\": \"Mars Assault\",\n    \"level_description\": \"Storm the Martian defense installations\",\n    \"map_id\": 1,\n    \"map_id\": 1,\n    \"base_scroll_speed\": 60.0,\n    \"total_chunks\": 20,\n\n    \"phases\": [\n        {\n            \"phase_number\": 1,\n            \"phase_name\": \"Red Planet Entry\",\n            \"scroll_start\": 0.0,\n            \"scroll_end\": 2000.0,\n            \"difficulty\": \"easy\",\n            \"waves\": [...]\n        },\n        {\n            \"phase_number\": 2,\n            \"phase_name\": \"Industrial Zone\",\n            \"scroll_start\": 2000.0,\n            \"scroll_end\": 4500.0,\n            \"difficulty\": \"medium\",\n            \"waves\": [...]\n        },\n        {\n            \"phase_number\": 3,\n            \"phase_name\": \"Final Approach\",\n            \"scroll_start\": 4500.0,\n            \"scroll_end\": 6500.0,\n            \"difficulty\": \"hard\",\n            \"waves\": [...]\n        }\n    ],\n\n    \"boss\": {\n        \"boss_name\": \"Mars Guardian\",\n        \"spawn_scroll_distance\": 6500.0,\n        \"spawn_position_x\": 1600.0,\n        \"spawn_position_y\": 540.0,\n        \"script_path\": \"boss/boss1_mars_guardian.lua\",\n        \"total_phases\": 3\n    }\n}\n</code></pre>"},{"location":"LEVEL_SYSTEM/#level-summary","title":"Level Summary","text":""},{"location":"LEVEL_SYSTEM/#level-1-mars-assault","title":"Level 1: Mars Assault","text":"Property Value Scroll Speed 60 px/s Total Distance 7000 px Boss Spawn 6500 px Boss Mars Guardian Difficulty Easy \u2192 Medium \u2192 Hard"},{"location":"LEVEL_SYSTEM/#level-2-nebula-station","title":"Level 2: Nebula Station","text":"Property Value Scroll Speed 65 px/s Total Distance 9000 px Boss Spawn 8500 px Boss Nebula Core Difficulty Easy \u2192 Medium \u2192 Hard"},{"location":"LEVEL_SYSTEM/#level-3-uranus-station","title":"Level 3: Uranus Station","text":"Property Value Scroll Speed 60 px/s Total Distance 8000 px Boss Spawn 7500 px Boss Uranus Sentinel Difficulty Medium \u2192 Hard \u2192 Very Hard"},{"location":"LEVEL_SYSTEM/#level-4-jupiter-orbit","title":"Level 4: Jupiter Orbit","text":"Property Value Scroll Speed 60 px/s Total Distance 9000 px Boss Spawn 8500 px Boss Jupiter Titan Difficulty Medium \u2192 Hard \u2192 Extreme"},{"location":"LEVEL_SYSTEM/#timing-calculations","title":"Timing Calculations","text":""},{"location":"LEVEL_SYSTEM/#example-level-1","title":"Example: Level 1","text":"<pre><code>Scroll speed: 60 px/s\nBoss spawn distance: 6500 px\n\nTime to boss: 6500 / 60 = ~108 seconds (~1m 48s)\n+ Boss transition: 3s\n+ Boss fight: Variable (depends on player skill)\n+ Victory: 5s\n</code></pre>"},{"location":"LEVEL_SYSTEM/#estimated-level-durations","title":"Estimated Level Durations","text":"Level To Boss Boss Fight Total (approx) 1 ~1m 48s ~1-2 min ~3-4 min 2 ~2m 10s ~1-2 min ~3-5 min 3 ~2m 5s ~1-2 min ~3-5 min 4 ~2m 22s ~2-3 min ~4-6 min"},{"location":"LEVEL_SYSTEM/#technical-implementation","title":"Technical Implementation","text":""},{"location":"LEVEL_SYSTEM/#key-components","title":"Key Components","text":"Component Description <code>LevelController</code> Stores current level state, boss entity, etc. <code>ScrollState</code> Current scroll position <code>BossScript</code> Lua script path for boss behavior"},{"location":"LEVEL_SYSTEM/#key-systems","title":"Key Systems","text":"System Responsibility <code>LevelSystem</code> State machine, transitions <code>LuaSystem</code> Enemy and boss AI scripts <code>WaveManager</code> Wave spawning based on scroll"},{"location":"LEVEL_SYSTEM/#gamesession-integration","title":"GameSession Integration","text":"<p>The <code>GameSession</code> class coordinates: - Scroll updates (<code>current_scroll_</code>) - Wave manager updates - Boss spawning when <code>BOSS_FIGHT</code> state begins - Level loading when <code>LEVEL_COMPLETE</code> ends</p>"},{"location":"LEVEL_SYSTEM/#debug-information","title":"Debug Information","text":"<p>Console logs show level progression:</p> <pre><code>[LevelSystem] Transition: LEVEL_START\n[LevelSystem] Transition: WAVES\n[LevelSystem] Waves started for level 1\n[LevelSystem] All waves complete and no enemies remaining - starting boss transition\n[LevelSystem] Transition: BOSS_TRANSITION\n[LevelSystem] Boss transition - WARNING: BOSS APPROACHING!\n[LevelSystem] Transition: BOSS_FIGHT\n[LevelSystem] Boss fight started!\n[GameSession] Scroll stopped for boss fight\n[GameSession] Boss spawned: Mars Guardian (script: boss/boss1_mars_guardian.lua)\n[LuaSystem] Loaded boss script: boss/boss1_mars_guardian.lua\n[LuaSystem] Boss phase transition: 0 -&gt; 1\n[LuaSystem] Boss phase transition: 1 -&gt; 2\n[LevelSystem] Transition: LEVEL_COMPLETE\n[LevelSystem] Level 1 completed!\n[LevelSystem] Loading level 2...\n</code></pre>"},{"location":"LUA_SCRIPTING/","title":"Lua Scripting System","text":"<p>This document explains how to create and configure Lua scripts for enemies and bosses in Mirror R-Type.</p>"},{"location":"LUA_SCRIPTING/#overview","title":"Overview","text":"<p>The game uses Lua scripts to define AI behavior for enemies and bosses. Scripts are located in <code>assets/scripts/ai/</code> and are loaded dynamically at runtime by the <code>LuaSystem</code>.</p>"},{"location":"LUA_SCRIPTING/#directory-structure","title":"Directory Structure","text":"<pre><code>assets/scripts/ai/\n\u251c\u2500\u2500 basic.lua           # Basic enemy: simple leftward movement\n\u251c\u2500\u2500 zigzag.lua          # Zigzag pattern movement\n\u251c\u2500\u2500 bouncer.lua         # Bounces off screen edges\n\u251c\u2500\u2500 kamikaze.lua        # Charges toward player\n\u2514\u2500\u2500 boss/\n    \u251c\u2500\u2500 boss1_mars_guardian.lua\n    \u251c\u2500\u2500 boss2_nebula_core.lua\n    \u251c\u2500\u2500 boss3_uranus_sentinel.lua\n    \u2514\u2500\u2500 boss4_jupiter_titan.lua\n</code></pre>"},{"location":"LUA_SCRIPTING/#enemy-scripts","title":"Enemy Scripts","text":""},{"location":"LUA_SCRIPTING/#script-signature","title":"Script Signature","text":"<p>Enemy scripts must return a function with this signature:</p> <pre><code>return function(dt, pos, vel)\n    -- dt: delta time (seconds)\n    -- pos: position table {x, y}\n    -- vel: velocity table {x, y}\nend\n</code></pre>"},{"location":"LUA_SCRIPTING/#available-global-functions","title":"Available Global Functions","text":"Function Description Returns <code>find_nearest_player(x, y)</code> Find the closest player to position (x, y) <code>targetX, targetY, found</code>"},{"location":"LUA_SCRIPTING/#example-basic-enemy","title":"Example: Basic Enemy","text":"<pre><code>-- Simple leftward movement\nreturn function(dt, pos, vel)\n    local speed = 100\n\n    vel.x = -speed\n    vel.y = 0\n\n    pos.x = pos.x + vel.x * dt\n    pos.y = pos.y + vel.y * dt\nend\n</code></pre>"},{"location":"LUA_SCRIPTING/#example-kamikaze-enemy","title":"Example: Kamikaze Enemy","text":"<pre><code>-- Charges toward player when close\nreturn function(dt, pos, vel)\n    local chargeSpeed = 350\n    local chargeDistance = 600\n\n    local targetX, targetY, found = find_nearest_player(pos.x, pos.y)\n\n    if found then\n        local dx = targetX - pos.x\n        local dy = targetY - pos.y\n        local dist = math.sqrt(dx*dx + dy*dy)\n\n        local speed = dist &lt; chargeDistance and chargeSpeed or 60\n\n        if dist &gt; 1.0 then\n            vel.x = (dx / dist) * speed\n            vel.y = (dy / dist) * speed\n        end\n    else\n        vel.x = -chargeSpeed * 0.5\n        vel.y = 0\n    end\n\n    pos.x = pos.x + vel.x * dt\n    pos.y = pos.y + vel.y * dt\nend\n</code></pre>"},{"location":"LUA_SCRIPTING/#example-zigzag-enemy","title":"Example: Zigzag Enemy","text":"<pre><code>-- Changes vertical direction based on horizontal distance\nreturn function(dt, pos, vel)\n    local speedX = 90\n    local speedY = 70\n    local zigzagWidth = 180\n\n    local segment = math.floor(pos.x / zigzagWidth)\n\n    if segment % 2 == 0 then\n        vel.y = speedY\n    else\n        vel.y = -speedY\n    end\n\n    vel.x = -speedX\n\n    pos.x = pos.x + vel.x * dt\n    pos.y = pos.y + vel.y * dt\n\n    -- Clamp Y position\n    if pos.y &lt; 80 then pos.y = 80 end\n    if pos.y &gt; 1000 then pos.y = 1000 end\nend\n</code></pre>"},{"location":"LUA_SCRIPTING/#enemy-types-and-scripts","title":"Enemy Types and Scripts","text":"Enemy Type Script File Behavior <code>basic</code> <code>basic.lua</code> Simple leftward movement <code>zigzag</code> <code>zigzag.lua</code> Zigzag pattern <code>bouncer</code> <code>bouncer.lua</code> Bounces off screen edges <code>kamikaze</code> <code>kamikaze.lua</code> Charges toward nearest player <code>tank</code> <code>basic.lua</code> Slow movement, high HP <code>fast</code> <code>basic.lua</code> Fast movement, low HP"},{"location":"LUA_SCRIPTING/#boss-scripts","title":"Boss Scripts","text":""},{"location":"LUA_SCRIPTING/#script-signature_1","title":"Script Signature","text":"<p>Boss scripts receive additional state information:</p> <pre><code>return function(dt, pos, vel, boss_state)\n    -- dt: delta time (seconds)\n    -- pos: position table {x, y}\n    -- vel: velocity table {x, y}\n    -- boss_state: table with boss info\n    --   .phase: current phase (0, 1, or 2)\n    --   .phase_timer: time in current phase\n    --   .attack_timer: time since last attack\n    --   .health_percent: current HP percentage (0.0-1.0)\n\n    -- Return true if an attack was performed (resets attack_timer)\n    return false\nend\n</code></pre>"},{"location":"LUA_SCRIPTING/#phase-system","title":"Phase System","text":"<p>Bosses automatically transition between 3 phases based on health:</p> Phase Health Range Behavior 0 100% - 67% Phase 1: Easiest patterns 1 66% - 34% Phase 2: Medium difficulty 2 33% - 0% Phase 3: Hardest patterns <p>Phase transitions are handled automatically by <code>LuaSystem</code> - the script just needs to check <code>boss_state.phase</code>.</p>"},{"location":"LUA_SCRIPTING/#attack-pattern-functions","title":"Attack Pattern Functions","text":"Function Parameters Description <code>spawn_boss_projectile(x, y, vx, vy, damage)</code> Position, velocity, damage Spawn single projectile <code>spawn_pattern_360(x, y, count, speed, damage)</code> Position, projectile count, speed, damage 360-degree spray <code>spawn_pattern_aimed(x, y, count, speed, damage, spread)</code> Position, count, speed, damage, spread angle (degrees) Aimed burst at nearest player <code>spawn_pattern_spiral(x, y, count, speed, damage, rotation)</code> Position, count, speed, damage, rotation offset (degrees) Rotating spiral pattern <code>spawn_pattern_random(x, y, count, speed, damage)</code> Position, count, speed, damage Random direction barrage"},{"location":"LUA_SCRIPTING/#example-boss-script","title":"Example: Boss Script","text":"<pre><code>-- Boss with 3 phases\nlocal ATTACK_COOLDOWNS = {2.5, 1.8, 1.2}  -- Per phase\nlocal MIN_X, MAX_X = 1200.0, 1800.0\nlocal MIN_Y, MAX_Y = 100.0, 980.0\n\nreturn function(dt, pos, vel, boss_state)\n    local phase = boss_state.phase\n    local timer = boss_state.phase_timer\n\n    -- Movement based on phase\n    if phase == 0 then\n        -- Phase 1: Slow vertical sine\n        vel.x = 0\n        vel.y = math.sin(timer * 2.0) * 80.0\n    elseif phase == 1 then\n        -- Phase 2: Figure-8 pattern\n        vel.x = math.sin(timer * 1.5) * 50.0\n        vel.y = math.sin(timer * 3.0) * 100.0\n    else\n        -- Phase 3: Aggressive movement\n        vel.x = math.sin(timer * 2.0) * 70.0\n        vel.y = math.sin(timer * 4.0) * 120.0\n    end\n\n    -- Apply movement\n    pos.x = pos.x + vel.x * dt\n    pos.y = pos.y + vel.y * dt\n\n    -- Clamp to boundaries\n    pos.x = math.max(MIN_X, math.min(MAX_X, pos.x))\n    pos.y = math.max(MIN_Y, math.min(MAX_Y, pos.y))\n\n    -- Attacks\n    local cooldown = ATTACK_COOLDOWNS[phase + 1]\n    if boss_state.attack_timer &gt;= cooldown then\n        if phase == 0 then\n            spawn_pattern_aimed(pos.x, pos.y, 5, 280, 20, 20.0)\n        elseif phase == 1 then\n            spawn_pattern_spiral(pos.x, pos.y, 10, 240, 25, timer * 60)\n        else\n            spawn_pattern_360(pos.x, pos.y, 16, 220, 30)\n        end\n        return true  -- Attack performed\n    end\n    return false\nend\n</code></pre>"},{"location":"LUA_SCRIPTING/#boss-configuration-in-level-json","title":"Boss Configuration in Level JSON","text":"<p>Each level specifies its boss script in the level configuration:</p> <pre><code>\"boss\": {\n    \"boss_name\": \"Mars Guardian\",\n    \"spawn_scroll_distance\": 6500.0,\n    \"spawn_position_x\": 1600.0,\n    \"spawn_position_y\": 540.0,\n    \"script_path\": \"boss/boss1_mars_guardian.lua\",\n    \"total_phases\": 3\n}\n</code></pre>"},{"location":"LUA_SCRIPTING/#current-bosses","title":"Current Bosses","text":"Level Boss Name Script Movement Pattern 1 Mars Guardian <code>boss1_mars_guardian.lua</code> Vertical sine, Figure-8 2 Nebula Core <code>boss2_nebula_core.lua</code> Stationary, Chase 3 Uranus Sentinel <code>boss3_uranus_sentinel.lua</code> Circular orbit 4 Jupiter Titan <code>boss4_jupiter_titan.lua</code> Erratic, all attack types"},{"location":"LUA_SCRIPTING/#creating-a-new-enemy-script","title":"Creating a New Enemy Script","text":"<ol> <li>Create a new <code>.lua</code> file in <code>assets/scripts/ai/</code></li> <li>Return a function with signature <code>function(dt, pos, vel)</code></li> <li>Modify <code>pos</code> and <code>vel</code> to control movement</li> <li>Use <code>find_nearest_player()</code> for player tracking</li> </ol>"},{"location":"LUA_SCRIPTING/#creating-a-new-boss-script","title":"Creating a New Boss Script","text":"<ol> <li>Create a new <code>.lua</code> file in <code>assets/scripts/ai/boss/</code></li> <li>Return a function with signature <code>function(dt, pos, vel, boss_state)</code></li> <li>Implement phase-based behavior using <code>boss_state.phase</code></li> <li>Use attack pattern functions for projectiles</li> <li>Return <code>true</code> after performing an attack to reset cooldown</li> <li>Add the script path to the level JSON configuration</li> </ol>"},{"location":"LUA_SCRIPTING/#technical-details","title":"Technical Details","text":""},{"location":"LUA_SCRIPTING/#script-loading","title":"Script Loading","text":"<p>Scripts are cached after first load for performance. The <code>LuaSystem</code> handles: - Loading scripts from <code>assets/scripts/ai/</code> base path - Caching compiled Lua functions - Passing component data to scripts - Applying script results back to components</p>"},{"location":"LUA_SCRIPTING/#component-requirements","title":"Component Requirements","text":"<p>For enemies: - <code>Script</code> component with <code>path</code> field (e.g., <code>\"zigzag.lua\"</code>) - <code>Position</code> component - <code>Velocity</code> component</p> <p>For bosses: - <code>BossScript</code> component with <code>path</code> field (e.g., <code>\"boss/boss1_mars_guardian.lua\"</code>) - <code>Position</code> component - <code>Velocity</code> component - <code>Health</code> component (for phase calculations)</p>"},{"location":"LUA_SCRIPTING/#screen-boundaries","title":"Screen Boundaries","text":"<ul> <li>Screen size: 1920x1080</li> <li>Boss area: X: 1200-1800, Y: 100-980</li> <li>Enemy spawn: Usually X &gt; 1920 (off-screen right)</li> </ul>"},{"location":"PROCEDURAL_GENERATION/","title":"Procedural Map Generation System","text":""},{"location":"PROCEDURAL_GENERATION/#overview","title":"Overview","text":"<p>The R-Type procedural generation system creates infinite, unique map layouts at runtime. The system generates navigable passages with obstacles (stalactites/stalagmites) while ensuring smooth transitions between segments and maintaining client-server synchronization.</p>"},{"location":"PROCEDURAL_GENERATION/#architecture","title":"Architecture","text":""},{"location":"PROCEDURAL_GENERATION/#core-components","title":"Core Components","text":""},{"location":"PROCEDURAL_GENERATION/#1-proceduralmapgenerator-srcr-typegame-logicsrcproceduralmapgeneratorcpp","title":"1. ProceduralMapGenerator (<code>src/r-type/game-logic/src/ProceduralMapGenerator.cpp</code>)","text":"<p>The generator creates map segments using a seeded random algorithm.</p> <p>Key Features: - Deterministic Generation: Same seed produces identical maps across client and server - Continuous Passages: Entry/exit states ensure seamless segment transitions - Configurable Parameters: Adjustable passage height, obstacle density, and path variation - Infinite Generation: Can generate unlimited segments on-demand</p> <p>Algorithm:</p> <pre><code>class ProceduralMapGenerator {\n    struct GenerationParams {\n        int minPassageHeight;      // Minimum navigable height (tiles)\n        float stalactiteChance;    // Probability of obstacle placement (0-1)\n        int maxStalactiteLength;   // Maximum obstacle extension (tiles)\n        int pathVariation;         // Degree of path meandering\n    };\n\n    struct PathState {\n        int topY;     // Upper boundary of passage\n        int bottomY;  // Lower boundary of passage\n    };\n};\n</code></pre> <p>Generation Process:</p> <ol> <li>Path Generation: Creates a meandering corridor using constrained random walk</li> <li>Gradual vertical movement (\u00b12 tiles per column)</li> <li>Width variation while maintaining minimum passage height</li> <li> <p>Smooth transitions to prevent abrupt changes</p> </li> <li> <p>Wall Drawing: Fills tiles above and below the passage path</p> </li> <li>Top wall: tiles[0...topY]</li> <li> <p>Bottom wall: tiles[bottomY...HEIGHT]</p> </li> <li> <p>Obstacle Placement: Adds stalactites (ceiling) and stalagmites (floor)</p> </li> <li>Probabilistic placement based on <code>stalactiteChance</code></li> <li>Respects minimum passage height constraints</li> <li>Skips segment edges to preserve entry/exit clearance</li> </ol>"},{"location":"PROCEDURAL_GENERATION/#2-chunkmanagersystem-srcr-typegame-logicsrcchunkmanagersystemcpp","title":"2. ChunkManagerSystem (<code>src/r-type/game-logic/src/ChunkManagerSystem.cpp</code>)","text":"<p>Manages tile streaming and rendering for both static and procedural maps.</p> <p>Dual Mode Operation:</p> <pre><code>// Static Mode (e.g., Mars, Jupiter, Uranus)\n- Loads pre-defined segments from JSON files\n- Fixed map length\n- Segment data stored in std::vector&lt;SegmentData&gt;\n\n// Procedural Mode (e.g., Nebula)\n- Generates segments on-demand using ProceduralMapGenerator\n- Infinite map length\n- Segment data cached in std::unordered_map&lt;int, SegmentData&gt;\n</code></pre> <p>Chunk Loading Strategy:</p> <pre><code>Screen View          Load Threshold\n     |                    |\n     v                    v\n|----[====]----[====]----[====]----|  Active Chunks\n     ^                         ^\n     |                         |\nUnload Threshold          Furthest Loaded\n</code></pre> <ul> <li>Load Ahead: Generates chunks beyond screen view for seamless scrolling</li> <li>Lazy Generation: Segments created only when needed</li> <li>Cache Management: Keeps recent segments in memory</li> <li>Unload Behind: Removes off-screen chunks to manage memory</li> </ul>"},{"location":"PROCEDURAL_GENERATION/#3-gamesession-server-srcr-typeserversrcgamesessioncpp","title":"3. GameSession (Server) (<code>src/r-type/server/src/GameSession.cpp</code>)","text":"<p>Handles server-side collision and generation synchronization.</p> <p>Responsibilities: - Generate wall collision entities from procedural segments - Maintain same segment cache as client - Ensure collision boundaries match visual tiles</p>"},{"location":"PROCEDURAL_GENERATION/#client-server-synchronization","title":"Client-Server Synchronization","text":"<p>Critical Requirement: Both client and server must generate identical segments.</p> <p>Synchronization Flow:</p> <pre><code>Server (GameSession)                  Client (ChunkManagerSystem)\n        |                                      |\n        | 1. Load map config (seed=0)         |\n        | 2. Generate random seed              |\n        |    seed = std::random_device()()     |\n        |                                      |\n        | 3. Initialize ProceduralMapGenerator |\n        |    with server seed                  |\n        |                                      |\n        | 4. Send seed to client        -----&gt; | 5. Receive seed from server\n        |    (via level start packet)          |\n        |                                      | 6. Call setProceduralSeed(seed)\n        |                                      |\n        | 7. Generate segment N                | 8. Generate segment N\n        |    (on-demand)                       |    (on-demand)\n        |                                      |\n        | Result: Identical segments           |\n</code></pre> <p>Implementation Status:</p> <p>\u26a0\ufe0f TODO: Seed transmission not yet implemented - Currently, both client and server use seed from map config - Need to add seed field to <code>LevelStartPacket</code> protocol - Server should send generated seed to all clients</p>"},{"location":"PROCEDURAL_GENERATION/#configuration","title":"Configuration","text":""},{"location":"PROCEDURAL_GENERATION/#map-configuration-assetsmapsnebula_outpostmapjson","title":"Map Configuration (<code>assets/maps/nebula_outpost/map.json</code>)","text":"<pre><code>{\n    \"id\": \"nebula_outpost\",\n    \"name\": \"Nebula Outpost\",\n    \"tileSize\": 16,\n    \"chunkWidth\": 30,\n    \"procedural\": {\n        \"enabled\": true,\n        \"seed\": 0,\n        \"params\": {\n            \"minPassageHeight\": 45,\n            \"stalactiteChance\": 0.25,\n            \"maxStalactiteLength\": 6,\n            \"pathVariation\": 5\n        }\n    },\n    \"tileSheet\": {\n        \"path\": \"tiles/tilesheet.png\",\n        \"walls\": { /* ... tile definitions ... */ }\n    }\n}\n</code></pre>"},{"location":"PROCEDURAL_GENERATION/#configuration-parameters","title":"Configuration Parameters","text":"Parameter Type Default Description <code>enabled</code> bool false Enable procedural generation <code>seed</code> uint32_t 0 Generation seed (0 = random) <code>minPassageHeight</code> int 45 Minimum navigable height in tiles <code>stalactiteChance</code> float 0.25 Obstacle spawn probability (0-1) <code>maxStalactiteLength</code> int 6 Maximum obstacle length in tiles <code>pathVariation</code> int 5 Path meandering intensity"},{"location":"PROCEDURAL_GENERATION/#seed-modes","title":"Seed Modes","text":"<p>Random Seed (<code>seed: 0</code>): - Server generates new seed each session - Every playthrough has unique map - Best for replayability</p> <p>Fixed Seed (<code>seed: 12345</code>): - Same map layout every time - Useful for:   - Testing and debugging   - Speedrun competitions   - Sharing specific map challenges   - Reproducible bug reports</p>"},{"location":"PROCEDURAL_GENERATION/#data-structures","title":"Data Structures","text":""},{"location":"PROCEDURAL_GENERATION/#segmentdata","title":"SegmentData","text":"<pre><code>struct SegmentData {\n    int segmentId;      // Unique segment identifier\n    int width;          // Segment width in tiles (typically 60)\n    int height;         // Segment height in tiles (typically 68)\n    std::vector&lt;std::vector&lt;int&gt;&gt; tiles;  // 2D grid: 0=empty, 1=wall\n};\n</code></pre>"},{"location":"PROCEDURAL_GENERATION/#proceduralconfig","title":"ProceduralConfig","text":"<pre><code>struct ProceduralConfig {\n    bool enabled;\n    uint32_t seed;\n    int minPassageHeight;\n    float stalactiteChance;\n    int maxStalactiteLength;\n    int pathVariation;\n};\n</code></pre>"},{"location":"PROCEDURAL_GENERATION/#chunk","title":"Chunk","text":"<pre><code>struct Chunk {\n    int segmentId;                         // Parent segment ID\n    int chunkIndex;                        // Index within segment\n    double worldX;                         // Absolute X position (pixels)\n    int width;                             // Chunk width in tiles\n    int height;                            // Chunk height in tiles\n    std::vector&lt;std::vector&lt;Tile&gt;&gt; tiles;  // Processed tiles with auto-tiling\n    bool isLoaded;                         // Load status flag\n};\n</code></pre>"},{"location":"PROCEDURAL_GENERATION/#implementation-details","title":"Implementation Details","text":""},{"location":"PROCEDURAL_GENERATION/#segment-dimensions","title":"Segment Dimensions","text":"<pre><code>Width:  60 tiles = 960 pixels (at 16px/tile)\nHeight: 68 tiles = 1088 pixels (at 16px/tile)\n\nEach segment = 60 tiles wide\nEach chunk   = 30 tiles wide\nResult: 2 chunks per segment\n</code></pre>"},{"location":"PROCEDURAL_GENERATION/#auto-tiling-integration","title":"Auto-Tiling Integration","text":"<p>The system uses a 17-variant auto-tiler to create seamless wall connections:</p> <ol> <li>Padding: Chunks include 1-tile padding from adjacent segments</li> <li>Neighbor Analysis: AutoTiler examines 8 surrounding tiles</li> <li>Variant Selection: Chooses correct tile variant (corner, edge, center, etc.)</li> <li>Rendering: ChunkManagerSystem renders processed tiles directly</li> </ol> <p>Tile Variants: - Corners: topLeft, topRight, bottomLeft, bottomRight - Edges: top, bottom, left, right - Centers: center, horizontal, vertical - Special: isolated, spike variants</p>"},{"location":"PROCEDURAL_GENERATION/#memory-management","title":"Memory Management","text":"<p>Cache Strategy:</p> <pre><code>// Static maps: pre-allocated vector\nstd::vector&lt;SegmentData&gt; m_segments;\n\n// Procedural maps: dynamic cache\nstd::unordered_map&lt;int, SegmentData&gt; m_generatedSegments;\n</code></pre> <p>Optimization Techniques: - Lazy generation: segments created only when needed - LRU eviction: old segments removed when far from player - Chunk streaming: only visible portions loaded - No entity creation on client (render-only system)</p> <p>Memory Footprint (per segment): <pre><code>Tiles: 60 \u00d7 68 \u00d7 4 bytes = 16,320 bytes\nOverhead: ~1 KB\nTotal: ~17 KB per cached segment\n</code></pre></p>"},{"location":"PROCEDURAL_GENERATION/#performance-considerations","title":"Performance Considerations","text":""},{"location":"PROCEDURAL_GENERATION/#generation-performance","title":"Generation Performance","text":"<p>Benchmarks (typical hardware): - Segment generation: &lt; 1ms - Chunk processing: &lt; 2ms - Total load time: &lt; 5ms per chunk</p> <p>Optimization: - Pre-generate segment 0 during map initialization - Generate 2-3 segments ahead of player - Use double precision for scroll tracking (prevents FP errors)</p>"},{"location":"PROCEDURAL_GENERATION/#rendering-performance","title":"Rendering Performance","text":"<p>Tile Count (typical screen): - Visible tiles: ~8,000-10,000 - Rendered sprites: only non-empty tiles - Draw calls: batched by graphics backend</p> <p>Culling: - Chunk-level: skip off-screen chunks - Tile-level: skip off-screen tiles within visible chunks</p>"},{"location":"PROCEDURAL_GENERATION/#testing-validation","title":"Testing &amp; Validation","text":""},{"location":"PROCEDURAL_GENERATION/#unit-tests","title":"Unit Tests","text":"<p>ProceduralMapGenerator: - \u2705 Deterministic output with same seed - \u2705 Minimum passage height maintained - \u2705 Smooth segment transitions - \u2705 Obstacle placement within constraints</p> <p>ChunkManagerSystem: - \u2705 Static vs procedural mode switching - \u2705 Chunk loading/unloading - \u2705 Cache management - \u2705 Segment access via getOrGenerateSegment()</p>"},{"location":"PROCEDURAL_GENERATION/#integration-tests","title":"Integration Tests","text":"<p>Client-Server Sync: - \u23f3 TODO: Seed transmission verification - \u2705 Collision boundaries match visual tiles - \u2705 Multiple clients see identical map</p> <p>Gameplay: - \u2705 Passages always navigable - \u2705 No impossible gaps or dead ends - \u2705 Long play sessions (100+ segments)</p>"},{"location":"PROCEDURAL_GENERATION/#troubleshooting","title":"Troubleshooting","text":""},{"location":"PROCEDURAL_GENERATION/#common-issues","title":"Common Issues","text":"<p>1. Tiles not visible but collisions work - Cause: Chunk loading logic checks <code>m_segments.empty()</code> in procedural mode - Fix: Check <code>m_proceduralEnabled</code> instead - Location: <code>ChunkManagerSystem::update()</code></p> <p>2. Segmentation fault on chunk load - Cause: Direct access to <code>m_segments[id]</code> in procedural mode - Fix: Use <code>getOrGenerateSegment(id)</code> everywhere - Locations: <code>update()</code>, <code>loadChunk()</code> padding logic</p> <p>3. Maps identical every playthrough - Cause: Fixed seed in config (<code>seed: 12345</code>) - Fix: Set <code>seed: 0</code> for random generation - Location: <code>map.json</code></p> <p>4. Client-server desync - Cause: Different seeds or RNG state - Fix: Ensure server sends seed to client - Status: \u23f3 TODO - seed transmission</p>"},{"location":"PROCEDURAL_GENERATION/#debug-logging","title":"Debug Logging","text":"<p>Enable verbose logging to trace generation:</p> <pre><code>// ProceduralMapGenerator.cpp\nstd::cout &lt;&lt; \"[ProceduralGen] Generating segment \" &lt;&lt; segmentId &lt;&lt; std::endl;\nstd::cout &lt;&lt; \"[ProceduralGen] Drew \" &lt;&lt; wallTilesCount &lt;&lt; \" wall tiles\" &lt;&lt; std::endl;\n\n// ChunkManagerSystem.cpp\nstd::cout &lt;&lt; \"[ChunkManagerSystem] Loading chunk - segment: \" &lt;&lt; segmentId &lt;&lt; std::endl;\nstd::cout &lt;&lt; \"[ChunkManagerSystem] Rendering \" &lt;&lt; m_activeChunks.size() &lt;&lt; \" chunks\" &lt;&lt; std::endl;\n</code></pre>"},{"location":"PROCEDURAL_GENERATION/#future-enhancements","title":"Future Enhancements","text":""},{"location":"PROCEDURAL_GENERATION/#planned-features","title":"Planned Features","text":"<ol> <li>Seed Transmission Protocol (Priority: High)</li> <li>Add seed field to LevelStartPacket</li> <li>Server broadcasts seed to all clients</li> <li> <p>Client calls <code>setProceduralSeed()</code> on receive</p> </li> <li> <p>Enhanced Generation Algorithms</p> </li> <li>Cave systems with branching paths</li> <li>Vertical shafts and multi-level areas</li> <li>Circular rooms with multiple entrances</li> <li> <p>Variable width corridors</p> </li> <li> <p>Obstacle Variety</p> </li> <li>Floating asteroids (independent of walls)</li> <li>Spinning debris fields</li> <li>Destructible obstacles</li> <li> <p>Moving hazards</p> </li> <li> <p>Biome System</p> </li> <li>Different visual themes per region</li> <li>Theme-specific obstacles</li> <li>Gradual biome transitions</li> <li> <p>Boss arena generation</p> </li> <li> <p>Difficulty Scaling</p> </li> <li>Narrower passages over time</li> <li>Increased obstacle density</li> <li>Faster path variation</li> <li>Dynamic parameter adjustment</li> </ol>"},{"location":"PROCEDURAL_GENERATION/#extensibility","title":"Extensibility","text":"<p>Adding New Procedural Maps:</p> <ol> <li>Create map config with <code>procedural.enabled: true</code></li> <li>Configure generation parameters</li> <li>Provide tileset with auto-tile variants</li> <li>(Optional) Implement custom generator subclass</li> </ol> <p>Custom Generators:</p> <pre><code>class CaveMapGenerator : public ProceduralMapGenerator {\n    SegmentData generateSegment(...) override {\n        // Custom cave generation algorithm\n    }\n};\n</code></pre>"},{"location":"PROCEDURAL_GENERATION/#references","title":"References","text":""},{"location":"PROCEDURAL_GENERATION/#related-files","title":"Related Files","text":"<p>Core Implementation: - <code>src/r-type/game-logic/include/ProceduralMapGenerator.hpp</code> - <code>src/r-type/game-logic/src/ProceduralMapGenerator.cpp</code> - <code>src/r-type/game-logic/src/ChunkManagerSystem.cpp</code> - <code>src/r-type/server/src/GameSession.cpp</code></p> <p>Data Structures: - <code>src/r-type/game-logic/include/components/MapTypes.hpp</code></p> <p>Configuration: - <code>src/r-type/game-logic/src/MapConfigLoader.cpp</code> - <code>src/r-type/assets/maps/nebula_outpost/map.json</code></p> <p>Documentation: - <code>docs/plans/procedural-generation-nebula.md</code> - Implementation plan</p>"},{"location":"PROCEDURAL_GENERATION/#external-resources","title":"External Resources","text":"<ul> <li>Procedural Generation Wiki</li> <li>Random Walk Algorithms</li> <li>Perlin Noise for Terrain</li> <li>Dungeon Generation Algorithms</li> </ul>"},{"location":"PROCEDURAL_GENERATION/#contributors","title":"Contributors","text":"<ul> <li>Implementation: Claude Sonnet 4.5</li> <li>Design: Based on R-Type architecture</li> <li>Testing: ericoed</li> </ul> <p>Document Version: 1.0 Last Updated: 2026-01-16 Status: \u2705 Implemented, \u23f3 Seed transmission pending</p>"},{"location":"PROTOCOL/","title":"R-Type Game Protocol Specification","text":"<p>Status: Draft Version: 1.1 Date: January 2026 Authors: R-Type Development Team</p>"},{"location":"PROTOCOL/#1-introduction","title":"1. Introduction","text":""},{"location":"PROTOCOL/#11-purpose","title":"1.1 Purpose","text":"<p>This document specifies the R-Type Game Protocol (RTGP), a UDP-based binary protocol for client-server communication in the R-Type multiplayer game. The protocol enables real-time gameplay synchronization, lobby management, and matchmaking for cooperative multiplayer sessions.</p>"},{"location":"PROTOCOL/#12-scope","title":"1.2 Scope","text":"<p>This protocol defines packet formats, message types, and communication patterns for: - Client authentication and connection management - Lobby system with game mode and difficulty selection - Custom room management with password protection - Matchmaking and game session initialization - Player input transmission - Game state synchronization - Entity management (players, enemies, projectiles, power-ups) - Game events and scoring</p>"},{"location":"PROTOCOL/#13-requirements-language","title":"1.3 Requirements Language","text":"<p>The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\", \"SHALL NOT\", \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\", and \"OPTIONAL\" in this document are to be interpreted as described in RFC 2119.</p>"},{"location":"PROTOCOL/#2-protocol-overview","title":"2. Protocol Overview","text":""},{"location":"PROTOCOL/#21-transport-layer","title":"2.1 Transport Layer","text":"<p>RTGP operates over UDP (User Datagram Protocol). The default server port is 4242 (configurable). Some control messages (like lobby management) may be exchanged over TCP in specific implementations, but the core gameplay loop typically relies on UDP.</p>"},{"location":"PROTOCOL/#22-packet-structure","title":"2.2 Packet Structure","text":"<p>All packets consist of a fixed-size header followed by a variable-length payload:</p> <pre><code>    0                   1                   2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |    Version    |     Type      |     Flags     | Payload Len   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |  Payload Len  |                Sequence Number                |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   | Seq Number    | Uncompressed Size (optional, if COMPRESSED)   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |Uncompressed.. |              Payload Data                     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |                         Payload Data                          |\n   |                             ...                               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n</code></pre>"},{"location":"PROTOCOL/#23-size-constraints","title":"2.3 Size Constraints","text":"<ul> <li>Maximum packet size: 1400 bytes (MTU-safe for typical network configurations)</li> <li>Base header size: 9 bytes (without compression metadata)</li> <li>Extended header size: 13 bytes (with compression metadata when COMPRESSED flag is set)</li> <li>Maximum payload size: 1387 bytes (accounting for largest possible header)</li> <li>Packets exceeding 1400 bytes MUST be fragmented or redesigned</li> </ul>"},{"location":"PROTOCOL/#24-compression","title":"2.4 Compression","text":"<p>Starting from protocol version 1.0, packets support optional LZ4 compression for large payloads:</p> <ul> <li>Compression library: LZ4 (fast compression algorithm)</li> <li>Automatic compression: Large packets are automatically compressed if beneficial</li> <li>Compressible packet types: SNAPSHOT, DELTA_SNAPSHOT, LOBBY_STATE, ROOM_LIST</li> </ul>"},{"location":"PROTOCOL/#3-packet-header","title":"3. Packet Header","text":""},{"location":"PROTOCOL/#31-header-format","title":"3.1 Header Format","text":"<p>All packets begin with a header in network byte order (big-endian). The header size is 9 bytes (base) or 13 bytes (if COMPRESSED flag is set).</p>"},{"location":"PROTOCOL/#base-header-9-bytes","title":"Base Header (9 bytes)","text":"Field Size Offset Description Version 1 byte 0 Protocol version (0x01) Type 1 byte 1 Packet type identifier Flags 1 byte 2 Packet flags (bit 0 = COMPRESSED) Payload Length 2 bytes 3 Length of payload in bytes (big-endian) Sequence Number 4 bytes 5 Monotonic sequence number (big-endian)"},{"location":"PROTOCOL/#extended-header-4-bytes-if-compressed-flag-set","title":"Extended Header (+ 4 bytes if COMPRESSED flag set)","text":"Field Size Offset Description Uncompressed Size 4 bytes 9 Original payload size before compression"},{"location":"PROTOCOL/#32-field-definitions","title":"3.2 Field Definitions","text":"<p>Version (8 bits) - MUST be set to <code>0x01</code> for this version of the protocol</p> <p>Type (8 bits) - Identifies the packet type (see Section 4)</p> <p>Flags (8 bits) - Bit 0 (0x01): <code>COMPRESSED</code> - Payload is compressed with LZ4</p> <p>Payload Length (16 bits, big-endian) - Length of the payload in bytes (compressed size if compressed)</p> <p>Uncompressed Size (32 bits, big-endian) - Optional - ONLY present if COMPRESSED flag (bit 0) is set</p> <p>Sequence Number (32 bits, big-endian) - Monotonically increasing counter per connection</p>"},{"location":"PROTOCOL/#4-packet-types","title":"4. Packet Types","text":""},{"location":"PROTOCOL/#41-type-id-allocation","title":"4.1 Type ID Allocation","text":"Range Category Description 0x01-0x04 Connection Management Connect, disconnect, keepalive 0x05-0x09 Lobby &amp; Matchmaking Join, leave, lobby state, UDP handshake 0x10-0x1F Player Input Real-time input commands 0x20-0x2F Room Management Custom rooms, room list, host control 0x30-0x3F Admin Commands (C\u2192S) Admin authentication and control 0x40-0x4F Chat System In-game and lobby chat messages 0x81-0x8A Connection &amp; Lobby (S\u2192C) Accept, reject, lobby updates 0x90-0x9F Room Management (S\u2192C) Room created, room list, room errors 0xA0-0xAF World State Game snapshots, delta updates 0xB0-0xBF Entity Events Spawn, destroy, damage, explosion 0xC0-0xCF Game Mechanics Powerups, scoring, waves, levels 0xD0-0xDF Admin Responses (S\u2192C) Admin results, notifications 0xF0-0xFF System &amp; Chat (S\u2192C) Chat broadcast, system messages"},{"location":"PROTOCOL/#42-client-to-server-packets","title":"4.2 Client-to-Server Packets","text":"Type ID Name Description 0x01 CLIENT_CONNECT Initial connection request 0x02 CLIENT_DISCONNECT Graceful disconnection 0x04 CLIENT_PING Keepalive and latency measurement 0x05 CLIENT_JOIN_LOBBY Join lobby with mode/difficulty 0x06 CLIENT_LEAVE_LOBBY Leave current lobby 0x08 CLIENT_UDP_HANDSHAKE Associate UDP with TCP session 0x10 CLIENT_INPUT Player input state 0x20 CLIENT_CREATE_ROOM Create a custom game room 0x21 CLIENT_JOIN_ROOM Join an existing custom room 0x22 CLIENT_LEAVE_ROOM Leave current custom room 0x23 CLIENT_REQUEST_ROOM_LIST Request list of available rooms 0x24 CLIENT_START_GAME Start game (host only) 0x25 CLIENT_SET_PLAYER_NAME Change player name in lobby 0x26 CLIENT_SET_PLAYER_SKIN Change player skin in lobby 0x27 CLIENT_REQUEST_GLOBAL_LEADERBOARD Request all-time top scores 0x30 CLIENT_ADMIN_AUTH Admin authentication request 0x31 CLIENT_ADMIN_COMMAND Admin command execution 0x40 CLIENT_CHAT_MESSAGE Send chat message to room/session"},{"location":"PROTOCOL/#43-server-to-client-packets","title":"4.3 Server-to-Client Packets","text":"Type ID Name Description 0x81 SERVER_ACCEPT Connection accepted 0x82 SERVER_REJECT Connection rejected 0x83 SERVER_PLAYER_JOINED Another player joined the server 0x84 SERVER_PLAYER_LEFT A player disconnected 0x85 SERVER_PONG Ping response 0x87 SERVER_LOBBY_STATE Current lobby state update 0x88 SERVER_GAME_START_COUNTDOWN Game starting countdown 0x89 SERVER_COUNTDOWN_CANCELLED Countdown cancelled (player left) 0x8A SERVER_GAME_START Game session begins 0x90 SERVER_ROOM_CREATED Custom room created successfully 0x91 SERVER_ROOM_LIST List of available custom rooms 0x92 SERVER_ROOM_JOINED Successfully joined a custom room 0x93 SERVER_ROOM_LEFT Player left a custom room 0x94 SERVER_ROOM_STATE_UPDATE Custom room state changed 0x95 SERVER_ROOM_ERROR Room operation error 0x96 SERVER_PLAYER_NAME_UPDATED Player name changed in room 0x97 SERVER_PLAYER_SKIN_UPDATED Player skin changed in room 0xA0 SERVER_SNAPSHOT Complete world state snapshot 0xA1 SERVER_DELTA_SNAPSHOT Delta-compressed state update 0xB0 SERVER_ENTITY_SPAWN New entity spawned 0xB1 SERVER_ENTITY_DESTROY Entity destroyed 0xB2 SERVER_ENTITY_DAMAGE Entity took damage 0xB3 SERVER_PROJECTILE_SPAWN Projectile fired 0xB4 SERVER_EXPLOSION_EVENT Visual explosion effect 0xC0 SERVER_POWERUP_COLLECTED Power-up collected by player 0xC1 SERVER_SCORE_UPDATE Player score updated 0xC2 SERVER_WAVE_START New enemy wave starting 0xC3 SERVER_WAVE_COMPLETE Wave completed 0xC4 SERVER_PLAYER_LEVEL_UP Player leveled up 0xC5 SERVER_PLAYER_RESPAWN Player respawned 0xC6 SERVER_GAME_OVER Game session ended 0xC7 SERVER_LEADERBOARD End-game leaderboard with all scores 0xC8 SERVER_GLOBAL_LEADERBOARD All-time global top scores 0xC9 SERVER_LEVEL_TRANSITION Transition to next game level 0xCA SERVER_LEVEL_READY Level loaded, ready for gameplay 0xD0 SERVER_ADMIN_AUTH_RESULT Admin authentication result 0xD1 SERVER_ADMIN_COMMAND_RESULT Admin command execution result 0xD2 SERVER_ADMIN_NOTIFICATION Server-wide admin notification 0xD3 SERVER_KICK_NOTIFICATION Player kicked by admin 0xF0 SERVER_CHAT_MESSAGE Chat message broadcast to players"},{"location":"PROTOCOL/#5-payload-formats","title":"5. Payload Formats","text":"<p>All multi-byte integer fields are in network byte order (big-endian) unless otherwise specified. Floating-point values use IEEE 754 single precision (32-bit) format.</p>"},{"location":"PROTOCOL/#51-connection-management-payloads","title":"5.1 Connection Management Payloads","text":""},{"location":"PROTOCOL/#511-client_connect-0x01","title":"5.1.1 CLIENT_CONNECT (0x01)","text":"<p>Size: 33 bytes - <code>Client Version</code> (1 byte) - <code>Player Name</code> (32 bytes, null-padded)</p>"},{"location":"PROTOCOL/#512-client_disconnect-0x02","title":"5.1.2 CLIENT_DISCONNECT (0x02)","text":"<p>Size: 5 bytes - <code>Player ID</code> (4 bytes) - <code>Reason</code> (1 byte)</p>"},{"location":"PROTOCOL/#513-client_ping-0x04","title":"5.1.3 CLIENT_PING (0x04)","text":"<p>Size: 8 bytes - <code>Player ID</code> (4 bytes) - <code>Client Timestamp</code> (4 bytes)</p>"},{"location":"PROTOCOL/#514-server_accept-0x81","title":"5.1.4 SERVER_ACCEPT (0x81)","text":"<p>Size: 8 bytes - <code>Assigned Player ID</code> (4 bytes) - <code>Server Tick Rate</code> (1 byte) - <code>Max Players</code> (1 byte) - <code>Map ID</code> (2 bytes)</p>"},{"location":"PROTOCOL/#515-server_reject-0x82","title":"5.1.5 SERVER_REJECT (0x82)","text":"<p>Size: 65 bytes - <code>Reason Code</code> (1 byte) - <code>Reason Message</code> (64 bytes)</p>"},{"location":"PROTOCOL/#516-client_udp_handshake-0x08","title":"5.1.6 CLIENT_UDP_HANDSHAKE (0x08)","text":"<p>Sent via UDP to establish the UDP session associated with the TCP connection. Size: 8 bytes - <code>Player ID</code> (4 bytes) - <code>Session ID</code> (4 bytes)</p>"},{"location":"PROTOCOL/#52-lobby-matchmaking-payloads","title":"5.2 Lobby &amp; Matchmaking Payloads","text":""},{"location":"PROTOCOL/#521-client_join_lobby-0x05","title":"5.2.1 CLIENT_JOIN_LOBBY (0x05)","text":"<p>Size: 6 bytes - <code>Player ID</code> (4 bytes) - <code>Game Mode</code> (1 byte) - <code>Difficulty</code> (1 byte)</p>"},{"location":"PROTOCOL/#522-server_game_start-0x8a","title":"5.2.2 SERVER_GAME_START (0x8A)","text":"<p>Size: 22 bytes (Base) + (12 * Player Count) - <code>Game Session ID</code> (4 bytes) - <code>Game Mode</code> (1 byte) - <code>Difficulty</code> (1 byte) - <code>Server Tick</code> (4 bytes) - <code>Level Seed</code> (4 bytes) - <code>UDP Port</code> (2 bytes) - Port for gameplay communication - <code>Map ID</code> (2 bytes) - Initial map/level ID - <code>Scroll Speed</code> (4 bytes, float) - <code>Player Spawns</code> (Variable array of <code>PlayerSpawnData</code>)</p>"},{"location":"PROTOCOL/#53-custom-room-management-payloads","title":"5.3 Custom Room Management Payloads","text":""},{"location":"PROTOCOL/#531-client_create_room-0x20","title":"5.3.1 CLIENT_CREATE_ROOM (0x20)","text":"<p>Size: 105 bytes - <code>Player ID</code> (4 bytes) - <code>Room Name</code> (32 bytes) - <code>Password Hash</code> (64 bytes) - <code>Game Mode</code> (1 byte) - <code>Difficulty</code> (1 byte) - <code>Map ID</code> (2 bytes) - <code>Max Players</code> (1 byte)</p>"},{"location":"PROTOCOL/#54-player-input-payloads","title":"5.4 Player Input Payloads","text":""},{"location":"PROTOCOL/#541-client_input-0x10","title":"5.4.1 CLIENT_INPUT (0x10)","text":"<p>Size: 14 bytes - <code>Player ID</code> (4 bytes) - <code>Input Flags</code> (2 bytes) - <code>Client Tick</code> (4 bytes) - <code>Sequence Number</code> (4 bytes) - Added for lag compensation and reconciliation</p>"},{"location":"PROTOCOL/#55-world-state-payloads","title":"5.5 World State Payloads","text":""},{"location":"PROTOCOL/#551-server_snapshot-0xa0","title":"5.5.1 SERVER_SNAPSHOT (0xA0)","text":"<p>Size: 10 bytes (Base) + (25 * Entity Count) - <code>Server Tick</code> (4 bytes) - <code>Entity Count</code> (2 bytes) - <code>Scroll X</code> (4 bytes, float) - Global map scroll position - <code>Entity States</code> (Variable array of <code>EntityState</code>)</p> <p>Entity State Format (25 bytes): - <code>Entity ID</code> (4 bytes) - <code>Entity Type</code> (1 byte) - <code>Position X</code> (4 bytes, float) - <code>Position Y</code> (4 bytes, float) - <code>Velocity X</code> (2 bytes, int16 scaled 100) - <code>Velocity Y</code> (2 bytes, int16 scaled 100) - <code>Health</code> (2 bytes) - <code>Flags</code> (2 bytes) - See Entity State Flags below - <code>Last Ack Sequence</code> (4 bytes) - Last processed input sequence (for players)</p> <p>Entity State Flags (bitfield): | Bit | Name              | Description                                    | |-----|-------------------|------------------------------------------------| | 0   | INVULNERABLE      | Entity is invulnerable (e.g., after respawn)   | | 1   | CHARGING          | Entity is charging an attack                   | | 2   | DAMAGED           | Entity was recently damaged (visual feedback)  | | 3   | LASER_ACTIVE      | Player is firing a laser beam (for sync)       | | 4-15| Reserved          | Reserved for future use                        |</p>"},{"location":"PROTOCOL/#552-server_explosion_event-0xb4","title":"5.5.2 SERVER_EXPLOSION_EVENT (0xB4)","text":"<p>Size: 16 bytes - <code>Source Entity ID</code> (4 bytes) - <code>Position X</code> (4 bytes, float) - <code>Position Y</code> (4 bytes, float) - <code>Effect Scale</code> (4 bytes, float)</p>"},{"location":"PROTOCOL/#56-game-mechanics-payloads","title":"5.6 Game Mechanics Payloads","text":""},{"location":"PROTOCOL/#561-server_level_transition-0xc9","title":"5.6.1 SERVER_LEVEL_TRANSITION (0xC9)","text":"<p>Size: 2 bytes - <code>Next Level ID</code> (2 bytes)</p>"},{"location":"PROTOCOL/#562-server_level_ready-0xca","title":"5.6.2 SERVER_LEVEL_READY (0xCA)","text":"<p>Size: 2 bytes - <code>Level ID</code> (2 bytes)</p>"},{"location":"PROTOCOL/#563-server_global_leaderboard-0xc8","title":"5.6.3 SERVER_GLOBAL_LEADERBOARD (0xC8)","text":"<p>Size: 1 byte (Base) + (40 * Entry Count) - <code>Entry Count</code> (1 byte) - <code>Entries</code> (Variable array of <code>GlobalLeaderboardEntry</code>)</p> <p>Global Leaderboard Entry (40 bytes): - <code>Player Name</code> (32 bytes) - <code>Score</code> (4 bytes) - <code>Timestamp</code> (4 bytes)</p>"},{"location":"PROTOCOL/#57-admin-system-payloads","title":"5.7 Admin System Payloads","text":""},{"location":"PROTOCOL/#571-client_admin_auth-0x30","title":"5.7.1 CLIENT_ADMIN_AUTH (0x30)","text":"<p>Size: 96 bytes - <code>Client ID</code> (4 bytes) - <code>Password Hash</code> (64 bytes) - <code>Username</code> (28 bytes)</p>"},{"location":"PROTOCOL/#572-client_admin_command-0x31","title":"5.7.2 CLIENT_ADMIN_COMMAND (0x31)","text":"<p>Size: 140 bytes - <code>Admin ID</code> (4 bytes) - <code>Command Length</code> (1 byte) - <code>Command String</code> (135 bytes)</p>"},{"location":"PROTOCOL/#573-server_admin_auth_result-0xd0","title":"5.7.3 SERVER_ADMIN_AUTH_RESULT (0xD0)","text":"<p>Size: 69 bytes - <code>Success</code> (1 byte) - <code>Admin Level</code> (4 bytes) - <code>Failure Reason</code> (64 bytes)</p>"},{"location":"PROTOCOL/#574-server_admin_command_result-0xd1","title":"5.7.4 SERVER_ADMIN_COMMAND_RESULT (0xD1)","text":"<p>Size: 257 bytes - <code>Success</code> (1 byte) - <code>Message</code> (256 bytes)</p>"},{"location":"PROTOCOL/#575-server_admin_notification-0xd2","title":"5.7.5 SERVER_ADMIN_NOTIFICATION (0xD2)","text":"<p>Size: 128 bytes - <code>Type</code> (1 byte) - <code>Message</code> (127 bytes)</p>"},{"location":"PROTOCOL/#576-server_kick_notification-0xd3","title":"5.7.6 SERVER_KICK_NOTIFICATION (0xD3)","text":"<p>Size: 128 bytes - <code>Reason</code> (128 bytes)</p>"},{"location":"PROTOCOL/#58-chat-system-payloads","title":"5.8 Chat System Payloads","text":""},{"location":"PROTOCOL/#581-client_chat_message-0x40","title":"5.8.1 CLIENT_CHAT_MESSAGE (0x40)","text":"<p>Sent by client to send a chat message to all players in the same room or game session.</p> <pre><code>    0                   1                   2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |                         Player ID                             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |                                                               |\n   +                       Message (128 bytes)                     +\n   |                             ...                               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n</code></pre> Field Size Description Player ID 4 bytes Sender's player ID (network byte order) Message 128 bytes Chat message (null-terminated, max 127) <p>Total Size: 132 bytes</p>"},{"location":"PROTOCOL/#582-server_chat_message-0xf0","title":"5.8.2 SERVER_CHAT_MESSAGE (0xF0)","text":"<p>Broadcast by server to all players in the same room or game session.</p> <pre><code>    0                   1                   2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |                         Sender ID                             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |                                                               |\n   +                    Sender Name (32 bytes)                     +\n   |                             ...                               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |                                                               |\n   +                       Message (128 bytes)                     +\n   |                             ...                               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |                         Timestamp                             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n</code></pre> Field Size Description Sender ID 4 bytes Sender's player ID (network byte order) Sender Name 32 bytes Sender's display name (null-terminated) Message 128 bytes Chat message (null-terminated, max 127) Timestamp 4 bytes Unix timestamp (network byte order) <p>Total Size: 168 bytes</p> <p>Usage Notes: - Chat messages are routed based on player state:   - If player is in a room lobby (<code>in_lobby=true</code>): broadcast to all players in that room   - If player is in a game session (<code>in_game=true</code>): broadcast to all players in that session - The server includes the sender's name to avoid client-side lookups - Timestamp can be used for message ordering or display purposes</p>"},{"location":"PROTOCOL/#6-entity-types","title":"6. Entity Types","text":"Code Type Description 0x01 PLAYER Player ship 0x02 ENEMY_BASIC Standard enemy 0x03 ENEMY_ELITE Stronger enemy 0x04 ENEMY_BOSS Boss enemy 0x05 PROJECTILE_PLAYER Player shots 0x06 PROJECTILE_ENEMY Enemy shots 0x07 POWERUP_WEAPON Weapon upgrade 0x08 POWERUP_SHIELD Shield bonus 0x09 POWERUP_SCORE Score bonus 0x0A ENEMY_FAST Fast enemy 0x0B ENEMY_TANK Tank enemy 0x0C POWERUP_HEALTH Health pack 0x0D POWERUP_SPEED Speed boost 0x0E WALL Environment/Obstacle"},{"location":"PROTOCOL/#7-implementation-notes","title":"7. Implementation Notes","text":""},{"location":"PROTOCOL/#71-byte-order-packing","title":"7.1 Byte Order &amp; Packing","text":"<ul> <li>Network Byte Order (Big-Endian) is used for multi-byte integers.</li> <li>All structures are packed (<code>__attribute__((packed))</code>) to prevent padding.</li> </ul>"},{"location":"PROTOCOL/#72-lag-compensation","title":"7.2 Lag Compensation","text":"<ul> <li><code>CLIENT_INPUT</code> includes a <code>Sequence Number</code>.</li> <li><code>SERVER_SNAPSHOT</code> Entity States include <code>Last Ack Sequence</code>.</li> <li>Clients use these for reconciliation/prediction.</li> </ul>"},{"location":"PROTOCOL/#73-security","title":"7.3 Security","text":"<ul> <li>Admin passwords are hashed (SHA-256) before transmission.</li> <li>UDP Handshake uses Session IDs to prevent spoofing.</li> </ul>"},{"location":"RELEASE/","title":"Guide de Cr\u00e9ation de Releases","text":"<p>Ce document explique comment cr\u00e9er des releases Windows pour le jeu R-Type avec un installer automatique.</p>"},{"location":"RELEASE/#vue-densemble","title":"Vue d'ensemble","text":"<p>Le projet utilise : - NSIS (Nullsoft Scriptable Install System) pour cr\u00e9er l'installer Windows - GitHub Actions pour automatiser la compilation et la cr\u00e9ation des releases - PowerShell scripts pour la pr\u00e9paration locale des fichiers</p>"},{"location":"RELEASE/#methode-1-release-automatique-via-github-actions-recommande","title":"M\u00e9thode 1 : Release Automatique via GitHub Actions (Recommand\u00e9)","text":""},{"location":"RELEASE/#prerequis","title":"Pr\u00e9requis","text":"<ul> <li>Acc\u00e8s push au repository GitHub</li> <li>Droits pour cr\u00e9er des tags</li> </ul>"},{"location":"RELEASE/#etapes","title":"\u00c9tapes","text":"<ol> <li> <p>Pr\u00e9parer votre code <pre><code>git add .\ngit commit -m \"Prepare release v1.0.0\"\ngit push origin main\n</code></pre></p> </li> <li> <p>Cr\u00e9er un tag de version <pre><code># Format: v[MAJOR].[MINOR].[PATCH]\ngit tag v1.0.0\ngit push origin v1.0.0\n</code></pre></p> </li> <li> <p>Attendre la compilation</p> </li> <li>GitHub Actions d\u00e9tecte automatiquement le tag</li> <li>La compilation Windows d\u00e9marre automatiquement</li> <li> <p>Dur\u00e9e estim\u00e9e : 15-30 minutes</p> </li> <li> <p>V\u00e9rifier la release</p> </li> <li>Allez sur <code>https://github.com/[votre-repo]/releases</code></li> <li>La release appara\u00eet avec deux fichiers :<ul> <li><code>RType-Setup.exe</code> : Installer Windows</li> <li><code>RType-Windows-x64.zip</code> : Version portable</li> </ul> </li> </ol>"},{"location":"RELEASE/#declencher-manuellement","title":"D\u00e9clencher Manuellement","text":"<p>Vous pouvez aussi d\u00e9clencher la compilation manuellement :</p> <ol> <li>Allez dans l'onglet \"Actions\" sur GitHub</li> <li>S\u00e9lectionnez \"Windows Release Build\"</li> <li>Cliquez sur \"Run workflow\"</li> <li>Choisissez la branche et lancez</li> </ol>"},{"location":"RELEASE/#methode-2-compilation-locale-de-linstaller","title":"M\u00e9thode 2 : Compilation Locale de l'Installer","text":""},{"location":"RELEASE/#prerequis_1","title":"Pr\u00e9requis","text":"<ol> <li>Windows 10/11 avec Visual Studio 2022</li> <li>NSIS : T\u00e9l\u00e9charger depuis nsis.sourceforge.io</li> <li>vcpkg : D\u00e9j\u00e0 inclus dans le projet</li> </ol>"},{"location":"RELEASE/#etapes_1","title":"\u00c9tapes","text":"<ol> <li> <p>Compiler le projet <pre><code># Depuis la racine du projet\n.\\build.bat\n# Ou manuellement avec CMake\ncmake -B build -DCMAKE_BUILD_TYPE=Release\ncmake --build build --config Release\n</code></pre></p> </li> <li> <p>Pr\u00e9parer les fichiers pour l'installer <pre><code>cd installer\n.\\prepare-installer.ps1\n</code></pre></p> </li> </ol> <p>Ce script :    - Copie les ex\u00e9cutables (client et serveur)    - Copie les plugins (.dll)    - Copie les d\u00e9pendances vcpkg    - Copie les assets    - Cr\u00e9e un dossier <code>build/installer-package</code></p> <ol> <li>V\u00e9rifier le contenu <pre><code>Get-ChildItem build\\installer-package -Recurse\n</code></pre></li> </ol> <p>Vous devriez voir :    <pre><code>\u251c\u2500\u2500 r_type_client.exe\n\u251c\u2500\u2500 r_type_server.exe\n\u251c\u2500\u2500 *.dll (d\u00e9pendances)\n\u251c\u2500\u2500 plugins\\\n\u2502   \u251c\u2500\u2500 raylib_graphics.dll\n\u2502   \u251c\u2500\u2500 asio_network.dll\n\u2502   \u251c\u2500\u2500 miniaudio_audio.dll\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 assets\\\n    \u2514\u2500\u2500 fonts\\\n</code></pre></p> <ol> <li> <p>Copier les fichiers vers le r\u00e9pertoire build <pre><code>Copy-Item build\\installer-package\\* build\\ -Recurse -Force\n</code></pre></p> </li> <li> <p>Cr\u00e9er l'installer avec NSIS <pre><code># Depuis la racine du projet\nmakensis installer\\rtype-installer.nsi\n</code></pre></p> </li> <li> <p>L'installer est cr\u00e9\u00e9</p> </li> <li>Fichier : <code>installer/RType-Setup.exe</code></li> <li>Taille : ~50-100 MB (selon les d\u00e9pendances)</li> </ol>"},{"location":"RELEASE/#structure-de-linstaller","title":"Structure de l'Installer","text":"<p>L'installer NSIS : - \u2705 Installe dans <code>C:\\Program Files\\R-Type</code> par d\u00e9faut - \u2705 Cr\u00e9e des raccourcis dans le menu D\u00e9marrer - \u2705 Cr\u00e9e un raccourci sur le Bureau - \u2705 Ajoute une entr\u00e9e \"Ajout/Suppression de programmes\" - \u2705 Inclut un d\u00e9sinstalleur - \u2705 V\u00e9rifie Windows 64-bit - \u2705 Support multilingue (Anglais/Fran\u00e7ais)</p>"},{"location":"RELEASE/#tester-linstaller","title":"Tester l'Installer","text":"<ol> <li> <p>Installation <pre><code># Lancer l'installer\n.\\installer\\RType-Setup.exe\n</code></pre></p> </li> <li> <p>V\u00e9rification</p> </li> <li>Lancer R-Type depuis le menu D\u00e9marrer</li> <li>V\u00e9rifier que le jeu se lance correctement</li> <li> <p>Tester le client et le serveur</p> </li> <li> <p>D\u00e9sinstallation</p> </li> <li>Via le menu D\u00e9marrer &gt; R-Type &gt; Uninstall</li> <li>Ou via Param\u00e8tres Windows &gt; Applications</li> </ol>"},{"location":"RELEASE/#versioning","title":"Versioning","text":"<p>Suivez Semantic Versioning :</p> <ul> <li>MAJOR : Changements incompatibles (v2.0.0)</li> <li>MINOR : Nouvelles fonctionnalit\u00e9s compatibles (v1.1.0)</li> <li>PATCH : Corrections de bugs (v1.0.1)</li> </ul> <p>Exemples : <pre><code>git tag v1.0.0  # Premi\u00e8re release\ngit tag v1.0.1  # Correction de bug\ngit tag v1.1.0  # Nouvelle fonctionnalit\u00e9\ngit tag v2.0.0  # Changement majeur\n</code></pre></p>"},{"location":"RELEASE/#troubleshooting","title":"Troubleshooting","text":""},{"location":"RELEASE/#probleme-dll-manquantes","title":"Probl\u00e8me : \"DLL manquantes\"","text":"<p>Solution : V\u00e9rifier que vcpkg a bien compil\u00e9 les d\u00e9pendances <pre><code>ls vcpkg\\installed\\x64-windows\\bin\\*.dll\n</code></pre></p>"},{"location":"RELEASE/#probleme-plugins-non-trouves","title":"Probl\u00e8me : \"Plugins non trouv\u00e9s\"","text":"<p>Solution : V\u00e9rifier que les plugins sont compil\u00e9s <pre><code>ls build\\plugins\\*.dll\n# Ou\nls build\\Release\\plugins\\*.dll\n</code></pre></p>"},{"location":"RELEASE/#probleme-nsis-ne-trouve-pas-les-fichiers","title":"Probl\u00e8me : \"NSIS ne trouve pas les fichiers\"","text":"<p>Solution : V\u00e9rifier que les fichiers sont bien copi\u00e9s dans <code>build/</code> <pre><code># Re-ex\u00e9cuter le script de pr\u00e9paration\ncd installer\n.\\prepare-installer.ps1\n\n# Copier manuellement si n\u00e9cessaire\nCopy-Item build\\installer-package\\* build\\ -Recurse -Force\n</code></pre></p>"},{"location":"RELEASE/#probleme-github-action-echoue","title":"Probl\u00e8me : \"GitHub Action \u00e9choue\"","text":"<p>Solutions possibles : 1. V\u00e9rifier que <code>vcpkg.json</code> est \u00e0 jour 2. V\u00e9rifier que le CMakeLists.txt compile correctement 3. Consulter les logs dans l'onglet \"Actions\" 4. V\u00e9rifier que tous les fichiers n\u00e9cessaires existent</p>"},{"location":"RELEASE/#fichiers-importants","title":"Fichiers Importants","text":"<ul> <li><code>installer/rtype-installer.nsi</code> : Script NSIS</li> <li><code>.github/workflows/windows-release.yml</code> : GitHub Action</li> <li><code>installer/prepare-installer.ps1</code> : Script de pr\u00e9paration</li> <li><code>vcpkg.json</code> : D\u00e9pendances vcpkg</li> <li><code>CMakeLists.txt</code> : Configuration CMake</li> </ul>"},{"location":"RELEASE/#checklist-de-release","title":"Checklist de Release","text":"<p>Avant de cr\u00e9er une release, v\u00e9rifier :</p> <ul> <li>[ ] Le code compile sans erreurs</li> <li>[ ] Les tests passent</li> <li>[ ] La version est mise \u00e0 jour dans le code si n\u00e9cessaire</li> <li>[ ] Le CHANGELOG est \u00e0 jour (si vous en avez un)</li> <li>[ ] Les assets sont \u00e0 jour</li> <li>[ ] Un tag git est cr\u00e9\u00e9 avec le bon format (v1.0.0)</li> <li>[ ] La GitHub Action passe avec succ\u00e8s</li> <li>[ ] L'installer a \u00e9t\u00e9 test\u00e9 sur une machine propre</li> </ul>"},{"location":"RELEASE/#distribution","title":"Distribution","text":"<p>Une fois la release cr\u00e9\u00e9e :</p> <ol> <li>GitHub Releases : Automatique via GitHub Actions</li> <li>Partage direct : Distribuer <code>RType-Setup.exe</code></li> <li>Version portable : Distribuer <code>RType-Windows-x64.zip</code></li> </ol>"},{"location":"RELEASE/#support-multi-plateforme","title":"Support Multi-plateforme","text":"<p>Pour l'instant, seul Windows est support\u00e9 pour les releases automatiques.</p> <p>Pour supporter Linux/macOS : - Cr\u00e9er des GitHub Actions similaires pour Linux (.deb, .AppImage) - Cr\u00e9er des GitHub Actions pour macOS (.dmg)</p>"},{"location":"RELEASE/#ressources","title":"Ressources","text":"<ul> <li>NSIS Documentation</li> <li>GitHub Actions Documentation</li> <li>Semantic Versioning</li> <li>vcpkg Documentation</li> </ul> <p>Pour toute question, consultez la documentation principale ou ouvrez une issue sur GitHub.</p>"},{"location":"SERVER_ARCHITECTURE/","title":"R-Type Server Architecture","text":""},{"location":"SERVER_ARCHITECTURE/#overview","title":"Overview","text":"<p>The R-Type server is a hybrid TCP/UDP network application that manages client connections, game lobbies, and multiplayer game sessions.</p>"},{"location":"SERVER_ARCHITECTURE/#global-architecture","title":"Global Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       Server                            \u2502\n\u2502  (Orchestration and player management)                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502  \u2502  Network    \u2502  \u2502  Packet      \u2502  \u2502  GameSession   \u2502\u2502\n\u2502  \u2502  Handler    \u2502  \u2502  Sender      \u2502  \u2502  Manager       \u2502\u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502         \u2502                 \u2502                  \u2502         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502                 \u2502                  \u2502\n          \u25bc                 \u25bc                  \u25bc\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502 INetwork      \u2502 \u2502 INetwork     \u2502 \u2502 GameSession     \u2502\n  \u2502 Plugin        \u2502 \u2502 Plugin       \u2502 \u2502 (instances)     \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"SERVER_ARCHITECTURE/#main-components","title":"Main Components","text":""},{"location":"SERVER_ARCHITECTURE/#1-server-main-class","title":"1. Server (Main Class)","text":"<p>File: <code>src/r-type/server/include/Server.hpp</code></p> <p>Responsibilities: - Orchestration of all components - Server lifecycle management (start/stop/run) - Connected player list management - Coordination between lobbies and game sessions</p> <p>Key Members: <pre><code>class Server {\nprivate:\n    // Components\n    std::unique_ptr&lt;NetworkHandler&gt; network_handler_;\n    std::unique_ptr&lt;PacketSender&gt; packet_sender_;\n    std::unique_ptr&lt;GameSessionManager&gt; session_manager_;\n\n    // State\n    std::unordered_map&lt;uint32_t, PlayerInfo&gt; connected_clients_;\n    LobbyManager lobby_manager_;\n\n    // Network\n    engine::INetworkPlugin* network_plugin_;\n};\n</code></pre></p> <p>Main Methods: - <code>bool start()</code> - Initialize and start the server - <code>void run()</code> - Main server loop (60 TPS) - <code>void stop()</code> - Graceful server shutdown</p>"},{"location":"SERVER_ARCHITECTURE/#2-networkhandler","title":"2. NetworkHandler","text":"<p>File: <code>src/r-type/server/include/NetworkHandler.hpp</code></p> <p>Responsibilities: - Network packet reception and decoding - Protocol version validation - Packet routing to appropriate handlers</p> <p>Architecture: <pre><code>NetworkHandler::process_packets()\n    \u2193\nreceive() \u2192 decode_header() \u2192 validate_version()\n    \u2193\nroute_packet()\n    \u251c\u2500\u2192 handle_tcp_packet() \u2192 callback (CLIENT_CONNECT, etc.)\n    \u2514\u2500\u2192 handle_udp_packet() \u2192 callback (CLIENT_INPUT, etc.)\n</code></pre></p> <p>Available Callbacks: - <code>on_client_connect</code> - New client connection - <code>on_client_disconnect</code> - Client disconnection - <code>on_client_ping</code> - Ping request - <code>on_client_join_lobby</code> - Join lobby request - <code>on_client_leave_lobby</code> - Leave lobby request - <code>on_udp_handshake</code> - UDP handshake - <code>on_client_input</code> - Player input - <code>on_client_chat_message</code> - Player chat message</p>"},{"location":"SERVER_ARCHITECTURE/#3-packetsender","title":"3. PacketSender","text":"<p>File: <code>src/r-type/server/include/PacketSender.hpp</code></p> <p>Responsibilities: - TCP packet sending (reliable, ordered) - UDP packet sending (fast, unreliable) - Broadcasting to lobbies and sessions</p> <p>Main Methods:</p> <p>TCP: - <code>send_tcp_packet(client_id, type, payload)</code> - Unicast send - <code>broadcast_tcp_packet(type, payload)</code> - Send to all clients - <code>broadcast_tcp_to_lobby(lobby_id, type, payload)</code> - Send to lobby</p> <p>UDP: - <code>send_udp_packet(client_id, type, payload)</code> - Unicast send - <code>broadcast_udp_to_session(session_id, type, payload)</code> - Send to session</p> <p>Packet Format: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Version   \u2502  Type  \u2502  Payload    \u2502   Sequence   \u2502 Payload \u2502\n\u2502  (1 byte)  \u2502(1 byte)\u2502  Length     \u2502   Number     \u2502  Data   \u2502\n\u2502            \u2502        \u2502  (2 bytes)  \u2502  (4 bytes)   \u2502         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p>"},{"location":"SERVER_ARCHITECTURE/#4-gamesessionmanager","title":"4. GameSessionManager","text":"<p>File: <code>src/r-type/server/include/GameSessionManager.hpp</code></p> <p>Responsibilities: - Game session creation and destruction - Update of all active sessions - Automatic cleanup of inactive sessions - Session callback configuration</p> <p>Session Lifecycle: <pre><code>create_session()\n    \u2193\nsetup_callbacks()\n    \u2193\nupdate_all(delta_time)  [Called each tick]\n    \u2193\ncleanup_inactive_sessions()\n    \u2193\nremove_session() / on_game_over()\n</code></pre></p> <p>Session Callbacks: - <code>on_state_snapshot</code> - Entity state snapshot - <code>on_entity_spawn</code> - New entity spawn - <code>on_entity_destroy</code> - Entity destruction - <code>on_projectile_spawn</code> - Projectile spawn - <code>on_wave_start</code> - Wave start - <code>on_wave_complete</code> - Wave completion - <code>on_game_over</code> - Game over</p>"},{"location":"SERVER_ARCHITECTURE/#5-lobbymanager","title":"5. LobbyManager","text":"<p>File: <code>src/r-type/server/include/LobbyManager.hpp</code></p> <p>Responsibilities: - Game lobby management (creation/deletion) - Player matchmaking - Pre-game countdown - Lobby state notification</p> <p>Lobby States: <pre><code>WAITING (&lt; min_players)\n    \u2193\nREADY (&gt;= min_players)\n    \u2193\nCOUNTDOWN (10 seconds)\n    \u2193\nSTARTING\n    \u2193\n[Game Session created]\n</code></pre></p>"},{"location":"SERVER_ARCHITECTURE/#network-flow","title":"Network Flow","text":""},{"location":"SERVER_ARCHITECTURE/#client-connection","title":"Client Connection","text":"<pre><code>Client                  Server\n  \u2502                       \u2502\n  \u251c\u2500\u2500\u25ba CLIENT_CONNECT \u2500\u2500\u2500\u25ba\u2502\n  \u2502                       \u251c\u2500\u25ba Validate packet\n  \u2502                       \u251c\u2500\u25ba Create PlayerInfo\n  \u2502                       \u251c\u2500\u25ba Assign player_id\n  \u2502                       \u2502\n  \u2502\u25c4\u2500\u2500\u2500 SERVER_ACCEPT \u2500\u2500\u2500\u2500\u2524\n  \u2502                       \u2502\n</code></pre>"},{"location":"SERVER_ARCHITECTURE/#game-creation-and-start","title":"Game Creation and Start","text":"<pre><code>Client 1, 2, 3          Server                    GameSession\n  \u2502                       \u2502                           \u2502\n  \u251c\u2500\u2500\u25ba JOIN_LOBBY \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                           \u2502\n  \u2502                       \u251c\u2500\u25ba lobby_manager.join()    \u2502\n  \u2502\u25c4\u2500\u2500\u2500 LOBBY_STATE \u2500\u2500\u2500\u2500\u2500\u2500\u2524                           \u2502\n  \u2502                       \u2502                           \u2502\n  \u2502     [Min players reached]                         \u2502\n  \u2502                       \u2502                           \u2502\n  \u2502\u25c4\u2500\u2500\u2500 COUNTDOWN (10) \u2500\u2500\u2500\u2524                           \u2502\n  \u2502\u25c4\u2500\u2500\u2500 COUNTDOWN (9) \u2500\u2500\u2500\u2500\u2524                           \u2502\n  \u2502        ...            \u2502                           \u2502\n  \u2502\u25c4\u2500\u2500\u2500 COUNTDOWN (1) \u2500\u2500\u2500\u2500\u2524                           \u2502\n  \u2502                       \u2502                           \u2502\n  \u2502\u25c4\u2500\u2500\u2500 GAME_START \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\u2500\u2500\u25ba create_session() \u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502                       \u2502                           \u2502\n  \u251c\u2500\u2500\u25ba UDP_HANDSHAKE \u2500\u2500\u2500\u2500\u25ba\u2502\u2500\u2500\u25ba associate_udp()       \u2502\n  \u2502                       \u2502                           \u2502\n  \u2502\u25c4\u2550\u2550\u2550 ENTITY_SPAWN \u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2502\n  \u2502\u25c4\u2550\u2550\u2550 WAVE_START \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2502\n  \u2502                       \u2502                           \u2502\n</code></pre> <p>Legend: <code>\u2500\u2500\u2500\u25ba</code> TCP, <code>\u2550\u2550\u2550\u25ba</code> UDP</p>"},{"location":"SERVER_ARCHITECTURE/#chat-flow","title":"Chat Flow","text":"<pre><code>Client 1                Server                    Client 2, 3, 4\n  \u2502                       \u2502                           \u2502\n  \u251c\u2500\u2500\u25ba CLIENT_CHAT_MSG \u2500\u2500\u25ba\u2502                           \u2502\n  \u2502     (message)         \u2502                           \u2502\n  \u2502                       \u251c\u2500\u25ba lookup player_id        \u2502\n  \u2502                       \u2502   get player_name         \u2502\n  \u2502                       \u2502                           \u2502\n  \u2502                       \u251c\u2500\u25ba determine scope:        \u2502\n  \u2502                       \u2502   - in_lobby \u2192 broadcast  \u2502\n  \u2502                       \u2502     to lobby members      \u2502\n  \u2502                       \u2502   - in_game \u2192 broadcast   \u2502\n  \u2502                       \u2502     to session members    \u2502\n  \u2502                       \u2502                           \u2502\n  \u2502\u25c4\u2500\u2500 SERVER_CHAT_MSG \u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\n  \u2502     (sender_name,     \u2502                           \u2502\n  \u2502      message)         \u2502                           \u2502\n</code></pre> <p>The server routes chat messages based on player state: - In lobby: Broadcast to same lobby members (<code>in_lobby</code> &amp;&amp; <code>lobby_id</code>) - In game: Broadcast to same session members (<code>in_game</code> &amp;&amp; <code>session_id</code>)</p>"},{"location":"SERVER_ARCHITECTURE/#game-loop","title":"Game Loop","text":"<pre><code>Client                  Server                    GameSession\n  \u2502                       \u2502                           \u2502\n  \u251c\u2550\u2550\u25ba CLIENT_INPUT \u2550\u2550\u2550\u2550\u2550\u25ba\u2502\u2500\u2500\u25ba handle_input() \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502     (30 Hz)           \u2502                           \u2502\n  \u2502                       \u2502                           \u2502\n  \u2502                       \u2502      update(dt)           \u2502\n  \u2502                       \u2502          \u251c\u2500\u25ba MovementSystem\n  \u2502                       \u2502          \u251c\u2500\u25ba CollisionSystem\n  \u2502                       \u2502          \u251c\u2500\u25ba AISystem\n  \u2502                       \u2502          \u2514\u2500\u25ba etc.\n  \u2502                       \u2502                           \u2502\n  \u2502\u25c4\u2550\u2550\u2550 DELTA_SNAPSHOT \u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2502\n  \u2502     (60 Hz)           \u2502                           \u2502\n  \u2502                       \u2502                           \u2502\n</code></pre>"},{"location":"SERVER_ARCHITECTURE/#network-protocol","title":"Network Protocol","text":""},{"location":"SERVER_ARCHITECTURE/#tcpudp-separation","title":"TCP/UDP Separation","text":"<p>TCP (Default port 4242): - Connection/Disconnection - Lobby management - Control messages - Important notifications</p> <p>UDP (Default port 4243): - Player inputs - State snapshots - Entity spawn/destroy - Projectiles</p>"},{"location":"SERVER_ARCHITECTURE/#packet-types","title":"Packet Types","text":"<p>TCP - Client \u2192 Server: - <code>CLIENT_CONNECT</code> - Connection request - <code>CLIENT_DISCONNECT</code> - Voluntary disconnection - <code>CLIENT_PING</code> - Latency measurement - <code>CLIENT_JOIN_LOBBY</code> - Join lobby - <code>CLIENT_LEAVE_LOBBY</code> - Leave lobby - <code>CLIENT_CHAT_MESSAGE</code> - Chat message</p> <p>TCP - Server \u2192 Client: - <code>SERVER_ACCEPT</code> - Connection acceptance - <code>SERVER_REJECT</code> - Connection rejection - <code>SERVER_PONG</code> - Ping response - <code>SERVER_LOBBY_STATE</code> - Lobby state - <code>SERVER_GAME_START_COUNTDOWN</code> - Countdown - <code>SERVER_GAME_START</code> - Game start - <code>SERVER_CHAT_MESSAGE</code> - Chat message broadcast</p> <p>UDP - Client \u2192 Server: - <code>CLIENT_UDP_HANDSHAKE</code> - UDP/TCP association - <code>CLIENT_INPUT</code> - Player input</p> <p>UDP - Server \u2192 Client: - <code>SERVER_DELTA_SNAPSHOT</code> - Entity state - <code>SERVER_ENTITY_SPAWN</code> - Entity spawn - <code>SERVER_ENTITY_DESTROY</code> - Entity destruction - <code>SERVER_PROJECTILE_SPAWN</code> - Projectile spawn - <code>SERVER_WAVE_START</code> - Wave start - <code>SERVER_WAVE_COMPLETE</code> - Wave completion - <code>SERVER_GAME_OVER</code> - Game over</p>"},{"location":"SERVER_ARCHITECTURE/#configuration","title":"Configuration","text":"<p>File: <code>src/r-type/server/include/ServerConfig.hpp</code></p> <p>Important Constants: <pre><code>namespace rtype::server::config {\n    constexpr uint16_t DEFAULT_TCP_PORT = 4242;\n    constexpr uint16_t DEFAULT_UDP_PORT = 4243;\n    constexpr uint32_t SERVER_TICK_RATE = 60;      // 60 TPS\n    constexpr uint32_t TICK_INTERVAL_MS = 16;      // ~16ms\n    constexpr uint32_t MAX_PLAYERS_PER_LOBBY = 4;\n}\n</code></pre></p>"},{"location":"SERVER_ARCHITECTURE/#player-management","title":"Player Management","text":""},{"location":"SERVER_ARCHITECTURE/#playerinfo-structure","title":"PlayerInfo Structure","text":"<pre><code>struct PlayerInfo {\n    uint32_t client_id;      // TCP connection ID\n    uint32_t player_id;      // Unique player ID\n    std::string player_name;\n    uint32_t udp_client_id;  // UDP connection ID\n    bool in_lobby;\n    uint32_t lobby_id;\n    bool in_game;\n    uint32_t session_id;\n};\n</code></pre>"},{"location":"SERVER_ARCHITECTURE/#player-lifecycle","title":"Player Lifecycle","text":"<pre><code>1. TCP connection\n   \u2193\n2. player_id assignment\n   \u2193\n3. Acceptance (SERVER_ACCEPT)\n   \u2193\n4. Join lobby\n   \u2193\n5. UDP handshake\n   \u2193\n6. Game start\n   \u2193\n7. In game (receiving inputs, sending snapshots)\n   \u2193\n8. Game over\n   \u2193\n9. Return to lobby or disconnection\n</code></pre>"},{"location":"SERVER_ARCHITECTURE/#error-handling","title":"Error Handling","text":""},{"location":"SERVER_ARCHITECTURE/#unexpected-disconnection","title":"Unexpected Disconnection","text":"<p>The server detects disconnections via: - TCP timeout (no keepalive) - Network plugin <code>on_client_disconnected</code> callback</p> <p>Action: - Remove from lobby if applicable - Notify other lobby players - Resource cleanup</p>"},{"location":"SERVER_ARCHITECTURE/#invalid-packets","title":"Invalid Packets","text":"<ul> <li>Protocol version validation</li> <li>Payload size validation</li> <li>Error logging without crash</li> </ul>"},{"location":"SERVER_ARCHITECTURE/#orphaned-session","title":"Orphaned Session","text":"<p>The <code>GameSessionManager</code> automatically cleans up inactive sessions each tick.</p>"},{"location":"SERVER_ARCHITECTURE/#performance","title":"Performance","text":""},{"location":"SERVER_ARCHITECTURE/#tick-rate","title":"Tick Rate","text":"<ul> <li>Server: 60 TPS (Ticks Per Second)</li> <li>Client Input: ~30 Hz</li> <li>State Snapshot: 60 Hz</li> </ul>"},{"location":"SERVER_ARCHITECTURE/#optimizations","title":"Optimizations","text":"<ol> <li>Delta Snapshots: Only changed entities are sent</li> <li>Entity Prioritization: Snapshots prioritize critical entities:</li> <li>PLAYER (maximum priority) - always included</li> <li>PROJECTILE (high priority) - included for precise gameplay</li> <li>ENEMY (medium priority) - included for synchronization</li> <li>WALL excluded from snapshots (predictable scrolling client-side)</li> <li>Snapshot Size Limit: Maximum 55 entities per snapshot (payload 1387 bytes / 25 bytes per EntityState)</li> <li>UDP for gameplay: Latency reduction</li> <li>Entity Pooling: Reuse of destroyed entities</li> <li>Spatial Partitioning: For collisions (in GameSession)</li> </ol>"},{"location":"SERVER_ARCHITECTURE/#deployment","title":"Deployment","text":""},{"location":"SERVER_ARCHITECTURE/#compilation","title":"Compilation","text":"<pre><code>cmake -B build\ncmake --build build --target r-type_server\n</code></pre>"},{"location":"SERVER_ARCHITECTURE/#execution","title":"Execution","text":"<pre><code># Default ports (4242 TCP, 4243 UDP)\n./r-type_server\n\n# Custom ports\n./r-type_server &lt;tcp_port&gt; &lt;udp_port&gt;\n</code></pre>"},{"location":"SERVER_ARCHITECTURE/#logs","title":"Logs","text":"<p>The server displays: - Startup state - Connections/Disconnections - Lobby creation/destruction - Game start/end - Network errors</p>"},{"location":"SERVER_ARCHITECTURE/#dependencies","title":"Dependencies","text":"<ul> <li>game_engine: ECS, systems, plugins</li> <li>rtype_logic: Game logic (collision, AI, etc.)</li> <li>Boost.Asio: Network plugin</li> <li>Protocol: Shared client/server headers</li> </ul>"},{"location":"SERVER_ARCHITECTURE/#complete-sequence-diagram","title":"Complete Sequence Diagram","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502Client\u2502  \u2502 Server \u2502  \u2502NetworkHandler\u2502  \u2502 LobbyManager  \u2502  \u2502GameSession  \u2502\n\u2514\u2500\u2500\u252c\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   \u2502          \u2502               \u2502                  \u2502                 \u2502\n   \u251c\u2500CONNECT\u2500\u25ba\u2502               \u2502                  \u2502                 \u2502\n   \u2502          \u251c\u2500receive()\u2500\u2500\u2500\u2500\u25ba\u2502                  \u2502                 \u2502\n   \u2502          \u2502               \u251c\u2500decode()         \u2502                 \u2502\n   \u2502          \u2502               \u251c\u2500route()          \u2502                 \u2502\n   \u2502          \u2502\u25c4\u2500\u2500callback\u2500\u2500\u2500\u2500\u2524                  \u2502                 \u2502\n   \u2502          \u251c\u2500create_player()                  \u2502                 \u2502\n   \u2502\u25c4\u2500ACCEPT\u2500\u2500\u2524               \u2502                  \u2502                 \u2502\n   \u2502          \u2502               \u2502                  \u2502                 \u2502\n   \u251cJOIN_LOBBY\u2502               \u2502                  \u2502                 \u2502\n   \u2502          \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\u2500\u2500callback\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                 \u2502\n   \u2502          \u2502               \u2502                  \u251c\u2500join()          \u2502\n   \u2502\u25c4LOBBY\u2500\u2500\u2500\u2500\u2524\u25c4\u2500\u2500broadcast\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                 \u2502\n   \u2502  STATE   \u2502               \u2502                  \u2502                 \u2502\n   \u2502          \u2502               \u2502           [countdown loop]         \u2502\n   \u2502\u25c4COUNTDOWN\u2524\u25c4\u2500\u2500broadcast\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                 \u2502\n   \u2502          \u2502               \u2502                  \u2502                 \u2502\n   \u2502          \u2502               \u2502                  \u251c\u2500on_game_start() \u2502\n   \u2502          \u2502               \u2502                  \u2502                 \u2502\n   \u2502\u25c4GAME_\u2500\u2500\u2500\u2500\u2524               \u2502                  \u251c\u2500\u2500create\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n   \u2502  START   \u2502               \u2502                  \u2502                 \u2502\n   \u2502          \u2502               \u2502                  \u2502                 \u251c\u2500setup()\n   \u251cUDP_HAND\u2500\u25ba\u2502               \u2502                  \u2502                 \u2502\n   \u2502  SHAKE   \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\u2500\u2500callback\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\n   \u2502          \u2502               \u2502                  \u2502                 \u251cassociate\n   \u2502          \u2502               \u2502                  \u2502                 \u2502\n   \u2502          \u2502               \u2502                [game loop 60Hz]    \u2502\n   \u2502          \u2502               \u2502                  \u2502                 \u2502\n   \u251c\u2550INPUT\u2550\u2550\u2550\u25ba\u2502\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u25ba\n   \u2502          \u2502               \u2502                  \u2502                 \u251c\u2500update()\n   \u2502\u25c4\u2550SNAPSHOT\u2502\u25c4\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2524\n   \u2502          \u2502               \u2502                  \u2502                 \u2502\n   \u2502          \u2502               \u2502                [game over]         \u2502\n   \u2502          \u2502               \u2502                  \u2502                 \u2502\n   \u2502\u25c4GAME_\u2500\u2500\u2500\u2500\u2524\u25c4\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256c\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2524\n   \u2502  OVER    \u2502               \u2502                  \u2502                 \u2502\n   \u2502          \u2502               \u2502                  \u2502                 \u25bc\n</code></pre>"},{"location":"SERVER_ARCHITECTURE/#conclusion","title":"Conclusion","text":"<p>The server's modular architecture enables: - Maintainability: Easy-to-understand and modify code - Extensibility: Simplified addition of new features - Testability: Each component can be tested independently - Performance: High tick rate with network optimizations - Robustness: Error handling and automatic cleanup</p>"},{"location":"SERVER_DEVELOPMENT_GUIDE/","title":"R-Type Server Development Guide","text":"<p>This guide outlines the architecture and implementation steps for the R-Type Server MVP. It is based on the existing ECS architecture, the shared protocol definitions, and the project requirements.</p>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#1-project-overview-goals","title":"1. Project Overview &amp; Goals","text":"<p>Objective: Implement a robust, multiplayer game server for R-Type capable of handling 2-4 players via UDP.</p> <p>Key Requirements: - Capacity: 2-4 concurrent players. - Networking: UDP via <code>INetworkPlugin</code>. - Architecture: Server-authoritative (server decides truth). - Stability: 10+ minutes runtime without crashes. - Latency: &lt;100ms processing overhead.</p>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#2-architecture","title":"2. Architecture","text":"<p>The server will be built as a standalone application located in <code>src/r-type/server/</code>. It will leverage the core engine libraries (<code>src/engine/</code>) and the shared protocol (<code>src/r-type/shared/protocol/</code>).</p>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#high-level-components","title":"High-Level Components","text":"<ol> <li> <p>Network Layer (<code>NetworkSystem</code>):</p> <ul> <li>Uses the <code>INetworkPlugin</code> to send/receive raw bytes.</li> <li>Deserializes incoming packets into events or components.</li> <li>Serializes game state into outgoing packets (Snapshots).</li> </ul> </li> <li> <p>ECS Core (<code>Registry</code>):</p> <ul> <li>The central source of truth.</li> <li>Stores all entities (Players, Enemies, Projectiles) and their state (Position, Velocity, Health).</li> </ul> </li> <li> <p>Game Loop:</p> <ul> <li>Tick Rate: Fixed (e.g., 60 TPS).</li> <li>Steps:<ol> <li>Poll Network: Read all incoming packets from the plugin.</li> <li>Process Events: Handle joins, leaves, and inputs.</li> <li>Update Systems: Run physics, collision, AI, and game logic systems.</li> <li>Broadcast State: Send <code>SERVER_SNAPSHOT</code> or specific events to clients.</li> </ol> </li> </ul> </li> </ol>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#3-protocol-implementation","title":"3. Protocol Implementation","text":"<p>The protocol is already defined in <code>src/r-type/shared/protocol/</code>. The server must strictly adhere to these definitions.</p>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#key-files","title":"Key Files","text":"<ul> <li><code>PacketHeader.hpp</code>: The 8-byte header (Version, Type, Length, Sequence).</li> <li><code>PacketTypes.hpp</code>: Message IDs (e.g., <code>CLIENT_INPUT</code> = 0x10).</li> <li><code>Payloads.hpp</code>: Packed structs for message bodies.</li> </ul>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#packet-handling-flow","title":"Packet Handling Flow","text":"<ol> <li>Receive: <code>plugin-&gt;receive()</code> returns a <code>NetworkPacket</code>.</li> <li>Parse Header: Read the first 8 bytes as <code>PacketHeader</code>.</li> <li>Validate: Check <code>version</code>, <code>payload_length</code>, and <code>type</code>.</li> <li>Route: Switch on <code>header.type</code> to cast the payload to the correct struct.</li> </ol>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#4-implementation-phases","title":"4. Implementation Phases","text":""},{"location":"SERVER_DEVELOPMENT_GUIDE/#phase-1-infrastructure-setup","title":"Phase 1: Infrastructure Setup","text":"<p>Goal: A running server that listens on a port. 1.  Modify <code>src/r-type/server/src/main.cpp</code>. 2.  Load the Network Plugin (DLL/SO) using <code>PluginManager</code>. 3.  Initialize <code>INetworkPlugin</code> and call <code>start_server(port, UDP)</code>. 4.  Implement the basic <code>while (running)</code> loop.</p>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#phase-2-connection-management","title":"Phase 2: Connection Management","text":"<p>Goal: Clients can connect and see the \"Lobby\". 1.  Handle <code>CLIENT_CONNECT</code> (0x01).     -   Check if server is full.     -   Create a \"Player\" entity in the ECS.     -   Send <code>SERVER_ACCEPT</code> (0x81) with the assigned Player ID.     -   Broadcast <code>SERVER_PLAYER_JOINED</code> (0x83) to others. 2.  Handle <code>CLIENT_DISCONNECT</code> (0x02) and timeouts.     -   Remove entity.     -   Broadcast <code>SERVER_PLAYER_LEFT</code> (0x84). 3.  Implement a <code>LobbySystem</code> to manage the \"Waiting for players\" state.</p>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#phase-3-input-movement","title":"Phase 3: Input &amp; Movement","text":"<p>Goal: Players can move their ships. 1.  Handle <code>CLIENT_INPUT</code> (0x10).     -   This packet contains <code>InputFlags</code> (Up, Down, Left, Right, Shoot).     -   Do not trust the client's position.     -   Update the player entity's <code>Velocity</code> component based on input flags. 2.  Create/Use <code>PhysicsSystem</code>:     -   Update <code>Position</code> based on <code>Velocity</code>.     -   Enforce map boundaries (clamp position).</p>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#phase-4-state-synchronization-the-netcode","title":"Phase 4: State Synchronization (The \"Netcode\")","text":"<p>Goal: Clients see moving objects. 1.  Create <code>NetworkBroadcastSystem</code>. 2.  Periodically (e.g., every tick or every other tick):     -   Iterate all networked entities.     -   Construct <code>EntityState</code> structs.     -   Pack them into a <code>SERVER_SNAPSHOT</code> (0xA0) packet.     -   Broadcast to all clients.</p>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#phase-5-gameplay-logic","title":"Phase 5: Gameplay Logic","text":"<p>Goal: Enemies, Shooting, Scoring. 1.  Shooting:     -   When <code>INPUT_SHOOT</code> is active and cooldown allows:     -   Spawn a <code>Projectile</code> entity.     -   Broadcast <code>SERVER_PROJECTILE_SPAWN</code> (0xB3). 2.  Enemies (AI):     -   <code>WaveSystem</code>: Spawns enemies based on time/wave config.     -   <code>AISystem</code>: Updates enemy velocities (patterns). 3.  Collision:     -   Server checks overlaps (AABB).     -   On hit:         -   Deduct health.         -   If dead: <code>registry.kill_entity()</code>.         -   Broadcast <code>SERVER_ENTITY_DESTROY</code> (0xB1) and <code>SERVER_SCORE_UPDATE</code> (0xC1).</p>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#5-code-structure-proposal","title":"5. Code Structure Proposal","text":"<pre><code>// src/r-type/server/src/Server.hpp\n\nclass Server {\npublic:\n    Server(const std::string&amp; plugin_path);\n    void run();\n\nprivate:\n    void handle_packets();\n    void update_game(float dt);\n    void broadcast_state();\n\n    // Packet Handlers\n    void on_connect(ClientId id, const ClientConnectPayload&amp; payload);\n    void on_input(ClientId id, const ClientInputPayload&amp; payload);\n\n    std::unique_ptr&lt;engine::INetworkPlugin&gt; _network;\n    engine::Registry _registry;\n    // ...\n};\n</code></pre>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#6-serialization-helper","title":"6. Serialization Helper","text":"<p>Since the protocol uses packed structs, you can cast raw bytes directly, but be careful with endianness if crossing architectures (Standard is Big Endian for network fields).</p> <pre><code>// Example: Sending a packet\ntemplate&lt;typename Payload&gt;\nvoid send_packet(engine::INetworkPlugin* net, ClientId target, PacketType type, const Payload&amp; payload) {\n    std::vector&lt;uint8_t&gt; buffer(sizeof(PacketHeader) + sizeof(Payload));\n\n    PacketHeader header(static_cast&lt;uint8_t&gt;(type), sizeof(Payload), _seq_num++);\n    // TODO: Convert header fields to Big Endian if needed (htons/htonl)\n\n    std::memcpy(buffer.data(), &amp;header, sizeof(Header));\n    std::memcpy(buffer.data() + sizeof(Header), &amp;payload, sizeof(Payload));\n\n    net-&gt;send_to(engine::NetworkPacket(buffer), target);\n}\n</code></pre>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#7-todo-list-for-developer","title":"7. Todo List for Developer","text":"<ol> <li>[ ] Setup: Link <code>Server</code> executable with <code>Engine</code> and <code>PluginManager</code>.</li> <li>[ ] Network: Load <code>asio_network_plugin</code>.</li> <li>[ ] Lobby: Implement room logic (Waiting -&gt; Playing).</li> <li>[ ] Game Loop: Connect ECS <code>run_systems</code>.</li> <li>[ ] Replication: Implement <code>Snapshot</code> builder.</li> </ol>"},{"location":"SERVER_DEVELOPMENT_GUIDE/#8-common-pitfalls","title":"8. Common Pitfalls","text":"<ul> <li>Don't trust the client: Never accept position updates from clients. Only accept inputs (intent).</li> <li>Packet Fragmentation: UDP is packet-based, so fragmentation is less of an issue than TCP stream parsing, but ensure payloads don't exceed MTU (keep snapshots small or split them).</li> <li>Concurrency: The ECS is not thread-safe by default. Ensure network callbacks allow thread-safe queueing of events, or run network polling on the main thread.</li> </ul>"},{"location":"SERVER_OPTIMIZATIONS/","title":"Server Performance Optimizations","text":"<p>This document details the performance optimizations implemented in the R-Type server to ensure low latency, efficient bandwidth usage, and scalable multiplayer gameplay.</p>"},{"location":"SERVER_OPTIMIZATIONS/#performance-summary","title":"Performance Summary","text":"Category Optimization Measured Gain Network LZ4 Compression 30-40% bandwidth reduction Network Selective compression &lt; 1% CPU overhead Memory SparseSet ECS 86.5% memory savings Threading Thread pool with barriers 6x parallel session updates Serialization Velocity quantization 4 bytes saved per entity"},{"location":"SERVER_OPTIMIZATIONS/#1-network-optimizations","title":"1. Network Optimizations","text":""},{"location":"SERVER_OPTIMIZATIONS/#11-hybrid-tcpudp-architecture","title":"1.1 Hybrid TCP/UDP Architecture","text":"<p>The server uses a dual-protocol strategy to balance reliability and latency:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Network Architecture                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502   TCP (Port 4242)              UDP (Port 4243)              \u2502\n\u2502   \u251c\u2500 Connection/Auth           \u251c\u2500 Player inputs             \u2502\n\u2502   \u251c\u2500 Lobby management          \u251c\u2500 State snapshots           \u2502\n\u2502   \u251c\u2500 Chat messages             \u251c\u2500 Entity spawn/destroy      \u2502\n\u2502   \u2514\u2500 Reliable events           \u2514\u2500 Real-time gameplay        \u2502\n\u2502                                                             \u2502\n\u2502   Latency: ~50-100ms           Latency: ~5-20ms             \u2502\n\u2502   Reliability: Guaranteed      Reliability: Best-effort     \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Performance Impact: - UDP for gameplay: Reduces input-to-display latency by 30-80ms compared to TCP-only - TCP for critical data: Zero packet loss for connection and lobby state</p>"},{"location":"SERVER_OPTIMIZATIONS/#12-lz4-packet-compression","title":"1.2 LZ4 Packet Compression","text":"<p>The server implements selective LZ4 compression for bandwidth optimization.</p>"},{"location":"SERVER_OPTIMIZATIONS/#compression-configuration","title":"Compression Configuration","text":"Parameter Value Purpose <code>MIN_COMPRESSION_SIZE</code> 128 bytes Skip small packets <code>MIN_COMPRESSION_GAIN</code> 10% Only compress if beneficial <code>MAX_COMPRESSION_TIME</code> 500 \u00b5s Prevent blocking"},{"location":"SERVER_OPTIMIZATIONS/#compressible-packet-types","title":"Compressible Packet Types","text":"Packet Type Typical Size Compressed? Reason <code>SERVER_SNAPSHOT</code> 300-1400 bytes Yes Large, repetitive data <code>SERVER_DELTA_SNAPSHOT</code> 200-800 bytes Yes Entity state arrays <code>SERVER_ROOM_LIST</code> 200-500 bytes Yes Room metadata <code>SERVER_LOBBY_STATE</code> 150-400 bytes Yes Player lists <code>CLIENT_INPUT</code> 14 bytes No Too small <code>CLIENT_CONNECT</code> 20-50 bytes No Below threshold"},{"location":"SERVER_OPTIMIZATIONS/#bandwidth-savings-analysis","title":"Bandwidth Savings Analysis","text":"<p>Scenario: 4-player active game (39 entities average)</p> Metric Without Compression With LZ4 Savings Snapshot size 985 bytes ~670 bytes 32% Bandwidth (60 Hz) 59.1 KB/s 40.2 KB/s 18.9 KB/s Per minute 3.5 MB 2.4 MB 1.1 MB 30-min session 106 MB 72 MB 34 MB Per player (30 min) 26.5 MB 18 MB 8.5 MB"},{"location":"SERVER_OPTIMIZATIONS/#compression-cpu-cost","title":"Compression CPU Cost","text":"<pre><code>LZ4 compression speed: ~500-700 MB/sec\n\nPer 985-byte snapshot:\n  Compression time: ~1.6 \u00b5s\n  Budget available: 500 \u00b5s\n  Usage: 0.32% of budget\n\nPer tick (60 snapshots):\n  Total compression: ~98 \u00b5s\n  Tick budget: 15,625 \u00b5s (64 TPS)\n  CPU overhead: 0.63%\n</code></pre> <p>Result: Compression adds &lt; 1% CPU overhead while saving 30-40% bandwidth.</p>"},{"location":"SERVER_OPTIMIZATIONS/#13-packet-header-optimization","title":"1.3 Packet Header Optimization","text":"<p>Minimal 9-13 byte header design:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Packet Header (9-13 bytes)               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Version  \u2502   Type   \u2502  Flags   \u2502  Payload    \u2502   Sequence    \u2502\n\u2502 (1 byte) \u2502 (1 byte) \u2502 (1 byte) \u2502  Length     \u2502   Number      \u2502\n\u2502          \u2502          \u2502          \u2502  (2 bytes)  \u2502   (4 bytes)   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 [If compressed] Uncompressed Size (4 bytes)                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Overhead comparison: - R-Type header: 9-13 bytes (0.6-0.9% of max packet) - Typical game protocols: 20-40 bytes (1.4-2.8%) - Savings: 50-70% header overhead reduction</p>"},{"location":"SERVER_OPTIMIZATIONS/#2-ecs-entity-component-system-optimizations","title":"2. ECS (Entity Component System) Optimizations","text":""},{"location":"SERVER_OPTIMIZATIONS/#21-sparseset-data-structure","title":"2.1 SparseSet Data Structure","text":"<p>The ECS uses SparseSet for cache-efficient component storage:</p> <pre><code>// Traditional approach: O(n) iteration, poor cache locality\nstd::unordered_map&lt;EntityId, Component&gt; components;  // Scattered memory\n\n// SparseSet approach: O(1) access, contiguous memory\nstruct SparseSet&lt;Component&gt; {\n    vector&lt;optional&lt;size_t&gt;&gt; sparse;  // EntityID \u2192 dense index\n    vector&lt;Entity&gt; dense;              // Active entity IDs (packed)\n    vector&lt;Component&gt; data;            // Component data (packed)\n};\n</code></pre>"},{"location":"SERVER_OPTIMIZATIONS/#memory-efficiency-comparison","title":"Memory Efficiency Comparison","text":"<p>Scenario: 100 active entities / 10,000 possible IDs</p> Approach Memory Usage Cache Efficiency Naive Array 640 KB Poor (1% utilization) Hash Map ~200 KB Moderate (pointer chasing) SparseSet 86.4 KB Excellent (contiguous) <p>Memory savings: 86.5% compared to naive array approach.</p>"},{"location":"SERVER_OPTIMIZATIONS/#operation-complexity","title":"Operation Complexity","text":"Operation SparseSet Hash Map Array Lookup O(1) O(1) avg O(1) Insert O(1) O(1) avg O(1) Remove O(1)* O(1) avg O(n) Iterate O(n) dense O(n) sparse O(n) sparse <p>*SparseSet uses swap-and-pop for O(1) removal</p>"},{"location":"SERVER_OPTIMIZATIONS/#cache-performance","title":"Cache Performance","text":"<pre><code>Iteration over 1000 components:\n\nHash Map: ~15,000 cache misses (pointer chasing)\nArray:    ~10,000 cache misses (sparse data)\nSparseSet: ~1,500 cache misses (dense packing)\n\nCache hit improvement: ~60-85%\n</code></pre>"},{"location":"SERVER_OPTIMIZATIONS/#22-component-size-optimization","title":"2.2 Component Size Optimization","text":"Component Size Notes Position 8 bytes 2 floats Velocity 8 bytes 2 floats Collider 8 bytes 2 floats (width, height) Health 8 bytes current + max (2 ints) Input 4 bytes Bitfield flags EntityState 25 bytes Network serialization"},{"location":"SERVER_OPTIMIZATIONS/#3-snapshot-state-synchronization","title":"3. Snapshot &amp; State Synchronization","text":""},{"location":"SERVER_OPTIMIZATIONS/#31-snapshot-rate-optimization","title":"3.1 Snapshot Rate Optimization","text":"Configuration Value Rationale Server tick rate 64 TPS Physics precision Snapshot rate 60 Hz Visual smoothness Client input rate 60-64 Hz Responsive controls <p>Why 60 Hz snapshots? - Matches typical display refresh rates - Provides smooth interpolation - Balances bandwidth vs visual quality</p>"},{"location":"SERVER_OPTIMIZATIONS/#32-entity-prioritization","title":"3.2 Entity Prioritization","text":"<p>Snapshots include entities by priority to fit within MTU:</p> <pre><code>Priority Order:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1. PLAYERS      (Always included)       \u2502  \u2190 Critical for gameplay\n\u2502 2. PROJECTILES  (High priority)         \u2502  \u2190 Affects hit detection\n\u2502 3. ENEMIES      (Medium priority)       \u2502  \u2190 Important for dodging\n\u2502 4. WALLS        (Excluded)              \u2502  \u2190 Predictable scrolling\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Impact: - Maximum entities per snapshot: 55 - Walls excluded: Saves ~200-400 bytes per snapshot - Client predicts wall positions locally</p>"},{"location":"SERVER_OPTIMIZATIONS/#33-velocity-quantization","title":"3.3 Velocity Quantization","text":"<p>Float velocities are quantized to int16 for network transmission:</p> <pre><code>// Before: 4 bytes per velocity component (float)\nfloat velocity_x = 123.456f;  // 4 bytes\n\n// After: 2 bytes per velocity component (int16)\nint16_t velocity_x = static_cast&lt;int16_t&gt;(vel * 10.0f);  // 2 bytes\n\n// Precision: 0.1 units (sufficient for gameplay)\n</code></pre> <p>Savings per entity: - Before: 8 bytes (2 floats) - After: 4 bytes (2 int16) - Savings: 4 bytes/entity = 220 bytes/snapshot (55 entities)</p>"},{"location":"SERVER_OPTIMIZATIONS/#34-entitystate-network-structure","title":"3.4 EntityState Network Structure","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 EntityState (25 bytes)                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 entity_id       \u2502 4 bytes  (uint32_t)                       \u2502\n\u2502 entity_type     \u2502 1 byte   (uint8_t)                        \u2502\n\u2502 position_x      \u2502 4 bytes  (float)                          \u2502\n\u2502 position_y      \u2502 4 bytes  (float)                          \u2502\n\u2502 velocity_x      \u2502 2 bytes  (int16_t, quantized)             \u2502\n\u2502 velocity_y      \u2502 2 bytes  (int16_t, quantized)             \u2502\n\u2502 health          \u2502 2 bytes  (uint16_t)                       \u2502\n\u2502 flags           \u2502 2 bytes  (bitfield: invuln, charging...)  \u2502\n\u2502 last_ack_seq    \u2502 4 bytes  (uint32_t, lag compensation)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"SERVER_OPTIMIZATIONS/#4-threading-concurrency","title":"4. Threading &amp; Concurrency","text":""},{"location":"SERVER_OPTIMIZATIONS/#41-session-thread-pool-architecture","title":"4.1 Session Thread Pool Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Thread Pool Architecture                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                \u2502\n\u2502   Main Thread                    Worker Threads (6)            \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502 1. Schedule  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502 Worker 1: Session A    \u2502   \u2502\n\u2502   \u2502    tasks     \u2502              \u2502 Worker 2: Session B    \u2502   \u2502\n\u2502   \u2502              \u2502              \u2502 Worker 3: Session C    \u2502   \u2502\n\u2502   \u2502 2. Wait at   \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 Worker 4: Session D    \u2502   \u2502\n\u2502   \u2502    barrier   \u2502   (notify)   \u2502 Worker 5: Session E    \u2502   \u2502\n\u2502   \u2502              \u2502              \u2502 Worker 6: Session F    \u2502   \u2502\n\u2502   \u2502 3. Broadcast \u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502   \u2502    events    \u2502                                            \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                            \u2502\n\u2502                                                                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"SERVER_OPTIMIZATIONS/#configuration","title":"Configuration","text":"Parameter Value Rationale Worker threads 6 Optimal for 4-10 concurrent sessions Synchronization Barrier pattern Prevents race conditions Atomics Lock-free counters Minimal contention"},{"location":"SERVER_OPTIMIZATIONS/#barrier-synchronization-pattern","title":"Barrier Synchronization Pattern","text":"<pre><code>// Main thread\nvoid update_all_sessions(float dt) {\n    tasks_pending_ = session_count;\n    tasks_completed_ = 0;\n\n    // Schedule all session updates\n    for (auto&amp; session : sessions) {\n        task_queue_.push([&amp;]{ session.update(dt); });\n    }\n\n    // Wait for all workers to complete\n    std::unique_lock lock(completion_mutex_);\n    completion_cv_.wait(lock, []{\n        return tasks_completed_ == tasks_pending_;\n    });\n\n    // Safe to broadcast events now\n    broadcast_all_session_events();\n}\n</code></pre> <p>Benefits: - No per-entity locks: Sessions update independently - Deterministic ordering: Events broadcast after all updates - Scalability: Handles 6 concurrent sessions with 0 contention</p>"},{"location":"SERVER_OPTIMIZATIONS/#42-lock-free-atomic-operations","title":"4.2 Lock-Free Atomic Operations","text":"<pre><code>// Task counting without mutex\nstd::atomic&lt;size_t&gt; tasks_pending_{0};\nstd::atomic&lt;size_t&gt; tasks_completed_{0};\n\n// Memory ordering for correctness\ntasks_pending_.store(count, std::memory_order_release);\nauto completed = tasks_completed_.fetch_add(1, std::memory_order_acq_rel);\n</code></pre>"},{"location":"SERVER_OPTIMIZATIONS/#43-read-heavy-optimization","title":"4.3 Read-Heavy Optimization","text":"<pre><code>// Session lookup uses shared_mutex\nstd::shared_mutex sessions_mutex_;\n\n// Multiple readers (frequent)\nstd::shared_lock lock(sessions_mutex_);\nauto session = sessions_.find(id);\n\n// Single writer (rare)\nstd::unique_lock lock(sessions_mutex_);\nsessions_.emplace(id, session);\n</code></pre>"},{"location":"SERVER_OPTIMIZATIONS/#5-game-loop-architecture","title":"5. Game Loop Architecture","text":""},{"location":"SERVER_OPTIMIZATIONS/#51-fixed-tick-rate","title":"5.1 Fixed Tick Rate","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 Server Main Loop (64 TPS)                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502 1. Calculate delta time                             \u2502   \u2502\n\u2502   \u2502    \u2514\u2500 steady_clock for microsecond precision        \u2502   \u2502\n\u2502   \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502   \u2502 2. Process network packets                          \u2502   \u2502\n\u2502   \u2502    \u2514\u2500 Dequeue and route all pending packets         \u2502   \u2502\n\u2502   \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502   \u2502 3. Update lobbies                                   \u2502   \u2502\n\u2502   \u2502    \u2514\u2500 Countdown timers, state transitions           \u2502   \u2502\n\u2502   \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502   \u2502 4. Update rooms                                     \u2502   \u2502\n\u2502   \u2502    \u2514\u2500 Room state management                         \u2502   \u2502\n\u2502   \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502   \u2502 5. Update all sessions (PARALLEL)                   \u2502   \u2502\n\u2502   \u2502    \u2514\u2500 Thread pool processes sessions concurrently   \u2502   \u2502\n\u2502   \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502   \u2502 6. Broadcast queued events                          \u2502   \u2502\n\u2502   \u2502    \u2514\u2500 After barrier sync, send all session events   \u2502   \u2502\n\u2502   \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502   \u2502 7. Cleanup inactive sessions                        \u2502   \u2502\n\u2502   \u2502    \u2514\u2500 Remove dead sessions                          \u2502   \u2502\n\u2502   \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502   \u2502 8. Sleep remainder of tick                          \u2502   \u2502\n\u2502   \u2502    \u2514\u2500 Maintain precise 64 TPS                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                             \u2502\n\u2502   Tick budget: 15,625 \u00b5s (15.625 ms)                        \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"SERVER_OPTIMIZATIONS/#52-tick-budget-breakdown","title":"5.2 Tick Budget Breakdown","text":"Phase Typical Time % of Budget Network processing ~500 \u00b5s 3.2% Lobby/Room update ~100 \u00b5s 0.6% Session updates (parallel) ~2,000 \u00b5s 12.8% Event broadcasting ~300 \u00b5s 1.9% Compression overhead ~100 \u00b5s 0.6% Total used ~3,000 \u00b5s 19.2% Headroom ~12,600 \u00b5s 80.8% <p>Result: Server maintains 80%+ headroom for spikes and scaling.</p>"},{"location":"SERVER_OPTIMIZATIONS/#6-memory-management","title":"6. Memory Management","text":""},{"location":"SERVER_OPTIMIZATIONS/#61-fixed-size-buffers","title":"6.1 Fixed-Size Buffers","text":"<pre><code>// Pre-allocated network buffers (no heap allocation per packet)\nstd::array&lt;uint8_t, 65536&gt; udp_recv_buffer_;    // 64 KB\nstd::array&lt;uint8_t, 65536&gt; tcp_recv_buffer_;    // 64 KB\n</code></pre> <p>Impact: - Zero heap allocations during packet processing - Predictable memory usage - No GC pauses or fragmentation</p>"},{"location":"SERVER_OPTIMIZATIONS/#62-queue-based-event-batching","title":"6.2 Queue-Based Event Batching","text":"<pre><code>// ServerNetworkSystem event queues\nstd::queue&lt;SpawnEvent&gt; pending_spawns_;\nstd::queue&lt;DestroyEvent&gt; pending_destroys_;\nstd::queue&lt;ProjectileEvent&gt; pending_projectiles_;\nstd::queue&lt;ScoreEvent&gt; pending_scores_;\n// ... etc\n</code></pre> <p>Benefits: - Events batched per tick (not per-entity) - Single mutex lock per queue drain - Reduced network syscalls</p>"},{"location":"SERVER_OPTIMIZATIONS/#63-pod-serialization","title":"6.3 POD Serialization","text":"<pre><code>// Zero-copy serialization for Plain Old Data\ntemplate&lt;typename T&gt;\nstd::vector&lt;uint8_t&gt; serialize(const T&amp; data) {\n    const uint8_t* bytes = reinterpret_cast&lt;const uint8_t*&gt;(&amp;data);\n    return std::vector&lt;uint8_t&gt;(bytes, bytes + sizeof(T));\n}\n</code></pre> <p>Performance: - No reflection or parsing overhead - Direct memory copy - Compile-time size validation</p>"},{"location":"SERVER_OPTIMIZATIONS/#7-compression-statistics-monitoring","title":"7. Compression Statistics &amp; Monitoring","text":""},{"location":"SERVER_OPTIMIZATIONS/#71-built-in-metrics-system","title":"7.1 Built-in Metrics System","text":"<p>The server tracks compression performance in real-time:</p> <pre><code>struct CompressionMetrics {\n    size_t total_packets_sent;           // All packets\n    size_t compressed_packets;           // Successfully compressed\n    size_t bytes_before_compression;     // Original data\n    size_t bytes_after_compression;      // Final data\n    chrono::microseconds total_compression_time;\n};\n</code></pre>"},{"location":"SERVER_OPTIMIZATIONS/#72-available-metrics","title":"7.2 Available Metrics","text":"Metric Calculation Example Value Compression ratio compressed / original 0.65 (65%) Bytes saved original - compressed 34 MB / 30 min Compression rate compressed / total \u00d7 100 45% of packets Avg compression time total_time / count 1.6 \u00b5s"},{"location":"SERVER_OPTIMIZATIONS/#73-runtime-report-format","title":"7.3 Runtime Report Format","text":"<pre><code>[Compression Stats]\n  Total packets sent: 108,000\n  Compressed packets: 48,600 (45.00%)\n  Bytes before: 106,272,000 (101.36 MB)\n  Bytes after:  72,288,000 (68.93 MB)\n  Bytes saved:  33,984,000 (32.41 MB)\n  Compression ratio: 68.02%\n  Avg compression time: 1.64 \u00b5s\n</code></pre>"},{"location":"SERVER_OPTIMIZATIONS/#8-configuration-reference","title":"8. Configuration Reference","text":""},{"location":"SERVER_OPTIMIZATIONS/#81-network-configuration","title":"8.1 Network Configuration","text":"<pre><code>// NetworkConfig.hpp\nconstexpr uint16_t DEFAULT_TCP_PORT = 4242;\nconstexpr uint16_t DEFAULT_UDP_PORT = 4243;\nconstexpr bool ENABLE_COMPRESSION = true;\nconstexpr size_t MIN_COMPRESSION_SIZE = 128;      // bytes\nconstexpr float MIN_COMPRESSION_GAIN = 0.10f;     // 10%\nconstexpr uint32_t MAX_COMPRESSION_TIME_US = 500; // microseconds\n</code></pre>"},{"location":"SERVER_OPTIMIZATIONS/#82-game-configuration","title":"8.2 Game Configuration","text":"<pre><code>// GameConfig.hpp\nconstexpr uint32_t SERVER_TICK_RATE = 64;         // TPS\nconstexpr uint32_t TICK_INTERVAL_MS = 15;         // ~15.625ms\nconstexpr uint32_t SNAPSHOT_RATE = 60;            // Hz\nconstexpr size_t MAX_PACKET_SIZE = 1400;          // bytes (MTU-safe)\nconstexpr size_t MAX_ENTITIES_PER_SNAPSHOT = 55;\n</code></pre>"},{"location":"SERVER_OPTIMIZATIONS/#83-threading-configuration","title":"8.3 Threading Configuration","text":"<pre><code>// ThreadingConfig.hpp\nconstexpr size_t THREAD_POOL_SIZE = 6;\nconstexpr size_t METRICS_PRINT_INTERVAL_SECONDS = 5;\n</code></pre>"},{"location":"SERVER_OPTIMIZATIONS/#9-performance-benchmarks","title":"9. Performance Benchmarks","text":""},{"location":"SERVER_OPTIMIZATIONS/#91-bandwidth-comparison","title":"9.1 Bandwidth Comparison","text":"Scenario Uncompressed Compressed Savings Minimal (4 players) 6.6 KB/s 4.5 KB/s 32% Active (4p + 20e + 30p) 81.6 KB/s 53.0 KB/s 35% Maximum (55 entities) 88.5 KB/s 57.5 KB/s 35%"},{"location":"SERVER_OPTIMIZATIONS/#92-latency-comparison","title":"9.2 Latency Comparison","text":"Protocol Average Latency Jitter TCP-only (baseline) 80-150 ms \u00b130 ms Hybrid TCP/UDP 15-40 ms \u00b110 ms Improvement 60-75% 66%"},{"location":"SERVER_OPTIMIZATIONS/#93-memory-usage","title":"9.3 Memory Usage","text":"Component Usage Notes Network buffers 128 KB Fixed allocation ECS (100 entities) ~90 KB SparseSet overhead Event queues ~10 KB Variable Thread pool ~50 KB Stack per worker Total per session ~300 KB Predictable"},{"location":"SERVER_OPTIMIZATIONS/#10-key-files-reference","title":"10. Key Files Reference","text":"File Purpose <code>src/r-type/shared/protocol/compression/PacketCompressor.hpp</code> LZ4 compression <code>src/r-type/shared/protocol/compression/CompressionStats.hpp</code> Metrics tracking <code>src/r-type/shared/protocol/NetworkConfig.hpp</code> Network constants <code>src/r-type/shared/GameConfig.hpp</code> Game constants <code>src/engine/include/ecs/SparseSet.hpp</code> ECS data structure <code>src/r-type/server/include/SessionThreadPool.hpp</code> Thread pool <code>src/r-type/server/include/ServerNetworkSystem.hpp</code> Snapshot generation <code>src/r-type/server/src/Server.cpp</code> Main loop"},{"location":"SERVER_OPTIMIZATIONS/#conclusion","title":"Conclusion","text":"<p>The R-Type server achieves high performance through layered optimizations:</p> <ol> <li>Network: 30-40% bandwidth reduction with &lt; 1% CPU overhead</li> <li>ECS: 86.5% memory savings with improved cache efficiency</li> <li>Threading: Linear scaling with barrier-synchronized parallelism</li> <li>Serialization: Zero-copy POD handling with velocity quantization</li> <li>Architecture: 80%+ tick budget headroom for reliability</li> </ol> <p>These optimizations enable smooth 4-player gameplay at 64 TPS with minimal latency and bandwidth requirements.</p>"},{"location":"SETUP/","title":"Setup Guide","text":"<p>This guide will help you set up the Mirror R-Type project on your local machine.</p>"},{"location":"SETUP/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Prerequisites</li> <li>Platform-Specific Setup</li> <li>Linux</li> <li>macOS</li> <li>Windows</li> <li>Building the Project</li> <li>Running the Game</li> <li>Troubleshooting</li> </ul>"},{"location":"SETUP/#prerequisites","title":"Prerequisites","text":""},{"location":"SETUP/#required-tools","title":"Required Tools","text":"<ul> <li>CMake 3.20 or higher</li> <li>C++20 compatible compiler:</li> <li>GCC 12+ (Linux)</li> <li>Clang 15+ (macOS/Linux)</li> <li>MSVC 2022+ (Windows)</li> <li>Git</li> </ul>"},{"location":"SETUP/#vcpkg-package-manager","title":"vcpkg (Package Manager)","text":"<p>The project uses vcpkg for dependency management. It will be automatically set up during the build process.</p>"},{"location":"SETUP/#platform-specific-setup","title":"Platform-Specific Setup","text":""},{"location":"SETUP/#linux-debianubuntu","title":"Linux (Debian/Ubuntu)","text":""},{"location":"SETUP/#1-install-system-dependencies","title":"1. Install System Dependencies","text":"<pre><code>sudo apt-get update\nsudo apt-get install -y \\\n    build-essential \\\n    cmake \\\n    git \\\n    pkg-config \\\n    curl \\\n    zip \\\n    unzip \\\n    tar\n</code></pre>"},{"location":"SETUP/#2-install-compiler","title":"2. Install Compiler","text":"<pre><code># GCC 12+\nsudo apt-get install g++-12\n\n# Or Clang 15+\nsudo apt-get install clang-15\n</code></pre>"},{"location":"SETUP/#3-setup-vcpkg","title":"3. Setup vcpkg","text":"<pre><code>cd Mirror-R-Type\ngit clone https://github.com/Microsoft/vcpkg.git\ncd vcpkg\n./bootstrap-vcpkg.sh\ncd ..\n</code></pre>"},{"location":"SETUP/#4-build-the-project","title":"4. Build the Project","text":"<pre><code>cmake -B build\ncmake --build build -j$(nproc)\n</code></pre>"},{"location":"SETUP/#macos","title":"macOS","text":""},{"location":"SETUP/#1-install-homebrew","title":"1. Install Homebrew","text":"<p>If not already installed:</p> <pre><code>/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\n</code></pre>"},{"location":"SETUP/#2-install-dependencies","title":"2. Install Dependencies","text":"<pre><code>brew install cmake git llvm\n</code></pre>"},{"location":"SETUP/#3-setup-vcpkg_1","title":"3. Setup vcpkg","text":"<pre><code>cd Mirror-R-Type\ngit clone https://github.com/Microsoft/vcpkg.git\ncd vcpkg\n./bootstrap-vcpkg.sh\ncd ..\n</code></pre>"},{"location":"SETUP/#4-build-the-project_1","title":"4. Build the Project","text":"<pre><code># Use Homebrew's clang\nexport CC=/opt/homebrew/opt/llvm/bin/clang\nexport CXX=/opt/homebrew/opt/llvm/bin/clang++\n\ncmake -B build\ncmake --build build -j$(sysctl -n hw.ncpu)\n</code></pre>"},{"location":"SETUP/#windows","title":"Windows","text":""},{"location":"SETUP/#1-install-visual-studio-2022","title":"1. Install Visual Studio 2022","text":"<p>Download and install Visual Studio 2022 with: - Desktop development with C++ - C++ CMake tools - Windows 10 SDK</p>"},{"location":"SETUP/#2-install-git","title":"2. Install Git","text":"<p>Download from git-scm.com</p>"},{"location":"SETUP/#3-setup-vcpkg_2","title":"3. Setup vcpkg","text":"<p>Open PowerShell or Developer Command Prompt:</p> <pre><code>cd Mirror-R-Type\ngit clone https://github.com/Microsoft/vcpkg.git\ncd vcpkg\n.\\bootstrap-vcpkg.bat\ncd ..\n</code></pre>"},{"location":"SETUP/#35-cmake-windows","title":"3.5 CMAKE Windows","text":"<pre><code>winget install --id Kitware.CMake -e\n</code></pre>"},{"location":"SETUP/#4-build-the-project_2","title":"4. Build the Project","text":"<pre><code>cmake -B build -G \"Visual Studio 17 2022\"\ncmake --build build --config Release\n</code></pre>"},{"location":"SETUP/#building-the-project","title":"Building the Project","text":""},{"location":"SETUP/#standard-build","title":"Standard Build","text":"<pre><code># Configure\ncmake -B build\n\n# Build\ncmake --build build\n\n# Build specific target\ncmake --build build --target r_type_client\ncmake --build build --target r_type_server\ncmake --build build --target asio_network\n</code></pre>"},{"location":"SETUP/#build-options","title":"Build Options","text":"<pre><code># Debug build\ncmake -B build -DCMAKE_BUILD_TYPE=Debug\ncmake --build build\n\n# Release build\ncmake -B build -DCMAKE_BUILD_TYPE=Release\ncmake --build build\n\n# Build without tests\ncmake -B build -DBUILD_TESTS=OFF\n\n# Build only server\ncmake -B build -DBUILD_CLIENT=OFF -DBUILD_SERVER=ON\n</code></pre>"},{"location":"SETUP/#clean-build","title":"Clean Build","text":"<pre><code>rm -rf build\ncmake -B build\ncmake --build build\n</code></pre>"},{"location":"SETUP/#running-the-game","title":"Running the Game","text":""},{"location":"SETUP/#start-the-server","title":"Start the Server","text":"<pre><code>./build/r_type_server\n</code></pre> <p>The server will start on port <code>8080</code> by default.</p>"},{"location":"SETUP/#start-the-client","title":"Start the Client","text":"<pre><code>./build/r_type_client\n</code></pre> <p>The client will connect to <code>localhost:8080</code> by default.</p>"},{"location":"SETUP/#command-line-options","title":"Command Line Options","text":"<pre><code># Server with custom port\n./build/r_type_server --port 9000\n\n# Client with custom server\n./build/r_type_client --host 192.168.1.100 --port 9000\n</code></pre>"},{"location":"SETUP/#troubleshooting","title":"Troubleshooting","text":""},{"location":"SETUP/#vcpkg-issues","title":"vcpkg Issues","text":""},{"location":"SETUP/#could-not-find-boost","title":"\"Could NOT find Boost\"","text":"<p>Solution: Ensure vcpkg is properly bootstrapped and retry:</p> <pre><code>cd vcpkg\ngit pull\n./bootstrap-vcpkg.sh  # or .bat on Windows\ncd ..\nrm -rf build\ncmake -B build\n</code></pre>"},{"location":"SETUP/#boost-takes-too-long-to-compile","title":"\"Boost takes too long to compile\"","text":"<p>vcpkg compiles Boost from source (10-20 minutes first time). This is normal. Subsequent builds are instant (cached).</p> <p>Alternatively, use system packages:</p> <pre><code># Linux\nsudo apt-get install libboost-all-dev\n\n# macOS\nbrew install boost\n\n# Then build without vcpkg\nrm -rf vcpkg vcpkg_installed\ncmake -B build\n</code></pre>"},{"location":"SETUP/#build-errors","title":"Build Errors","text":""},{"location":"SETUP/#cmake-version-too-old","title":"\"CMake version too old\"","text":"<p>Update CMake:</p> <pre><code># Linux\nsudo apt-get install cmake\n\n# macOS\nbrew upgrade cmake\n\n# Or download from cmake.org\n</code></pre>"},{"location":"SETUP/#compiler-does-not-support-c20","title":"\"Compiler does not support C++20\"","text":"<p>Update your compiler:</p> <pre><code># Linux - GCC\nsudo apt-get install g++-12\n\n# Linux - Clang\nsudo apt-get install clang-15\n\n# macOS\nbrew install llvm\n</code></pre>"},{"location":"SETUP/#runtime-errors","title":"Runtime Errors","text":""},{"location":"SETUP/#plugin-not-found","title":"\"Plugin not found\"","text":"<p>Ensure plugins are built and in the correct location:</p> <pre><code>ls build/plugins/\n# Should show: asio_network.so, raylib_graphics.so, miniaudio_audio.so\n</code></pre>"},{"location":"SETUP/#port-already-in-use","title":"\"Port already in use\"","text":"<p>Change the port:</p> <pre><code>./build/r_type_server --port 9000\n</code></pre> <p>Or find and kill the process using the port:</p> <pre><code># Linux/macOS\nsudo lsof -i :8080\nkill &lt;PID&gt;\n\n# Windows\nnetstat -ano | findstr :8080\ntaskkill /PID &lt;PID&gt; /F\n</code></pre>"},{"location":"SETUP/#graphics-issues","title":"Graphics Issues","text":""},{"location":"SETUP/#failed-to-initialize-window","title":"\"Failed to initialize window\"","text":"<p>On Linux, ensure you have X11 or Wayland:</p> <pre><code>sudo apt-get install libx11-dev libxrandr-dev libxinerama-dev libxcursor-dev\n</code></pre> <p>On WSL, you need an X server like VcXsrv.</p>"},{"location":"SETUP/#next-steps","title":"Next Steps","text":"<ul> <li>Read the Developer Guide to contribute</li> <li>Check out the Architecture Documentation</li> <li>Learn about Creating Plugins</li> </ul>"},{"location":"SETUP/#need-help","title":"Need Help?","text":"<ul> <li>Check existing GitHub Issues</li> <li>Contact the development team</li> </ul>"},{"location":"UDP_ACK_SYSTEM/","title":"UDP ACK System - R-Type Network Protocol","text":"<p>Status: Implementation Documentation Version: 1.0 Date: January 2026 Author: R-Type Development Team</p>"},{"location":"UDP_ACK_SYSTEM/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Introduction</li> <li>Why ACK over UDP?</li> <li>ACK System Architecture</li> <li>Implementation</li> <li>Data Flow</li> <li>Advantages and Trade-offs</li> <li>Metrics and Monitoring</li> </ol>"},{"location":"UDP_ACK_SYSTEM/#1-introduction","title":"1. Introduction","text":""},{"location":"UDP_ACK_SYSTEM/#11-context","title":"1.1 Context","text":"<p>The R-Type protocol uses UDP (User Datagram Protocol) for real-time gameplay communication. UDP, unlike TCP, is an unreliable protocol: it provides no guarantees about packet delivery, ordering, or duplicate detection.</p> <p>However, for certain critical data types in a multiplayer game, an acknowledgment (ACK) mechanism is required to: - Confirm reception of player inputs - Enable client-server state reconciliation - Detect packet loss - Optimize bandwidth utilization</p>"},{"location":"UDP_ACK_SYSTEM/#12-udp-challenges","title":"1.2 UDP Challenges","text":"<p>The main challenges with UDP: - Packet loss: Packets can be lost in transit - Out-of-order delivery: Packets can arrive in the wrong order - No acknowledgment: The sender doesn't know if the packet arrived - No flow control: No native mechanism to prevent congestion</p> <p>Our ACK system solves these problems while maintaining UDP's low latency.</p>"},{"location":"UDP_ACK_SYSTEM/#2-why-ack-over-udp","title":"2. Why ACK over UDP?","text":""},{"location":"UDP_ACK_SYSTEM/#21-real-time-gameplay-requirements","title":"2.1 Real-time Gameplay Requirements","text":"<p>In R-Type, we have two types of data:</p>"},{"location":"UDP_ACK_SYSTEM/#non-critical-data-loss-tolerant","title":"Non-critical data (loss-tolerant)","text":"<ul> <li>State snapshots: Sent at 60 Hz, losing one snapshot isn't critical since a new one arrives 16ms later</li> <li>Entity positions: Interpolated client-side, a missing position can be compensated</li> <li>Visual effects: Not essential to gameplay</li> </ul>"},{"location":"UDP_ACK_SYSTEM/#critical-data-requiring-confirmation","title":"Critical data (requiring confirmation)","text":"<ul> <li>Player inputs: Must be confirmed for client prediction</li> <li>Critical entity spawns: Bosses, important power-ups</li> <li>Score and progression: Must be reliable</li> <li>Important game events: Wave start/end, victory/defeat</li> </ul>"},{"location":"UDP_ACK_SYSTEM/#22-why-not-tcp","title":"2.2 Why not TCP?","text":"<p>TCP provides native ACKs, but: - Head-of-line blocking: A lost packet blocks all subsequent packets - Increased latency: Automatic retransmissions increase latency - Overhead: Larger headers (20 bytes vs 8 bytes for UDP) - No control: Can't choose which packets are critical</p> <p>Solution: UDP with selective acknowledgment provides the reliability benefits of TCP where needed while preserving UDP's low-latency characteristics.</p>"},{"location":"UDP_ACK_SYSTEM/#3-ack-system-architecture","title":"3. ACK System Architecture","text":""},{"location":"UDP_ACK_SYSTEM/#31-sequence-number-based-ack-system","title":"3.1 Sequence Number-Based ACK System","text":"<p>Our implementation uses an implicit ACK via piggybacking system:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              R-Type UDP ACK Architecture                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nCLIENT                                    SERVER\n  \u2502                                          \u2502\n  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n  \u2502  \u2502 CLIENT_INPUT            \u2502            \u2502\n  \u2502  \u2502 \u251c\u2500 sequence_number: 42  \u2502            \u2502\n  \u2502  \u2502 \u251c\u2500 input_flags: 0x05    \u2502            \u2502\n  \u2502  \u2502 \u2514\u2500 timestamp            \u2502            \u2502\n  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502                                          \u2502\n  \u2502                               \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502                               \u2502 Process input #42    \u2502\n  \u2502                               \u2502 Update game state    \u2502\n  \u2502                               \u2502 Store last_ack = 42  \u2502\n  \u2502                               \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n  \u2502                                          \u2502\n  \u2502            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n  \u2502            \u2502 SERVER_SNAPSHOT         \u2502   \u2502\n  \u2502            \u2502 \u251c\u2500 entity_count         \u2502   \u2502\n  \u2502            \u2502 \u2514\u2500 entities[]           \u2502   \u2502\n  \u2502            \u2502    \u251c\u2500 player_id: 123    \u2502   \u2502\n  \u2502            \u2502    \u251c\u2500 position: (x,y)   \u2502   \u2502\n  \u2502            \u2502    \u2514\u2500 last_ack_seq: 42  \u2502&lt;---+ Implicit ACK\n  \u2502            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n  \u2502                                          \u2502\n  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n  \u2502  \u2502 Client receives ACK #42  \u2502            \u2502\n  \u2502  \u2502 \u2192 Confirms input handled \u2502            \u2502\n  \u2502  \u2502 \u2192 Can clean buffer       \u2502            \u2502\n  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n  \u2502                                          \u2502\n</code></pre>"},{"location":"UDP_ACK_SYSTEM/#32-key-components","title":"3.2 Key Components","text":""},{"location":"UDP_ACK_SYSTEM/#a-packetheader-all-packets","title":"A) PacketHeader (all packets)","text":"<p>Every UDP packet contains a monotonic sequence number:</p> <pre><code>struct PacketHeader {\n    uint8_t  version;          // Protocol version (0x01)\n    uint8_t  type;             // Packet type\n    uint8_t  flags;            // Flags (compression, etc.)\n    uint16_t payload_length;   // Payload size\n    uint32_t sequence_number;  // \u2190 Monotonic sequence for ordering\n    // ... optional compression fields\n} __attribute__((packed));\n</code></pre> <p>Usage: - Monotonic: Increments with each sent packet - Ordering: Allows detection of out-of-order packets - Loss detection: Gaps in sequence = packet loss</p>"},{"location":"UDP_ACK_SYSTEM/#b-clientinputpayload-player-inputs","title":"B) ClientInputPayload (player inputs)","text":"<pre><code>struct ClientInputPayload {\n    uint32_t sequence_number;  // \u2190 Input-specific sequence\n    uint16_t input_flags;      // Pressed buttons\n    uint32_t timestamp;        // Client timestamp\n    float    delta_time;       // Delta since last input\n} __attribute__((packed));\n</code></pre> <p>Usage: - Client increments <code>sequence_number</code> for each input sent - Server must ACK this sequence to confirm processing</p>"},{"location":"UDP_ACK_SYSTEM/#c-entitystate-state-snapshots","title":"C) EntityState (state snapshots)","text":"<pre><code>struct EntityState {\n    uint32_t entity_id;\n    uint16_t entity_type;\n    float    position_x;\n    float    position_y;\n    int16_t  velocity_x;\n    int16_t  velocity_y;\n    uint16_t health;\n    uint16_t flags;\n    uint32_t last_ack_sequence;  // \u2190 ACK of last processed input\n} __attribute__((packed));\n</code></pre> <p>Usage: - For player-controlled entities, <code>last_ack_sequence</code> contains the last processed input_sequence - Client compares this value with its pending inputs - If <code>last_ack_sequence &gt;= input.sequence</code>, the input is confirmed</p>"},{"location":"UDP_ACK_SYSTEM/#4-implementation","title":"4. Implementation","text":""},{"location":"UDP_ACK_SYSTEM/#41-client-side-clientpredictionsystem","title":"4.1 Client-Side (ClientPredictionSystem)","text":"<p>Files: - <code>src/r-type/client/include/systems/ClientPredictionSystem.hpp</code> - <code>src/r-type/client/src/systems/ClientPredictionSystem.cpp</code></p>"},{"location":"UDP_ACK_SYSTEM/#data-structure","title":"Data Structure","text":"<pre><code>class ClientPredictionSystem {\nprivate:\n    uint32_t local_player_id_;\n    uint32_t next_sequence_number_;  // Next sequence number\n    std::deque&lt;PredictedInput&gt; pending_inputs_;  // Buffer of unacknowledged inputs\n\n    static constexpr size_t MAX_PENDING_INPUTS = 64;\n};\n\nstruct PredictedInput {\n    uint32_t sequence_number;   // Unique sequence number\n    uint16_t input_flags;       // Copy of input flags\n    uint32_t timestamp;         // Send timestamp\n};\n</code></pre>"},{"location":"UDP_ACK_SYSTEM/#sending-input-with-sequence","title":"Sending Input with Sequence","text":"<pre><code>void ClientPredictionSystem::on_input_sent(uint16_t input_flags) {\n    // Create input with sequence\n    PredictedInput predicted = {\n        .sequence_number = next_sequence_number_++,\n        .input_flags = input_flags,\n        .timestamp = get_current_timestamp()\n    };\n\n    // Store in buffer (for future reconciliation)\n    pending_inputs_.push_back(predicted);\n\n    // Limit buffer size\n    if (pending_inputs_.size() &gt; MAX_PENDING_INPUTS) {\n        pending_inputs_.pop_front();\n    }\n\n    // Packet is sent by NetworkSystem with this sequence_number\n    // CLIENT_INPUT { sequence_number: predicted.sequence_number, ... }\n}\n</code></pre>"},{"location":"UDP_ACK_SYSTEM/#receiving-ack-from-server","title":"Receiving ACK from Server","text":"<pre><code>void ClientPredictionSystem::on_snapshot_received(\n    const SnapshotPayload&amp; snapshot\n) {\n    // Iterate through snapshot entities\n    for (const auto&amp; entity : snapshot.entities) {\n        // Find local player entity\n        if (entity.entity_id == local_player_id_) {\n            uint32_t acked_sequence = entity.last_ack_sequence;\n\n            // Confirm all inputs up to this sequence\n            acknowledge_input(acked_sequence);\n            break;\n        }\n    }\n}\n\nvoid ClientPredictionSystem::acknowledge_input(uint32_t ack_sequence) {\n    // Remove all confirmed inputs (\u2264 ack_sequence)\n    while (!pending_inputs_.empty() &amp;&amp;\n           pending_inputs_.front().sequence_number &lt;= ack_sequence) {\n        pending_inputs_.pop_front();\n    }\n\n    // Remaining inputs in pending_inputs_ are unacknowledged\n    // \u2192 Can be used for reconciliation if needed\n}\n</code></pre>"},{"location":"UDP_ACK_SYSTEM/#42-server-side-servernetworksystem","title":"4.2 Server-Side (ServerNetworkSystem)","text":"<p>Files: - <code>src/r-type/server/include/ServerNetworkSystem.hpp</code> - <code>src/r-type/server/src/ServerNetworkSystem.cpp</code></p>"},{"location":"UDP_ACK_SYSTEM/#data-structure_1","title":"Data Structure","text":"<pre><code>class ServerNetworkSystem {\nprivate:\n    // Tracking last processed input per player\n    std::unordered_map&lt;uint32_t, uint32_t&gt; last_processed_input_seq_;\n    // Key: player_id, Value: last processed input sequence\n};\n</code></pre>"},{"location":"UDP_ACK_SYSTEM/#processing-input-with-sequence","title":"Processing Input with Sequence","text":"<pre><code>void ServerNetworkSystem::on_input_received(\n    uint32_t player_id,\n    const ClientInputPayload&amp; input\n) {\n    uint32_t input_seq = input.sequence_number;\n\n    // Check if this input has already been processed (duplication)\n    if (input_seq &lt;= last_processed_input_seq_[player_id]) {\n        // Input already processed or old out-of-order \u2192 ignore\n        return;\n    }\n\n    // Process input (apply movement, shooting, etc.)\n    process_player_input(player_id, input);\n\n    // Update last processed input\n    last_processed_input_seq_[player_id] = input_seq;\n\n    // Next snapshot will automatically include this last_ack_sequence\n}\n</code></pre>"},{"location":"UDP_ACK_SYSTEM/#generating-snapshot-with-ack","title":"Generating Snapshot with ACK","text":"<pre><code>void ServerNetworkSystem::send_snapshot() {\n    SnapshotPayload snapshot;\n    snapshot.server_tick = current_tick_;\n\n    // For each game entity\n    for (const auto&amp; entity : game_entities_) {\n        EntityState state;\n        state.entity_id = entity.id;\n        state.position_x = entity.position.x;\n        state.position_y = entity.position.y;\n        // ... other fields ...\n\n        // If it's a player, include last_ack_sequence\n        if (entity.is_player()) {\n            uint32_t player_id = entity.get_player_id();\n            state.last_ack_sequence = last_processed_input_seq_[player_id];\n        } else {\n            state.last_ack_sequence = 0;  // Not applicable\n        }\n\n        snapshot.entities.push_back(state);\n    }\n\n    // Broadcast snapshot to all clients\n    broadcast_snapshot(snapshot);\n}\n</code></pre>"},{"location":"UDP_ACK_SYSTEM/#5-data-flow","title":"5. Data Flow","text":""},{"location":"UDP_ACK_SYSTEM/#51-normal-scenario-no-packet-loss","title":"5.1 Normal Scenario (no packet loss)","text":"<pre><code>Time  \u2502 Client (sequence)           \u2502 Server (last_ack)       \u2502 Network\n\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt=0   \u2502 Send INPUT seq=100 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                         \u2502 [OK] Delivered\nt=16  \u2502                             \u2502 Process seq=100         \u2502\n      \u2502                             \u2502 last_ack[player] = 100  \u2502\nt=16  \u2502                             \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500 SNAPSHOT         \u2502 last_ack=100\nt=32  \u2502 Receive ACK(100)            \u2502                         \u2502\n      \u2502 \u2192 Confirm input 100         \u2502                         \u2502\n      \u2502 \u2192 Remove from pending       \u2502                         \u2502\n\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt=33  \u2502 Send INPUT seq=101 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                         \u2502 [OK] Delivered\nt=49  \u2502                             \u2502 Process seq=101         \u2502\n      \u2502                             \u2502 last_ack[player] = 101  \u2502\nt=49  \u2502                             \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500 SNAPSHOT         \u2502 last_ack=101\nt=65  \u2502 Receive ACK(101)            \u2502                         \u2502\n      \u2502 \u2192 Confirm input 101         \u2502                         \u2502\n</code></pre> <p>Result: Input RTT \u2248 32-65ms (typical for 60 Hz updates)</p>"},{"location":"UDP_ACK_SYSTEM/#52-packet-loss-scenario","title":"5.2 Packet Loss Scenario","text":"<pre><code>Time  \u2502 Client (sequence)           \u2502 Server (last_ack)       \u2502 Network\n\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt=0   \u2502 Send INPUT seq=200 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                         \u2502 [LOST]\n      \u2502 pending: [200]              \u2502                         \u2502\n\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt=16  \u2502                             \u2502 No input received       \u2502\n      \u2502                             \u2502 last_ack[player] = 199  \u2502 (unchanged)\nt=16  \u2502                             \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500 SNAPSHOT         \u2502 last_ack=199\nt=32  \u2502 Receive ACK(199)            \u2502                         \u2502\n      \u2502 \u2192 Input 200 still pending   \u2502                         \u2502\n      \u2502 pending: [200]              \u2502                         \u2502\n\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt=33  \u2502 Send INPUT seq=201 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                         \u2502 [OK] Delivered\n      \u2502 pending: [200, 201]         \u2502                         \u2502\nt=49  \u2502                             \u2502 Process seq=201         \u2502\n      \u2502                             \u2502 last_ack[player] = 201  \u2502 &lt;- Skip seq=200\nt=49  \u2502                             \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500 SNAPSHOT         \u2502 last_ack=201\nt=65  \u2502 Receive ACK(201)            \u2502                         \u2502\n      \u2502 \u2192 Confirm inputs \u2264 201      \u2502                         \u2502\n      \u2502 \u2192 Remove 200 AND 201        \u2502                         \u2502\n      \u2502 pending: []                 \u2502                         \u2502\n</code></pre> <p>Result: - Server processes seq=201 regardless of seq=200 loss - Client removes all inputs with sequence &lt;= 201 from pending buffer - Input seq=200 is permanently lost (acceptable trade-off for high-frequency input streams)</p>"},{"location":"UDP_ACK_SYSTEM/#53-out-of-order-delivery-scenario","title":"5.3 Out-of-Order Delivery Scenario","text":"<pre><code>Time  \u2502 Client (sequence)           \u2502 Server (last_ack)       \u2502 Network\n\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt=0   \u2502 Send INPUT seq=300 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                         \u2502 [DELAYED]\nt=16  \u2502 Send INPUT seq=301 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                         \u2502 [OK] Fast path\n\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt=20  \u2502                             \u2502 Receive seq=301 FIRST!  \u2502\n      \u2502                             \u2502 Process seq=301         \u2502\n      \u2502                             \u2502 last_ack = 301          \u2502\n\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt=30  \u2502                             \u2502 Receive seq=300 (late)  \u2502\n      \u2502                             \u2502 \u2192 seq=300 &lt; last_ack    \u2502\n      \u2502                             \u2502 \u2192 REJECT (already past) \u2502\n\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nt=32  \u2502                             \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500 SNAPSHOT         \u2502 last_ack=301\nt=48  \u2502 Receive ACK(301)            \u2502                         \u2502\n      \u2502 \u2192 Confirm inputs \u2264 301      \u2502                         \u2502\n      \u2502 \u2192 Remove 300 and 301        \u2502                         \u2502\n</code></pre> <p>Result: - Server rejects stale out-of-order inputs - Duplicate processing is prevented - Client buffer cleanup proceeds correctly via last_ack</p>"},{"location":"UDP_ACK_SYSTEM/#6-advantages-and-trade-offs","title":"6. Advantages and Trade-offs","text":""},{"location":"UDP_ACK_SYSTEM/#61-advantages","title":"6.1 Advantages","text":""},{"location":"UDP_ACK_SYSTEM/#bandwidth-efficiency","title":"Bandwidth Efficiency","text":"<ul> <li>Piggybacking: ACK is embedded within state snapshots, eliminating dedicated acknowledgment packets</li> <li>Minimal overhead: 4 bytes per player entity (field already present in EntityState)</li> <li>No retransmissions: Unlike TCP, the protocol does not perform automatic retransmissions</li> </ul>"},{"location":"UDP_ACK_SYSTEM/#low-latency","title":"Low Latency","text":"<ul> <li>No head-of-line blocking: Each input packet is processed independently</li> <li>Asynchronous transmission: Client can send seq=N+1 before receiving ACK(N)</li> <li>Native UDP performance: Minimal processing overhead (~1-2ms compared to raw UDP)</li> </ul>"},{"location":"UDP_ACK_SYSTEM/#packet-loss-detection","title":"Packet Loss Detection","text":"<ul> <li>Sequence gap analysis: If ACK jumps from 100 to 103, packets 101-102 are identified as lost</li> <li>Metrics collection: Packet loss rate can be computed automatically</li> <li>Adaptive behavior: Protocol strategy can be adjusted based on observed loss rate</li> </ul>"},{"location":"UDP_ACK_SYSTEM/#client-server-reconciliation","title":"Client-Server Reconciliation","text":"<ul> <li>Client-side prediction: Inputs are applied locally for immediate responsiveness</li> <li>Server confirmation: ACK validates that server state matches client expectations</li> <li>Divergence correction: State mismatches are corrected using authoritative server snapshots</li> </ul>"},{"location":"UDP_ACK_SYSTEM/#62-trade-offs","title":"6.2 Trade-offs","text":""},{"location":"UDP_ACK_SYSTEM/#no-delivery-guarantee","title":"No Delivery Guarantee","text":"<ul> <li>Lost inputs: A lost input packet is not recovered</li> <li>Mitigation: High input frequency (60 Hz) renders single input loss negligible</li> <li>Impact: Players may experience brief input lag if multiple consecutive packets are lost</li> </ul>"},{"location":"UDP_ACK_SYSTEM/#ack-delay","title":"ACK Delay","text":"<ul> <li>Latency: ACK is delivered with the next snapshot (~16-33ms at 60-30 Hz update rate)</li> <li>No immediate acknowledgment: Unlike TCP, instant ACK is not provided</li> <li>Design rationale: Immediate ACK is sacrificed to reduce packet count</li> </ul>"},{"location":"UDP_ACK_SYSTEM/#out-of-order-handling","title":"Out-of-Order Handling","text":"<ul> <li>Rejection policy: Stale out-of-order inputs are discarded</li> <li>Consequence: Delayed inputs may be lost even upon arrival</li> <li>Justification: At 60 Hz tick rate, an input delayed by 50ms provides no gameplay value</li> </ul>"},{"location":"UDP_ACK_SYSTEM/#7-metrics-and-monitoring","title":"7. Metrics and Monitoring","text":""},{"location":"UDP_ACK_SYSTEM/#71-client-side-metrics","title":"7.1 Client-Side Metrics","text":""},{"location":"UDP_ACK_SYSTEM/#pending-inputs","title":"Pending Inputs","text":"<pre><code>size_t pending_count = pending_inputs_.size();\n\nif (pending_count &gt; 30) {\n    // WARNING: More than 30 unacknowledged inputs\n    // \u2192 Probable network issues or server lag\n    display_warning(\"High latency detected\");\n}\n\nif (pending_count &gt; 60) {\n    // CRITICAL: Buffer full\n    // \u2192 Connection timeout probable\n    disconnect_with_error(\"Connection lost\");\n}\n</code></pre>"},{"location":"UDP_ACK_SYSTEM/#input-acknowledgment-delay","title":"Input Acknowledgment Delay","text":"<pre><code>uint32_t input_rtt_ms = current_time - pending_inputs_.front().timestamp;\n\nif (input_rtt_ms &gt; 200) {\n    // Input ACK takes more than 200ms\n    // \u2192 Display lag indicator\n    show_lag_indicator();\n}\n</code></pre>"},{"location":"UDP_ACK_SYSTEM/#packet-loss-rate","title":"Packet Loss Rate","text":"<pre><code>uint32_t total_inputs_sent = 0;\nuint32_t total_inputs_acked = 0;\n\nvoid on_input_sent() { total_inputs_sent++; }\nvoid on_ack_received(uint32_t ack_seq) {\n    // Count how many inputs were ACKed\n    total_inputs_acked++;\n}\n\nfloat packet_loss_rate = 1.0f - (float(total_inputs_acked) / total_inputs_sent);\n// Example: 0.023 = 2.3% packet loss\n</code></pre>"},{"location":"UDP_ACK_SYSTEM/#72-server-side-metrics","title":"7.2 Server-Side Metrics","text":""},{"location":"UDP_ACK_SYSTEM/#input-reception-rate","title":"Input Reception Rate","text":"<pre><code>std::unordered_map&lt;uint32_t, uint32_t&gt; inputs_received_per_player;\nstd::unordered_map&lt;uint32_t, uint32_t&gt; last_input_time_per_player;\n\nvoid on_input_received(uint32_t player_id) {\n    inputs_received_per_player[player_id]++;\n    last_input_time_per_player[player_id] = current_time_ms();\n}\n\nvoid check_player_timeout() {\n    for (const auto&amp; [player_id, last_time] : last_input_time_per_player) {\n        uint32_t silence_duration = current_time_ms() - last_time;\n\n        if (silence_duration &gt; 10000) {  // 10 seconds\n            // No input for 10s \u2192 Disconnect\n            disconnect_player(player_id, \"Timeout\");\n        } else if (silence_duration &gt; 5000) {\n            // 5 seconds \u2192 Warning\n            log_warning(\"Player {} inactive for 5s\", player_id);\n        }\n    }\n}\n</code></pre>"},{"location":"UDP_ACK_SYSTEM/#sequence-gap-detection","title":"Sequence Gap Detection","text":"<pre><code>void on_input_received(uint32_t player_id, uint32_t input_seq) {\n    uint32_t expected_seq = last_processed_input_seq_[player_id] + 1;\n\n    if (input_seq &gt; expected_seq) {\n        uint32_t gap = input_seq - expected_seq;\n\n        // Log packet loss\n        log_info(\"Player {} lost {} inputs (seq {}-{})\",\n                 player_id, gap, expected_seq, input_seq - 1);\n\n        // Statistics\n        packet_loss_stats_[player_id] += gap;\n    }\n}\n</code></pre>"},{"location":"UDP_ACK_SYSTEM/#73-logging-and-debugging","title":"7.3 Logging and Debugging","text":""},{"location":"UDP_ACK_SYSTEM/#recommended-log-format","title":"Recommended Log Format","text":"<pre><code>[Client] INPUT_SENT    seq=12345 flags=0x05 ts=1234567890\n[Client] ACK_RECEIVED  seq=12340 (5 inputs pending)\n[Server] INPUT_RECV    player=1 seq=12345 (gap=0)\n[Server] INPUT_PROCESS player=1 seq=12345 last_ack=12345\n[Server] SNAPSHOT_SENT tick=6789 entities=20 (player1_ack=12345)\n</code></pre>"},{"location":"UDP_ACK_SYSTEM/#debug-visualization-optional","title":"Debug Visualization (optional)","text":"<pre><code>Client Sequence Timeline:\n[100][101][102][X][104][105][106]  &lt;- X = packet lost\n       ^                    ^\n       +-- ACK(101)         +-- ACK(106) -&gt; clears all &lt;=106\n\nServer Processed Sequence:\n[100][101][102][  ][104][105][106]  &lt;- Gap detected between 102-104\n                    ^\n                    +-- Server continues with seq=104\n</code></pre>"},{"location":"UDP_ACK_SYSTEM/#8-comparison-with-other-approaches","title":"8. Comparison with Other Approaches","text":""},{"location":"UDP_ACK_SYSTEM/#81-tcp-reliable-stream","title":"8.1 TCP (Reliable Stream)","text":"Criteria TCP R-Type UDP ACK Delivery guarantee Yes No (acceptable for use case) Order guarantee Yes No (stale inputs rejected) Latency Variable (retransmissions) Consistent and low Head-of-line blocking Present Absent Header overhead ~20 bytes 8 bytes Congestion control Automatic Manual (if required) <p>Analysis: The UDP ACK approach provides superior performance characteristics for real-time gameplay scenarios.</p>"},{"location":"UDP_ACK_SYSTEM/#82-quic-udp-with-reliable-streams","title":"8.2 QUIC (UDP with Reliable Streams)","text":"Criteria QUIC R-Type UDP ACK Implementation complexity High (cryptography, streams) Low Latency Low Low Multiplexed streams Supported Not required Header overhead ~30-50 bytes 9-13 bytes Target domain Web transport standard Gaming-specific <p>Analysis: QUIC introduces unnecessary complexity for this use case. The additional features (TLS 1.3, stream multiplexing) are not required for game input acknowledgment.</p>"},{"location":"UDP_ACK_SYSTEM/#83-enet-gaming-library","title":"8.3 ENet (Gaming Library)","text":"Criteria ENet R-Type UDP ACK Reliable channels Full support Partial (implicit ACK) Sequenced channels Supported Supported (sequence numbers) Unsequenced channels Supported Supported (events) Header overhead ~8-12 bytes 9-13 bytes External dependency Required None (custom implementation) <p>Analysis: The R-Type implementation provides functionality comparable to ENet while being specifically optimized for the game's requirements without external dependencies.</p>"},{"location":"UDP_ACK_SYSTEM/#9-conclusion","title":"9. Conclusion","text":""},{"location":"UDP_ACK_SYSTEM/#91-summary","title":"9.1 Summary","text":"<p>The R-Type UDP ACK system implements an implicit acknowledgment mechanism via piggybacking with the following characteristics:</p> <ul> <li>Uses <code>sequence_number</code> fields for input ordering and tracking</li> <li>Embeds <code>last_ack_sequence</code> within state snapshots, eliminating dedicated ACK packets</li> <li>Enables detection of packet loss and out-of-order delivery</li> <li>Supports client-side prediction and server-authoritative reconciliation</li> <li>Maintains low latency while optimizing bandwidth utilization</li> </ul>"},{"location":"UDP_ACK_SYSTEM/#92-key-advantages","title":"9.2 Key Advantages","text":"<ol> <li>Efficient: No network overhead (ACK in existing snapshot)</li> <li>Low latency: No blocking, independent inputs</li> <li>Robust: Packet loss and timeout detection</li> <li>Simple: Clear and maintainable implementation</li> </ol>"},{"location":"UDP_ACK_SYSTEM/#93-acceptable-limitations","title":"9.3 Acceptable Limitations","text":"<ol> <li>No delivery guarantee: A lost input is lost (OK @ 60 Hz)</li> <li>ACK delay: ~16-33ms depending on snapshot rate (acceptable)</li> <li>Out-of-order rejection: Old inputs rejected (OK for real-time)</li> </ol>"},{"location":"UDP_ACK_SYSTEM/#94-applicability","title":"9.4 Applicability","text":"<p>Recommended use cases: - Real-time action games (shooters, racing, fighting games) - Applications requiring low latency with high update frequency - Systems tolerant to occasional data loss</p> <p>Not recommended for: - Chat or messaging systems (reliable channels preferred) - File transfers (TCP recommended) - Critical transactions (TCP with explicit acknowledgment required)</p>"},{"location":"UDP_ACK_SYSTEM/#10-references","title":"10. References","text":""},{"location":"UDP_ACK_SYSTEM/#101-source-files","title":"10.1 Source Files","text":"<ul> <li>Protocol definition: <code>src/r-type/shared/protocol/PacketHeader.hpp</code></li> <li>Payloads: <code>src/r-type/shared/protocol/Payloads.hpp</code></li> <li>Client prediction: <code>src/r-type/client/src/systems/ClientPredictionSystem.cpp</code></li> <li>Server network: <code>src/r-type/server/src/ServerNetworkSystem.cpp</code></li> </ul>"},{"location":"UDP_ACK_SYSTEM/#102-related-documentation","title":"10.2 Related Documentation","text":"<ul> <li>PROTOCOL.md - Complete protocol specification</li> <li>CLIENT_ARCHITECTURE.md - Client architecture</li> <li>SERVER_ARCHITECTURE.md - Server architecture</li> </ul>"},{"location":"UDP_ACK_SYSTEM/#103-external-resources","title":"10.3 External Resources","text":"<ul> <li>Gaffer on Games - Networked Physics</li> <li>Valve - Latency Compensating Methods</li> <li>Glenn Fiedler - UDP vs TCP</li> </ul> <p>Document written by R-Type Development Team Last updated: January 2026 Version: 1.0</p>"},{"location":"WAVE_CONFIGURATION_GUIDE/","title":"Wave Configuration Guide - 2-Chunks Pattern","text":"<p>This guide explains how to configure waves (enemy waves) for new R-Type game maps.</p>"},{"location":"WAVE_CONFIGURATION_GUIDE/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Overview</li> <li>Chunk System</li> <li>Standard Pattern: 2-Chunks</li> <li>JSON Wave Structure</li> <li>Enemy Composition by Difficulty</li> <li>Boss Configuration</li> <li>Complete Examples</li> <li>Validation</li> </ol>"},{"location":"WAVE_CONFIGURATION_GUIDE/#overview","title":"Overview","text":"<p>The R-Type wave system is based on chunk-based triggering (map pieces) rather than absolute scroll distance.</p>"},{"location":"WAVE_CONFIGURATION_GUIDE/#key-concepts","title":"Key Concepts","text":"<ul> <li>Chunk: Basic map unit (1 chunk = 480 pixels = 30 tiles \u00d7 16px)</li> <li>ChunkId: Chunk position on the map (0-indexed)</li> <li>Offset: Relative position within chunk (0.0 = start, 1.0 = end)</li> <li>Wave: Enemy wave triggered at a specific chunk position</li> <li>Phase: Group of waves with consistent difficulty (easy/medium/hard)</li> </ul>"},{"location":"WAVE_CONFIGURATION_GUIDE/#chunk-system","title":"Chunk System","text":""},{"location":"WAVE_CONFIGURATION_GUIDE/#dimensions","title":"Dimensions","text":"<pre><code>1 chunk = 480 pixels\n1 tile = 16 pixels\n1 chunk = 30 tiles\n</code></pre>"},{"location":"WAVE_CONFIGURATION_GUIDE/#position-calculation","title":"Position Calculation","text":"<p>To calculate scroll distance for a chunk:</p> <pre><code>scroll_distance = chunkId \u00d7 480\n</code></pre> <p>Examples: - Chunk 0: 0 pixels - Chunk 2: 960 pixels - Chunk 10: 4800 pixels - Chunk 20: 9600 pixels (standard level end)</p>"},{"location":"WAVE_CONFIGURATION_GUIDE/#chunkid-offset","title":"ChunkId + Offset","text":"<p>A wave trigger uses <code>chunkId</code> (integer) + <code>offset</code> (decimal):</p> <pre><code>{\n  \"chunkId\": 4,\n  \"offset\": 0.0\n}\n</code></pre> <ul> <li><code>offset: 0.0</code> \u2192 Chunk start (exact position = 4 \u00d7 480 = 1920px)</li> <li><code>offset: 0.5</code> \u2192 Chunk middle (exact position = 1920 + 240 = 2160px)</li> <li><code>offset: 1.0</code> \u2192 Chunk end (exact position = 1920 + 480 = 2400px)</li> </ul>"},{"location":"WAVE_CONFIGURATION_GUIDE/#standard-pattern-2-chunks","title":"Standard Pattern: 2-Chunks","text":""},{"location":"WAVE_CONFIGURATION_GUIDE/#official-rule","title":"Official Rule","text":"<p>Each level must have waves spaced 2 chunks apart.</p>"},{"location":"WAVE_CONFIGURATION_GUIDE/#standard-configuration-20-total-chunks","title":"Standard Configuration (20 total chunks)","text":"<p>For a level with 20 chunks:</p> Wave ChunkId Scroll Distance Position 1 0 0 px Start 2 2 960 px 3 4 1920 px 4 6 2880 px 5 8 3840 px 6 10 4800 px 7 12 5760 px 8 14 6720 px 9 16 7680 px 10 18 8640 px Last Boss N/A 9600 px After chunk 20"},{"location":"WAVE_CONFIGURATION_GUIDE/#2-chunks-pattern-advantages","title":"2-Chunks Pattern Advantages","text":"<p>\u2713 Regular and predictable rhythm \u2713 10 waves per level = good gameplay balance \u2713 Constant preparation time between waves \u2713 Easy to test and debug</p>"},{"location":"WAVE_CONFIGURATION_GUIDE/#json-wave-structure","title":"JSON Wave Structure","text":""},{"location":"WAVE_CONFIGURATION_GUIDE/#wave-template","title":"Wave Template","text":"<pre><code>{\n  \"wave_number\": 1,\n  \"trigger\": {\n    \"chunkId\": 0,\n    \"offset\": 0.0,\n    \"timeDelay\": 0\n  },\n  \"spawns\": [\n    {\n      \"type\": \"enemy\",\n      \"enemyType\": \"basic\",\n      \"positionX\": 2100,\n      \"positionY\": 300,\n      \"count\": 3,\n      \"pattern\": \"line\",\n      \"spacing\": 120\n    },\n    {\n      \"type\": \"powerup\",\n      \"bonusType\": \"health\",\n      \"positionX\": 2300,\n      \"positionY\": 540,\n      \"count\": 1,\n      \"pattern\": \"single\"\n    }\n  ]\n}\n</code></pre>"},{"location":"WAVE_CONFIGURATION_GUIDE/#required-fields","title":"Required Fields","text":""},{"location":"WAVE_CONFIGURATION_GUIDE/#wave_number-integer","title":"wave_number (integer)","text":"<ul> <li>Sequential wave number (1, 2, 3...)</li> <li>IMPORTANT: Must be unique and sequential</li> <li>Used for server/client tracking</li> </ul>"},{"location":"WAVE_CONFIGURATION_GUIDE/#trigger-object","title":"trigger (object)","text":"<ul> <li>chunkId (integer): Chunk position (0-19 for 20 chunks)</li> <li>offset (float): Position within chunk (0.0-1.0)</li> <li>timeDelay (integer): Additional delay in seconds (usually 0)</li> </ul>"},{"location":"WAVE_CONFIGURATION_GUIDE/#spawns-array","title":"spawns (array)","text":"<ul> <li>List of entities to spawn in this wave</li> <li>Can contain enemies and powerups</li> <li>At least 1 spawn required</li> </ul>"},{"location":"WAVE_CONFIGURATION_GUIDE/#spawn-types","title":"Spawn Types","text":""},{"location":"WAVE_CONFIGURATION_GUIDE/#enemy-spawn","title":"Enemy Spawn","text":"<pre><code>{\n  \"type\": \"enemy\",\n  \"enemyType\": \"basic|zigzag|bouncer|tank|kamikaze\",\n  \"positionX\": 2100,\n  \"positionY\": 300,\n  \"count\": 3,\n  \"pattern\": \"line|grid|formation|random|single\",\n  \"spacing\": 120\n}\n</code></pre> <p>Available Enemy Types: - <code>basic</code>: Standard enemy, linear movement - <code>zigzag</code>: Vertical zigzag movement - <code>bouncer</code>: Bounces off screen edges - <code>tank</code>: Slow but resistant enemy - <code>kamikaze</code>: Rushes toward player</p> <p>Spawn Patterns: - <code>single</code>: Single enemy (ignores count/spacing) - <code>line</code>: Vertical line of enemies - <code>grid</code>: 2D grid (requires horizontal/vertical spacing) - <code>formation</code>: Predefined formation - <code>random</code>: Random positions in an area</p>"},{"location":"WAVE_CONFIGURATION_GUIDE/#powerup-spawn","title":"Powerup Spawn","text":"<pre><code>{\n  \"type\": \"powerup\",\n  \"bonusType\": \"health|shield|speed|firepower\",\n  \"positionX\": 2300,\n  \"positionY\": 540,\n  \"count\": 1,\n  \"pattern\": \"single\"\n}\n</code></pre> <p>Bonus Types: - <code>health</code>: Restores health - <code>shield</code>: Temporary shield - <code>speed</code>: Increases speed - <code>firepower</code>: Improves shots</p>"},{"location":"WAVE_CONFIGURATION_GUIDE/#enemy-composition-by-difficulty","title":"Enemy Composition by Difficulty","text":""},{"location":"WAVE_CONFIGURATION_GUIDE/#phase-1-easy-waves-1-3-chunks-0-4","title":"Phase 1: Easy (Waves 1-3, Chunks 0-4)","text":"<p>Objective: Progressive introduction, low threat</p> <p>Recommendations: - Mostly <code>basic</code> (60-80%) - Some <code>zigzag</code> for variety (20-30%) - 1 <code>health</code> powerup in wave 3</p> <p>Example Wave 1: <pre><code>{\n  \"wave_number\": 1,\n  \"trigger\": {\"chunkId\": 0, \"offset\": 0.0, \"timeDelay\": 0},\n  \"spawns\": [\n    {\n      \"type\": \"enemy\",\n      \"enemyType\": \"basic\",\n      \"positionX\": 2100,\n      \"positionY\": 300,\n      \"count\": 3,\n      \"pattern\": \"line\",\n      \"spacing\": 150\n    }\n  ]\n}\n</code></pre></p>"},{"location":"WAVE_CONFIGURATION_GUIDE/#phase-2-medium-waves-4-7-chunks-6-12","title":"Phase 2: Medium (Waves 4-7, Chunks 6-12)","text":"<p>Objective: Difficulty increase, introduction of advanced enemies</p> <p>Recommendations: - Mix <code>zigzag</code>, <code>bouncer</code>, <code>tank</code> - First appearances of <code>kamikaze</code> - Strategic powerups (<code>shield</code>, <code>speed</code>) - Multiple spawns in one wave (2-3 groups)</p> <p>Example Wave 5: <pre><code>{\n  \"wave_number\": 5,\n  \"trigger\": {\"chunkId\": 8, \"offset\": 0.0, \"timeDelay\": 0},\n  \"spawns\": [\n    {\n      \"type\": \"enemy\",\n      \"enemyType\": \"tank\",\n      \"positionX\": 2100,\n      \"positionY\": 250,\n      \"count\": 2,\n      \"pattern\": \"line\",\n      \"spacing\": 280\n    },\n    {\n      \"type\": \"enemy\",\n      \"enemyType\": \"bouncer\",\n      \"positionX\": 2200,\n      \"positionY\": 600,\n      \"count\": 3,\n      \"pattern\": \"line\",\n      \"spacing\": 130\n    },\n    {\n      \"type\": \"powerup\",\n      \"bonusType\": \"shield\",\n      \"positionX\": 2300,\n      \"positionY\": 450,\n      \"count\": 1,\n      \"pattern\": \"single\"\n    }\n  ]\n}\n</code></pre></p>"},{"location":"WAVE_CONFIGURATION_GUIDE/#phase-3-hard-waves-8-10-chunks-14-18","title":"Phase 3: Hard (Waves 8-10, Chunks 14-18)","text":"<p>Objective: Maximum difficulty, boss preparation</p> <p>Recommendations: - Many <code>tank</code>, <code>kamikaze</code>, <code>bouncer</code> - Multiple and simultaneous spawns (3-4 groups) - Rare but powerful powerups - Last <code>health</code> powerup in wave 10 (before boss)</p> <p>Example Wave 10: <pre><code>{\n  \"wave_number\": 10,\n  \"trigger\": {\"chunkId\": 18, \"offset\": 0.0, \"timeDelay\": 0},\n  \"spawns\": [\n    {\n      \"type\": \"enemy\",\n      \"enemyType\": \"tank\",\n      \"positionX\": 2100,\n      \"positionY\": 300,\n      \"count\": 3,\n      \"pattern\": \"line\",\n      \"spacing\": 180\n    },\n    {\n      \"type\": \"enemy\",\n      \"enemyType\": \"bouncer\",\n      \"positionX\": 2200,\n      \"positionY\": 150,\n      \"count\": 4,\n      \"pattern\": \"line\",\n      \"spacing\": 140\n    },\n    {\n      \"type\": \"enemy\",\n      \"enemyType\": \"kamikaze\",\n      \"positionX\": 2300,\n      \"positionY\": 750,\n      \"count\": 3,\n      \"pattern\": \"line\",\n      \"spacing\": 120\n    },\n    {\n      \"type\": \"powerup\",\n      \"bonusType\": \"health\",\n      \"positionX\": 2400,\n      \"positionY\": 540,\n      \"count\": 1,\n      \"pattern\": \"single\"\n    }\n  ]\n}\n</code></pre></p>"},{"location":"WAVE_CONFIGURATION_GUIDE/#boss-configuration","title":"Boss Configuration","text":""},{"location":"WAVE_CONFIGURATION_GUIDE/#standard-spawn-distance","title":"Standard Spawn Distance","text":"<p>The boss must always spawn after chunk 20:</p> <pre><code>\"boss\": {\n  \"boss_name\": \"Boss Name\",\n  \"spawn_scroll_distance\": 9600.0,\n  \"spawn_position_x\": 1600.0,\n  \"spawn_position_y\": 540.0,\n  \"enemy_type\": \"boss\",\n  \"total_phases\": 3,\n  \"script_path\": \"boss/boss_script.lua\",\n  \"phases\": [...]\n}\n</code></pre>"},{"location":"WAVE_CONFIGURATION_GUIDE/#spawn_scroll_distance-calculation","title":"spawn_scroll_distance Calculation","text":"<pre><code>spawn_scroll_distance = (total_chunks) \u00d7 480\n                      = 20 \u00d7 480\n                      = 9600.0 pixels\n</code></pre>"},{"location":"WAVE_CONFIGURATION_GUIDE/#recommended-spawn-position","title":"Recommended Spawn Position","text":"<ul> <li>spawn_position_x: 1600.0 (center-right of screen)</li> <li>spawn_position_y: 540.0 (vertical center, 1920\u00d71080 screen)</li> </ul>"},{"location":"WAVE_CONFIGURATION_GUIDE/#boss-phases","title":"Boss Phases","text":"<p>Each boss generally has 3 phases based on health threshold:</p> <pre><code>\"phases\": [\n  {\n    \"phase_number\": 1,\n    \"health_threshold\": 1.0,     // 100% \u2192 66% HP\n    \"movement_pattern\": \"vertical_sine\",\n    \"movement_speed_multiplier\": 1.0,\n    \"attack_patterns\": [...]\n  },\n  {\n    \"phase_number\": 2,\n    \"health_threshold\": 0.66,    // 66% \u2192 33% HP\n    \"movement_pattern\": \"figure_eight\",\n    \"movement_speed_multiplier\": 1.3,\n    \"attack_patterns\": [...]\n  },\n  {\n    \"phase_number\": 3,\n    \"health_threshold\": 0.33,    // 33% \u2192 0% HP\n    \"movement_pattern\": \"chase_player\",\n    \"movement_speed_multiplier\": 1.6,\n    \"attack_patterns\": [...]\n  }\n]\n</code></pre>"},{"location":"WAVE_CONFIGURATION_GUIDE/#complete-examples","title":"Complete Examples","text":""},{"location":"WAVE_CONFIGURATION_GUIDE/#example-minimal-level-structure","title":"Example: Minimal Level Structure","text":"<pre><code>{\n  \"level_id\": 3,\n  \"level_name\": \"Level Name\",\n  \"level_description\": \"Short description\",\n  \"map_id\": 3,\n  \"base_scroll_speed\": 70.0,\n  \"total_chunks\": 20,\n  \"phases\": [\n    {\n      \"phase_number\": 1,\n      \"phase_name\": \"Easy Phase\",\n      \"scroll_start\": 0.0,\n      \"scroll_end\": 2400.0,\n      \"difficulty\": \"easy\",\n      \"waves\": [\n        {\n          \"wave_number\": 1,\n          \"trigger\": {\"chunkId\": 0, \"offset\": 0.0, \"timeDelay\": 0},\n          \"spawns\": [...]\n        },\n        {\n          \"wave_number\": 2,\n          \"trigger\": {\"chunkId\": 2, \"offset\": 0.0, \"timeDelay\": 0},\n          \"spawns\": [...]\n        },\n        {\n          \"wave_number\": 3,\n          \"trigger\": {\"chunkId\": 4, \"offset\": 0.0, \"timeDelay\": 0},\n          \"spawns\": [...]\n        }\n      ]\n    },\n    {\n      \"phase_number\": 2,\n      \"phase_name\": \"Medium Phase\",\n      \"scroll_start\": 2400.0,\n      \"scroll_end\": 6240.0,\n      \"difficulty\": \"medium\",\n      \"waves\": [\n        {\n          \"wave_number\": 4,\n          \"trigger\": {\"chunkId\": 6, \"offset\": 0.0, \"timeDelay\": 0},\n          \"spawns\": [...]\n        },\n        {\n          \"wave_number\": 5,\n          \"trigger\": {\"chunkId\": 8, \"offset\": 0.0, \"timeDelay\": 0},\n          \"spawns\": [...]\n        },\n        {\n          \"wave_number\": 6,\n          \"trigger\": {\"chunkId\": 10, \"offset\": 0.0, \"timeDelay\": 0},\n          \"spawns\": [...]\n        },\n        {\n          \"wave_number\": 7,\n          \"trigger\": {\"chunkId\": 12, \"offset\": 0.0, \"timeDelay\": 0},\n          \"spawns\": [...]\n        }\n      ]\n    },\n    {\n      \"phase_number\": 3,\n      \"phase_name\": \"Hard Phase\",\n      \"scroll_start\": 6240.0,\n      \"scroll_end\": 9600.0,\n      \"difficulty\": \"hard\",\n      \"waves\": [\n        {\n          \"wave_number\": 8,\n          \"trigger\": {\"chunkId\": 14, \"offset\": 0.0, \"timeDelay\": 0},\n          \"spawns\": [...]\n        },\n        {\n          \"wave_number\": 9,\n          \"trigger\": {\"chunkId\": 16, \"offset\": 0.0, \"timeDelay\": 0},\n          \"spawns\": [...]\n        },\n        {\n          \"wave_number\": 10,\n          \"trigger\": {\"chunkId\": 18, \"offset\": 0.0, \"timeDelay\": 0},\n          \"spawns\": [...]\n        }\n      ]\n    }\n  ],\n  \"boss\": {\n    \"boss_name\": \"Boss Name\",\n    \"spawn_scroll_distance\": 9600.0,\n    \"spawn_position_x\": 1600.0,\n    \"spawn_position_y\": 540.0,\n    \"enemy_type\": \"boss\",\n    \"total_phases\": 3,\n    \"script_path\": \"boss/boss_script.lua\",\n    \"phases\": [...]\n  }\n}\n</code></pre>"},{"location":"WAVE_CONFIGURATION_GUIDE/#checklist-for-new-level","title":"Checklist for New Level","text":"<ul> <li>[ ] Unique <code>level_id</code></li> <li>[ ] <code>total_chunks: 20</code></li> <li>[ ] Appropriate <code>base_scroll_speed</code> (50-80)</li> <li>[ ] 3 phases (easy/medium/hard)</li> <li>[ ] Exactly 10 waves (chunkIds: 0,2,4,6,8,10,12,14,16,18)</li> <li>[ ] Sequential <code>wave_number</code> (1-10)</li> <li>[ ] Strategically placed powerups (minimum 1 per phase)</li> <li>[ ] Boss at <code>spawn_scroll_distance: 9600.0</code></li> <li>[ ] Lua boss script exists in <code>assets/scripts/boss/</code></li> </ul>"},{"location":"WAVE_CONFIGURATION_GUIDE/#validation","title":"Validation","text":""},{"location":"WAVE_CONFIGURATION_GUIDE/#json-syntax-validation","title":"JSON Syntax Validation","text":"<p>Before testing in game, validate JSON syntax:</p> <pre><code>python3 -m json.tool src/r-type/assets/levels/level_X.json &gt; /dev/null\n</code></pre> <p>If no errors, the file is valid.</p>"},{"location":"WAVE_CONFIGURATION_GUIDE/#logic-validation","title":"Logic Validation","text":"<p>Check: 1. ChunkIds in ascending order (0,2,4,6...) 2. All offsets at 0.0 (strict pattern) 3. Sequential wave numbers (1,2,3...) 4. EnemyTypes exist (basic, zigzag, bouncer, tank, kamikaze) 5. Powerup in at least 1 wave per phase 6. Boss spawns after last wave</p>"},{"location":"WAVE_CONFIGURATION_GUIDE/#in-game-testing","title":"In-Game Testing","text":"<pre><code># Build the game\ncmake --build build\n\n# Launch server\n./build/bin/r-type_server\n\n# Launch client\n./build/bin/r-type_client\n\n# Select level to test\n</code></pre> <p>Test points: - \u2713 HUD displays \"WAVE 1 / 10\" immediately - \u2713 Wave 1 triggers at chunk 0 (~0px) - \u2713 Wave 2 triggers at chunk 2 (~960px) - \u2713 Waves continue every 2 chunks - \u2713 Boss spawns after wave 10 completed - \u2713 No errors in server/client logs</p>"},{"location":"WAVE_CONFIGURATION_GUIDE/#rules-summary","title":"Rules Summary","text":""},{"location":"WAVE_CONFIGURATION_GUIDE/#2-chunks-pattern-absolute-rule","title":"2-Chunks Pattern (Absolute Rule)","text":"<pre><code>Waves at chunks: 0, 2, 4, 6, 8, 10, 12, 14, 16, 18\nTotal waves: 10\nBoss spawn: 9600.0 (chunk 20)\n</code></pre>"},{"location":"WAVE_CONFIGURATION_GUIDE/#distribution-by-phase","title":"Distribution by Phase","text":"<pre><code>Phase 1 (Easy):   Waves 1-3  (chunks 0-4)\nPhase 2 (Medium): Waves 4-7  (chunks 6-12)\nPhase 3 (Hard):   Waves 8-10 (chunks 14-18)\n</code></pre>"},{"location":"WAVE_CONFIGURATION_GUIDE/#enemies-by-difficulty","title":"Enemies by Difficulty","text":"<pre><code>Easy:   basic (70%) + zigzag (30%)\nMedium: zigzag, bouncer, tank, kamikaze (mix)\nHard:   tank, kamikaze, bouncer (priority)\n</code></pre>"},{"location":"WAVE_CONFIGURATION_GUIDE/#powerups","title":"Powerups","text":"<pre><code>Phase 1: health (wave 3)\nPhase 2: shield or speed (wave 5 or 7)\nPhase 3: health (wave 10, before boss)\n</code></pre>"},{"location":"WAVE_CONFIGURATION_GUIDE/#references","title":"References","text":"<ul> <li>LEVEL_SYSTEM.md: Complete level system documentation</li> <li>WAVE_SYSTEM.md: Wave system documentation</li> <li>LUA_SCRIPTING.md: Lua scripting guide for enemies/bosses</li> </ul> <p>Last updated: 2025-01-17 Pattern version: 2-Chunks (v2.0)</p>"},{"location":"WAVE_SYSTEM/","title":"Wave System Documentation","text":""},{"location":"WAVE_SYSTEM/#overview","title":"Overview","text":"<p>The Wave System allows automatic spawning of entities (enemies, walls, obstacles, powerups) based on scrolling progression and configured via JSON files.</p>"},{"location":"WAVE_SYSTEM/#architecture","title":"Architecture","text":""},{"location":"WAVE_SYSTEM/#components","title":"Components","text":"<p>The following components have been added in <code>GameComponents.hpp</code>:</p> <ul> <li><code>WaveSpawnData</code>: Data for spawning an entity</li> <li><code>WaveTrigger</code>: Wave trigger conditions</li> <li><code>WaveController</code>: Global wave system controller</li> <li><code>SpawnPattern</code>: Enum for spawn patterns</li> <li><code>EntitySpawnType</code>: Enum for entity types</li> </ul>"},{"location":"WAVE_SYSTEM/#configuration","title":"Configuration","text":"<p>Configuration constants are defined in <code>WaveConfig.hpp</code>:</p> <pre><code>#define WAVE_DEFAULT_SPAWN_INTERVAL     2.0f    // Default interval between spawns\n#define WAVE_DEFAULT_BETWEEN_WAVES      5.0f    // Time between waves\n#define WAVE_SPAWN_OFFSET_X             50.0f   // Spawn offset to the right\n#define WAVE_SPAWN_MIN_Y                50.0f   // Minimum Y position\n#define WAVE_SPAWN_MAX_Y                1030.0f // Maximum Y position\n// ... and more\n</code></pre>"},{"location":"WAVE_SYSTEM/#systems","title":"Systems","text":"<ul> <li>WaveSpawnerSystem: Main system that manages wave spawning</li> <li>WaveConfigLoader: Utility for loading and validating JSON configurations</li> </ul>"},{"location":"WAVE_SYSTEM/#json-configuration-format","title":"JSON Configuration Format","text":""},{"location":"WAVE_SYSTEM/#basic-structure","title":"Basic Structure","text":"<pre><code>{\n  \"defaultSpawnInterval\": 2.0,\n  \"loopWaves\": false,\n  \"waves\": [...]\n}\n</code></pre>"},{"location":"WAVE_SYSTEM/#wave-format","title":"Wave Format","text":"<pre><code>{\n  \"trigger\": {\n    \"chunkId\": 1,        // Map chunk index (0-based, 1 chunk = 480px)\n    \"offset\": 0.5,       // Position within chunk (0.0 - 1.0)\n    \"timeDelay\": 2.0     // Delay after trigger (in seconds)\n  },\n  \"spawns\": [...]\n}\n</code></pre>"},{"location":"WAVE_SYSTEM/#spawn-format","title":"Spawn Format","text":"<pre><code>{\n  \"type\": \"enemy\",           // Type: \"enemy\", \"wall\", \"obstacle\", \"powerup\"\n  \"enemyType\": \"basic\",      // For enemies: \"basic\", \"fast\", \"tank\", \"boss\"\n  \"bonusType\": \"health\",     // For powerups: \"health\", \"shield\", \"speed\"\n  \"positionX\": 1920,         // Absolute X position\n  \"positionY\": 300,          // Absolute Y position\n  \"count\": 3,                // Number of entities to spawn\n  \"pattern\": \"line\",         // Pattern: \"single\", \"line\", \"grid\", \"random\", \"formation\"\n  \"spacing\": 150             // Spacing between entities (for patterns)\n}\n</code></pre>"},{"location":"WAVE_SYSTEM/#spawn-patterns","title":"Spawn Patterns","text":""},{"location":"WAVE_SYSTEM/#single","title":"SINGLE","text":"<p>Spawns a single entity at the specified position.</p> <pre><code>{\n  \"pattern\": \"single\",\n  \"count\": 1\n}\n</code></pre>"},{"location":"WAVE_SYSTEM/#line","title":"LINE","text":"<p>Spawns entities in a vertical line.</p> <pre><code>{\n  \"pattern\": \"line\",\n  \"count\": 5,\n  \"spacing\": 100  // Vertical spacing\n}\n</code></pre>"},{"location":"WAVE_SYSTEM/#grid","title":"GRID","text":"<p>Spawns entities in a grid.</p> <pre><code>{\n  \"pattern\": \"grid\",\n  \"count\": 9,\n  \"spacing\": 80  // Vertical spacing\n}\n</code></pre>"},{"location":"WAVE_SYSTEM/#random","title":"RANDOM","text":"<p>Spawns entities at random Y positions.</p> <pre><code>{\n  \"pattern\": \"random\",\n  \"count\": 4\n}\n</code></pre>"},{"location":"WAVE_SYSTEM/#formation","title":"FORMATION","text":"<p>Spawns entities in a V formation.</p> <pre><code>{\n  \"pattern\": \"formation\",\n  \"count\": 6,\n  \"spacing\": 80\n}\n</code></pre>"},{"location":"WAVE_SYSTEM/#usage-example","title":"Usage Example","text":""},{"location":"WAVE_SYSTEM/#1-code-integration","title":"1. Code Integration","text":"<pre><code>#include \"systems/WaveSpawnerSystem.hpp\"\n\n// In your initialization function\nauto waveSystem = std::make_unique&lt;WaveSpawnerSystem&gt;(graphics);\nregistry.register_system(std::move(waveSystem));\n\n// Load configuration\nauto* waveSpawner = registry.get_system&lt;WaveSpawnerSystem&gt;();\nif (waveSpawner) {\n    waveSpawner-&gt;loadWaveConfiguration(\"assets/waves_example.json\");\n}\n</code></pre>"},{"location":"WAVE_SYSTEM/#2-simple-configuration-example","title":"2. Simple Configuration Example","text":"<p>See <code>waves_simple.json</code>:</p> <pre><code>{\n  \"defaultSpawnInterval\": 2.0,\n  \"loopWaves\": false,\n  \"waves\": [\n    {\n      \"trigger\": {\n        \"chunkId\": 0,\n        \"offset\": 0.0,\n        \"timeDelay\": 0\n      },\n      \"spawns\": [\n        {\n          \"type\": \"enemy\",\n          \"enemyType\": \"basic\",\n          \"positionX\": 1920,\n          \"positionY\": 300,\n          \"count\": 1,\n          \"pattern\": \"single\",\n          \"spacing\": 0\n        }\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"WAVE_SYSTEM/#3-advanced-configuration-example","title":"3. Advanced Configuration Example","text":"<p>See <code>waves_example.json</code> for a complete example with: - 7 different waves - Multiple spawn patterns - Combinations of enemies and walls - Final boss</p>"},{"location":"WAVE_SYSTEM/#entity-configuration","title":"Entity Configuration","text":""},{"location":"WAVE_SYSTEM/#enemies","title":"Enemies","text":"<p>Enemy statistics are defined in <code>CombatConfig.hpp</code>:</p> <ul> <li>BASIC: Health 30, Speed 100, Cooldown 2.0s</li> <li>FAST: Health 20, Speed 200, Cooldown 1.5s</li> <li>TANK: Health 100, Speed 50, Cooldown 3.0s</li> <li>BOSS: Health 500, Speed 80, Cooldown 0.8s</li> </ul>"},{"location":"WAVE_SYSTEM/#walls-obstacles","title":"Walls &amp; Obstacles","text":"<p>Configured in <code>WaveConfig.hpp</code>:</p> <ul> <li>Walls: Health 100, Size 50x100</li> <li>Obstacles: Health 50, Size 50x100</li> </ul>"},{"location":"WAVE_SYSTEM/#powerups-bonuses","title":"Powerups (Bonuses)","text":"<p>Three types of powerups are available:</p> <ul> <li>health (Green): +20 HP to player</li> <li>shield (Purple): Protection from 1 hit (purple circle around player)</li> <li>speed (Blue): +50% speed for 20 seconds</li> </ul> <p>Powerup spawn example:</p> <pre><code>{\n  \"type\": \"powerup\",\n  \"bonusType\": \"health\",\n  \"positionX\": 1920,\n  \"positionY\": 500,\n  \"count\": 1,\n  \"pattern\": \"single\"\n}\n</code></pre>"},{"location":"WAVE_SYSTEM/#tips-best-practices","title":"Tips &amp; Best Practices","text":""},{"location":"WAVE_SYSTEM/#1-wave-planning","title":"1. Wave Planning","text":"<ul> <li>Start with simple waves (SINGLE, LINE)</li> <li>Progressively increase difficulty</li> <li>Use <code>chunkId</code> to position waves relative to scenery (1 chunk = 30 tiles)</li> <li>Use <code>timeDelay</code> to create suspense before bosses</li> </ul>"},{"location":"WAVE_SYSTEM/#2-spawn-patterns","title":"2. Spawn Patterns","text":"<ul> <li>LINE: Perfect for defensive formations</li> <li>GRID: Good for creating enemy walls</li> <li>RANDOM: Adds unpredictability</li> <li>FORMATION: Ideal for organized squadrons</li> </ul>"},{"location":"WAVE_SYSTEM/#3-entity-combinations","title":"3. Entity Combinations","text":"<p>Combine different types in the same wave:</p> <pre><code>{\n  \"spawns\": [\n    {\n      \"type\": \"wall\",\n      \"positionX\": 1920,\n      \"positionY\": 200,\n      \"count\": 2,\n      \"pattern\": \"line\",\n      \"spacing\": 400\n    },\n    {\n      \"type\": \"enemy\",\n      \"enemyType\": \"tank\",\n      \"positionX\": 2000,\n      \"positionY\": 400,\n      \"count\": 1,\n      \"pattern\": \"single\"\n    }\n  ]\n}\n</code></pre>"},{"location":"WAVE_SYSTEM/#4-testing","title":"4. Testing","text":"<p>Use <code>waves_simple.json</code> to test: - Verify spawns work - Adjust positions - Test patterns</p>"},{"location":"WAVE_SYSTEM/#system-limits","title":"System Limits","text":"<p>Defined in <code>WaveConfig.hpp</code>:</p> <ul> <li><code>WAVE_MAX_ACTIVE_WAVES</code>: Maximum 10 waves</li> <li><code>WAVE_MAX_ENTITIES_PER_WAVE</code>: Maximum 50 entities per wave</li> <li><code>WAVE_MIN_SPAWN_INTERVAL</code>: Minimum 0.5s between spawns</li> <li><code>WAVE_MAX_SPAWN_INTERVAL</code>: Maximum 10.0s between spawns</li> <li><code>WAVE_SPAWN_MIN_Y</code>: Minimum Y position 50px</li> <li><code>WAVE_SPAWN_MAX_Y</code>: Maximum Y position 1030px</li> </ul>"},{"location":"WAVE_SYSTEM/#troubleshooting","title":"Troubleshooting","text":""},{"location":"WAVE_SYSTEM/#waves-dont-trigger","title":"Waves Don't Trigger","text":"<ul> <li>Check that scrolling system is active</li> <li>Verify <code>chunkId</code> and <code>offset</code> are correct (0-based)</li> <li>Look at console logs for debug messages</li> </ul>"},{"location":"WAVE_SYSTEM/#entities-spawn-at-wrong-location","title":"Entities Spawn at Wrong Location","text":"<ul> <li>Check <code>positionX</code> and <code>positionY</code></li> <li>Verify Y positions are between <code>WAVE_SPAWN_MIN_Y</code> and <code>WAVE_SPAWN_MAX_Y</code></li> <li>Adjust <code>spacing</code> for patterns</li> </ul>"},{"location":"WAVE_SYSTEM/#json-wont-load","title":"JSON Won't Load","text":"<ul> <li>Check JSON syntax (commas, quotes, braces)</li> <li>Verify file path</li> <li>Look at error messages in console</li> </ul>"},{"location":"WAVE_SYSTEM/#files-structure","title":"Files Structure","text":"<pre><code>src/r-type/game-logic/\n\u251c\u2500\u2500 include/\n\u2502   \u251c\u2500\u2500 components/\n\u2502   \u2502   \u251c\u2500\u2500 GameComponents.hpp     # Wave components definitions\n\u2502   \u2502   \u2514\u2500\u2500 WaveConfig.hpp         # Wave configuration defines\n\u2502   \u251c\u2500\u2500 systems/\n\u2502   \u2502   \u2514\u2500\u2500 WaveSpawnerSystem.hpp  # Wave spawner system header\n\u2502   \u2514\u2500\u2500 utils/\n\u2502       \u2514\u2500\u2500 WaveConfigLoader.hpp   # JSON loader header\n\u2514\u2500\u2500 src/\n    \u251c\u2500\u2500 systems/\n    \u2502   \u2514\u2500\u2500 WaveSpawnerSystem.cpp  # Wave spawner implementation\n    \u2514\u2500\u2500 utils/\n        \u2514\u2500\u2500 WaveConfigLoader.cpp   # JSON loader implementation\n\nsrc/r-type/assets/\n\u251c\u2500\u2500 waves_example.json             # Complex example\n\u2514\u2500\u2500 waves_simple.json              # Simple example for testing\n</code></pre>"},{"location":"WAVE_SYSTEM/#future-improvements","title":"Future Improvements","text":"<ul> <li>[x] Support for powerups (health, shield, speed)</li> <li>[ ] More complex spawn patterns (circle, spiral)</li> <li>[ ] Scriptable events (music change, visual effects)</li> <li>[ ] Multiple trigger conditions (time AND distance)</li> <li>[ ] Support for spawn animations</li> <li>[ ] Visual wave editor</li> </ul>"},{"location":"contributing/","title":"Contributing to R-Type","text":"<p>Thank you for your interest in contributing to R-Type! This document provides guidelines and instructions for contributing to the project.</p>"},{"location":"contributing/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Getting Started</li> <li>Development Environment Setup</li> <li>Code Quality Tools</li> <li>Building the Project</li> <li>Code Style</li> <li>Submitting Changes</li> </ul>"},{"location":"contributing/#getting-started","title":"Getting Started","text":"<ol> <li>Fork the repository</li> <li>Clone your fork: <code>git clone https://github.com/YOUR_USERNAME/Mirror-R-Type.git</code></li> <li>Create a feature branch: <code>git checkout -b feature/your-feature-name</code></li> <li>Make your changes</li> <li>Test your changes</li> <li>Submit a pull request</li> </ol>"},{"location":"contributing/#development-environment-setup","title":"Development Environment Setup","text":""},{"location":"contributing/#prerequisites","title":"Prerequisites","text":"<ul> <li>C++ Compiler: GCC 10+ or Clang 12+ with C++20 support</li> <li>CMake: Version 3.20 or higher</li> <li>Git: For version control</li> </ul>"},{"location":"contributing/#required-development-tools","title":"Required Development Tools","text":""},{"location":"contributing/#clang-tidy-code-linter","title":"clang-tidy (Code Linter)","text":"<p>clang-tidy is used for static code analysis and enforcing code quality standards.</p> <p>Installation:</p> <p>Ubuntu/Debian: <pre><code>sudo apt-get update\nsudo apt-get install clang-tidy\n</code></pre></p> <p>Fedora/RedHat: <pre><code>sudo dnf install clang-tools-extra\n</code></pre></p> <p>macOS: <pre><code>brew install llvm\n</code></pre></p> <p>Windows: <pre><code># Using Chocolatey\nchoco install llvm\n\n# Or download from https://releases.llvm.org/\n</code></pre></p> <p>Verify Installation: <pre><code>clang-tidy --version\n</code></pre></p>"},{"location":"contributing/#code-quality-tools","title":"Code Quality Tools","text":""},{"location":"contributing/#running-clang-tidy","title":"Running clang-tidy","text":"<p>The project includes clang-tidy integration for code quality checks.</p>"},{"location":"contributing/#during-build-optional","title":"During Build (Optional)","text":"<p>To enable clang-tidy analysis during compilation:</p> <pre><code>cmake -DENABLE_CLANG_TIDY=ON -B build\ncmake --build build\n</code></pre> <p>Note: This is disabled by default to speed up regular builds.</p>"},{"location":"contributing/#manual-analysis","title":"Manual Analysis","text":"<p>To analyze specific files:</p> <pre><code># Single file\nclang-tidy path/to/file.cpp -- -std=c++20\n\n# All C++ files\nfind . -name '*.cpp' -o -name '*.hpp' | xargs clang-tidy -p build\n\n# With compile commands database\ncmake -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -B build\nclang-tidy -p build path/to/file.cpp\n</code></pre>"},{"location":"contributing/#auto-fix-issues","title":"Auto-fix Issues","text":"<p>To automatically apply suggested fixes:</p> <pre><code>clang-tidy -fix path/to/file.cpp -- -std=c++20\n</code></pre>"},{"location":"contributing/#configuration","title":"Configuration","text":"<p>The project's clang-tidy configuration is located in .clang-tidy at the repository root.</p> <p>For detailed linting documentation, see doc/LINTING.md.</p>"},{"location":"contributing/#building-the-project","title":"Building the Project","text":""},{"location":"contributing/#standard-build","title":"Standard Build","text":"<pre><code>cmake -S . -B build -DCMAKE_BUILD_TYPE=Release\ncmake --build build\n</code></pre>"},{"location":"contributing/#debug-build","title":"Debug Build","text":"<pre><code>cmake -S . -B build -DCMAKE_BUILD_TYPE=Debug\ncmake --build build\n</code></pre>"},{"location":"contributing/#build-options","title":"Build Options","text":"<ul> <li><code>BUILD_CLIENT</code>: Build client executable (default: ON)</li> <li><code>BUILD_SERVER</code>: Build server executable (default: ON)</li> <li><code>ENABLE_CLANG_TIDY</code>: Enable clang-tidy during build (default: OFF)</li> </ul> <p>Example: <pre><code>cmake -S . -B build -DBUILD_CLIENT=OFF -DBUILD_SERVER=ON\n</code></pre></p>"},{"location":"contributing/#code-style","title":"Code Style","text":""},{"location":"contributing/#naming-conventions","title":"Naming Conventions","text":"<ul> <li>Namespaces: <code>lower_case</code></li> <li>Classes/Structs: <code>CamelCase</code></li> <li>Functions: <code>camelBack</code></li> <li>Variables: <code>camelBack</code></li> <li>Private/Protected Members: suffix with <code>_</code></li> <li>Macros: <code>UPPER_CASE</code></li> <li>Enum Constants: <code>UPPER_CASE</code></li> </ul>"},{"location":"contributing/#example","title":"Example","text":"<pre><code>namespace game_engine {\n\nclass EntityManager {\npublic:\n    void addEntity(Entity* entity);\n    size_t getEntityCount() const;\n\nprivate:\n    std::vector&lt;Entity*&gt; entities_;\n    size_t maxEntities_;\n};\n\n} // namespace game_engine\n</code></pre>"},{"location":"contributing/#best-practices","title":"Best Practices","text":"<ul> <li>Use C++20 features when appropriate</li> <li>Prefer smart pointers over raw pointers</li> <li>Follow RAII principles</li> <li>Write self-documenting code</li> <li>Add comments only when necessary to explain \"why\", not \"what\"</li> <li>Keep functions small and focused</li> <li>Avoid magic numbers; use named constants</li> </ul>"},{"location":"contributing/#submitting-changes","title":"Submitting Changes","text":""},{"location":"contributing/#before-submitting","title":"Before Submitting","text":"<ol> <li>Build the project to ensure it compiles without errors</li> <li>Run clang-tidy on your changes to catch potential issues</li> <li>Test your changes thoroughly</li> <li>Write clear commit messages following the format:    <pre><code>type: brief description\n\nDetailed explanation of what changed and why.\n</code></pre></li> </ol> <p>Types: <code>feat</code>, <code>fix</code>, <code>refactor</code>, <code>docs</code>, <code>test</code>, <code>chore</code></p>"},{"location":"contributing/#pull-request-process","title":"Pull Request Process","text":"<ol> <li>Update documentation if you've changed APIs or added features</li> <li>Ensure CI passes: All GitHub Actions workflows must succeed</li> <li>Target the correct branch:</li> <li>Features and fixes: target <code>dev</code> branch</li> <li>Hotfixes: may target <code>main</code> branch (discuss with maintainers first)</li> <li>Request review from maintainers</li> <li>Address feedback promptly and professionally</li> </ol>"},{"location":"contributing/#cicd","title":"CI/CD","text":"<p>The project uses GitHub Actions for continuous integration:</p> <ul> <li>Build Job: Builds the project on Ubuntu and Windows</li> <li>Lint Job: Runs clang-tidy analysis (non-blocking, only on PRs to <code>main</code>)</li> </ul> <p>Pull requests to <code>main</code> will include clang-tidy analysis results as artifacts. While the linter is non-blocking, please address warnings when reasonable.</p>"},{"location":"contributing/#questions","title":"Questions?","text":"<p>If you have questions or need help, feel free to:</p> <ul> <li>Open an issue for bugs or feature requests</li> <li>Start a discussion for general questions</li> <li>Reach out to the maintainers</li> </ul> <p>Thank you for contributing to R-Type!</p>"},{"location":"create-room-archi/","title":"CreateRoom Module - Architecture Documentation","text":""},{"location":"create-room-archi/#modular-structure","title":"\ud83d\udcc1 Modular Structure","text":"<pre><code>createroom/\n\u251c\u2500\u2500 CreateRoomConfig.hpp              # Configuration &amp; constants\n\u251c\u2500\u2500 CreateRoomInput.hpp/cpp           # Input handling (circular clicks)\n\u251c\u2500\u2500 CreateRoomRenderer.hpp/cpp        # Low-level rendering (textures, shapes)\n\u251c\u2500\u2500 CreateRoomInitializer.hpp/cpp     # UI element initialization\n\u251c\u2500\u2500 CreateRoomUpdater.hpp/cpp         # Update logic\n\u2514\u2500\u2500 CreateRoomDrawer.hpp/cpp          # High-level drawing logic\n</code></pre>"},{"location":"create-room-archi/#module-responsibilities","title":"\ud83c\udfaf Module Responsibilities","text":""},{"location":"create-room-archi/#createroomconfighpp","title":"CreateRoomConfig.hpp","text":"<ul> <li>Role: Defines all layout and styling constants</li> <li>Content:</li> <li>Dimensions (sizes, spacing)</li> <li>Colors (background, borders, glow)</li> <li>Asset paths (textures)</li> <li>Usage: Imported by all other modules</li> </ul>"},{"location":"create-room-archi/#createroominputhppcpp","title":"CreateRoomInput.hpp/cpp","text":"<ul> <li>Role: Handles all user input logic</li> <li>Main Functions:</li> <li><code>handle_difficulty_click()</code> - Circular click detection for difficulties</li> <li><code>handle_gamemode_click()</code> - Circular click detection for game modes</li> <li><code>is_point_in_circle()</code> - Circular collision utility</li> <li>Dependencies: IInputPlugin, protocol::Payloads</li> </ul>"},{"location":"create-room-archi/#createroomrendererhppcpp","title":"CreateRoomRenderer.hpp/cpp","text":"<ul> <li>Role: Low-level rendering of graphical elements</li> <li>TexturePack Class:</li> <li>Loads and stores all textures</li> <li><code>load()</code> - Lazy texture loading</li> <li>Renderer Class:</li> <li><code>draw_background()</code> - Background with gradients</li> <li><code>draw_stepper()</code> - Step progress indicator</li> <li><code>draw_map_selection()</code> - Map preview rendering (rectangular)</li> <li><code>draw_difficulty_selection()</code> - Difficulty icon rendering (circular)</li> <li><code>draw_gamemode_selection()</code> - Game mode icon rendering (circular)</li> <li><code>draw_circular_image()</code> - Utility for drawing image + circular effects</li> <li>Dependencies: IGraphicsPlugin, protocol::Payloads</li> </ul>"},{"location":"create-room-archi/#createroominitializerhppcpp","title":"CreateRoomInitializer.hpp/cpp","text":"<ul> <li>Role: Initializes all UI elements for different steps</li> <li>Main Functions:</li> <li><code>init_room_info_step()</code> - Creates labels and text fields (room name, password)</li> <li><code>init_map_selection_step()</code> - Creates map selection buttons</li> <li><code>init_difficulty_step()</code> - No buttons (clickable circular images)</li> <li><code>init_game_mode_step()</code> - No buttons (clickable circular images)</li> <li><code>init_navigation_buttons()</code> - Creates Previous/Next/Create buttons</li> <li>Dependencies: UIButton, UILabel, UITextField</li> </ul>"},{"location":"create-room-archi/#createroomupdaterhppcpp","title":"CreateRoomUpdater.hpp/cpp","text":"<ul> <li>Role: Handles update logic for each step</li> <li>Main Functions:</li> <li><code>update_room_info_step()</code> - Updates text fields</li> <li><code>update_map_selection_step()</code> - Updates map buttons (selection)</li> <li><code>update_difficulty_step()</code> - Delegates to InputHandler for circular clicks</li> <li><code>update_game_mode_step()</code> - Delegates to InputHandler for circular clicks</li> <li><code>update_navigation_buttons()</code> - Updates navigation buttons</li> <li><code>is_any_field_focused()</code> - Utility to check text field focus</li> <li>Dependencies: IGraphicsPlugin, IInputPlugin, CreateRoomInput</li> </ul>"},{"location":"create-room-archi/#createroomdrawerhppcpp","title":"CreateRoomDrawer.hpp/cpp","text":"<ul> <li>Role: Orchestrates rendering for each step (high level)</li> <li>Main Functions:</li> <li><code>draw_room_info_step()</code> - Draws labels + text fields</li> <li><code>draw_map_selection_step()</code> - Draws map images + buttons (via Renderer)</li> <li><code>draw_difficulty_step()</code> - Draws circular difficulty images (via Renderer)</li> <li><code>draw_game_mode_step()</code> - Draws circular game mode images (via Renderer)</li> <li><code>draw_navigation_buttons()</code> - Draws buttons with dynamic text</li> <li>Dependencies: Renderer, UIButton, UILabel, UITextField</li> </ul>"},{"location":"create-room-archi/#data-flow","title":"\ud83d\udd04 Data Flow","text":""},{"location":"create-room-archi/#initialization","title":"Initialization","text":"<pre><code>CreateRoomScreen::initialize()\n  \u2514\u2500&gt; Initializer::init_room_info_step()\n  \u2514\u2500&gt; Initializer::init_map_selection_step()\n  \u2514\u2500&gt; Initializer::init_difficulty_step()\n  \u2514\u2500&gt; Initializer::init_game_mode_step()\n  \u2514\u2500&gt; Initializer::init_navigation_buttons()\n</code></pre>"},{"location":"create-room-archi/#update","title":"Update","text":"<pre><code>CreateRoomScreen::update()\n  \u2514\u2500&gt; Updater::is_any_field_focused()\n  \u2514\u2500&gt; Updater::update_*_step()\n      \u2514\u2500&gt; InputHandler::handle_*_click() (for difficulty &amp; gamemode)\n  \u2514\u2500&gt; Updater::update_navigation_buttons()\n</code></pre>"},{"location":"create-room-archi/#draw","title":"Draw","text":"<pre><code>CreateRoomScreen::draw()\n  \u2514\u2500&gt; TexturePack::load() (lazy loading)\n  \u2514\u2500&gt; Renderer::draw_background()\n  \u2514\u2500&gt; Renderer::draw_stepper()\n  \u2514\u2500&gt; Drawer::draw_*_step()\n      \u2514\u2500&gt; Renderer::draw_*_selection() (for maps, difficulty, gamemode)\n  \u2514\u2500&gt; Drawer::draw_navigation_buttons()\n</code></pre>"},{"location":"create-room-archi/#architecture-benefits","title":"\u2728 Architecture Benefits","text":"<ol> <li>Separation of Concerns: Each module has a unique and well-defined role</li> <li>Reusability: Renderers can be reused in other screens</li> <li>Testability: Each module can be tested independently</li> <li>Maintainability: Changes are localized to specific files</li> <li>Readability: Short and focused code (&lt; 150 lines per file)</li> <li>Extensibility: Easy to add new steps or features</li> </ol>"},{"location":"create-room-archi/#comparison","title":"\ud83d\udcca Comparison","text":""},{"location":"create-room-archi/#before-monolithic","title":"Before (monolithic)","text":"<ul> <li>1 file: CreateRoomScreen.cpp (620+ lines)</li> <li>Everything mixed: init, update, draw, rendering</li> <li>Difficult to navigate and maintain</li> </ul>"},{"location":"create-room-archi/#after-modular","title":"After (modular)","text":"<ul> <li>7 files well organized</li> <li>CreateRoomScreen.cpp: 275 lines (56% reduction!)</li> <li>Each module: 50-150 lines</li> <li>Clear, focused, easy-to-maintain code</li> </ul>"},{"location":"create-room-archi/#how-to-extend","title":"\ud83d\ude80 How to Extend","text":""},{"location":"create-room-archi/#adding-a-new-step","title":"Adding a new step","text":"<ol> <li>Add enum in <code>CreateRoomScreen.hpp</code></li> <li>Create <code>init_new_step()</code> in <code>Initializer</code></li> <li>Create <code>update_new_step()</code> in <code>Updater</code></li> <li>Create <code>draw_new_step()</code> in <code>Drawer</code></li> <li>Update switch cases in <code>CreateRoomScreen.cpp</code></li> </ol>"},{"location":"create-room-archi/#adding-a-new-ui-element","title":"Adding a new UI element","text":"<ol> <li>Add constants in <code>Config.hpp</code></li> <li>Modify <code>Initializer</code> to create the element</li> <li>Modify <code>Updater</code> for update logic</li> <li>Modify <code>Drawer</code> for rendering</li> </ol>"}]}