R-Type Development Team                                    January 2026


                    R-Type Game Protocol Specification

Status of This Memo

   This document specifies the R-Type Game Protocol (RTGP) for the
   Internet community. Distribution of this memo is unlimited.

Abstract

   This document defines the R-Type Game Protocol (RTGP), a UDP-based
   binary protocol designed for client-server communication in the
   R-Type multiplayer game. The protocol provides real-time gameplay
   synchronization, lobby management, and matchmaking capabilities for
   cooperative multiplayer sessions.

Table of Contents

   1. Introduction ................................................. 3
      1.1 Purpose .................................................. 3
      1.2 Scope .................................................... 3
      1.3 Requirements Language .................................... 3
   2. Protocol Overview ............................................ 4
      2.1 Transport Layer .......................................... 4
      2.2 Packet Structure ......................................... 4
      2.3 Size Constraints ......................................... 5
   3. Packet Header ................................................ 5
      3.1 Header Format ............................................ 5
      3.2 Field Definitions ........................................ 6
   4. Packet Types ................................................. 7
      4.1 Type ID Allocation ....................................... 7
      4.2 Client-to-Server Packets ................................. 8
      4.3 Server-to-Client Packets ................................. 9
   5. Payload Formats .............................................. 11
      5.1 Connection Management Payloads ........................... 11
      5.2 Lobby & Matchmaking Payloads ............................. 16
      5.3 Custom Room Management Payloads .......................... 21
      5.4 Player Input Payloads .................................... 28
      5.5 World State Payloads ..................................... 29
      5.6 Entity Event Payloads .................................... 32
      5.7 Game Mechanics Payloads .................................. 35
      5.8 Admin System Payloads .................................... 38
   6. Entity Types ................................................. 40
   7. Implementation Notes ......................................... 41
      7.1 Byte Order & Packing ..................................... 41
      7.2 Lag Compensation ......................................... 41
      7.3 Security ................................................. 41

1. Introduction

1.1 Purpose

   This document specifies the R-Type Game Protocol (RTGP), a UDP-based
   binary protocol for client-server communication in the R-Type
   multiplayer game. The protocol enables real-time gameplay
   synchronization, lobby management, and matchmaking for cooperative
   multiplayer sessions.

1.2 Scope

   This protocol defines packet formats, message types, and
   communication patterns for:

   - Client authentication and connection management
   - Lobby system with game mode and difficulty selection
   - Custom room management with password protection
   - Matchmaking and game session initialization
   - Player input transmission
   - Game state synchronization
   - Entity management (players, enemies, projectiles, power-ups)
   - Game events and scoring

1.3 Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119.

2. Protocol Overview

2.1 Transport Layer

   RTGP operates over UDP (User Datagram Protocol). The default server
   port is 4242 (configurable).
   Some control messages (like lobby management) may be exchanged over
   TCP in specific implementations, but the core gameplay loop typically
   relies on UDP.

2.2 Packet Structure

   All packets consist of a variable-size header followed by a variable-
   length payload:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |    Version    |     Type      |     Flags     | Payload Len   |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  Payload Len  |                Sequence Number                |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Seq Number    | Uncompressed Size (optional, if COMPRESSED)   |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |Uncompressed.. |              Payload Data                     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                         Payload Data                          |
      |                             ...                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

2.3 Size Constraints

   - Maximum packet size: 1400 bytes (MTU-safe for typical network
     configurations)
   - Base header size: 9 bytes (without compression metadata)
   - Extended header size: 13 bytes (with compression metadata when
     COMPRESSED flag is set)
   - Maximum payload size: 1387 bytes (accounting for largest possible
     header)
   - Packets exceeding 1400 bytes MUST be fragmented or redesigned

2.4 Compression

   Starting from protocol version 1.0, packets support optional LZ4
   compression for large payloads:

   - Compression library: LZ4 (fast compression algorithm)
   - Automatic compression: Large packets are automatically compressed
     if beneficial
   - Compressible packet types: SNAPSHOT, DELTA_SNAPSHOT, LOBBY_STATE,
     ROOM_LIST

3. Packet Header

3.1 Header Format

   All packets begin with a header in network byte order (big-endian).
   The header size is 9 bytes (base) or 13 bytes (if COMPRESSED flag
   is set).

   Base Header (9 bytes):

   Field            | Size    | Offset | Description
   -----------------|---------|--------|---------------------------
   Version          | 1 byte  | 0      | Protocol version (0x01)
   Type             | 1 byte  | 1      | Packet type identifier
   Flags            | 1 byte  | 2      | Packet flags (bit 0=COMPRESSED)
   Payload Length   | 2 bytes | 3      | Length of payload in bytes
   Sequence Number  | 4 bytes | 5      | Monotonic sequence number

   Extended Header (+ 4 bytes if COMPRESSED flag set):

   Field              | Size    | Offset | Description
   -------------------|---------|--------|---------------------------
   Uncompressed Size  | 4 bytes | 9      | Original payload size

3.2 Field Definitions

   Version (8 bits)
      - MUST be set to 0x01 for this version of the protocol

   Type (8 bits)
      - Identifies the packet type (see Section 4)

   Flags (8 bits)
      - Bitfield for packet metadata and options
      - Bit 0 (0x01): COMPRESSED - Payload is compressed with LZ4

   Payload Length (16 bits, big-endian)
      - Length of the payload in bytes (compressed size if compressed)

   Uncompressed Size (32 bits, big-endian) - Optional
      - ONLY present if COMPRESSED flag (bit 0) is set

   Sequence Number (32 bits, big-endian)
      - Monotonically increasing counter per connection

4. Packet Types

4.1 Type ID Allocation

   Range       | Category                  | Description
   ------------|---------------------------|-------------------------
   0x01-0x04   | Connection Management     | Connect, disconnect
   0x05-0x09   | Lobby & Matchmaking       | Join, leave, updates
   0x10-0x1F   | Player Input              | Real-time input commands
   0x20-0x29   | Room Management           | Custom rooms, host ctrl
   0x30-0x3F   | Admin Commands (C->S)     | Admin authentication
   0x81-0x8A   | Connection & Lobby (S->C) | Accept, reject, updates
   0x90-0x9F   | Room Management (S->C)    | Room created, list
   0xA0-0xAF   | World State               | Game snapshots, delta
   0xB0-0xBF   | Entity Events             | Spawn, destroy, damage
   0xC0-0xCF   | Game Mechanics            | Powerups, scoring, waves
   0xD0-0xDF   | Admin Responses (S->C)    | Admin results, notify
   0xF0-0xFF   | Reserved                  | System & Chat

4.2 Client-to-Server Packets

   Type ID | Name                      | Description
   --------|---------------------------|--------------------------------
   0x01    | CLIENT_CONNECT            | Initial connection request
   0x02    | CLIENT_DISCONNECT         | Graceful disconnection
   0x04    | CLIENT_PING               | Keepalive and latency measure
   0x05    | CLIENT_JOIN_LOBBY         | Join lobby with mode/diff
   0x06    | CLIENT_LEAVE_LOBBY        | Leave current lobby
   0x08    | CLIENT_UDP_HANDSHAKE      | Associate UDP with TCP
   0x10    | CLIENT_INPUT              | Player input state
   0x20    | CLIENT_CREATE_ROOM        | Create a custom game room
   0x21    | CLIENT_JOIN_ROOM          | Join an existing custom room
   0x22    | CLIENT_LEAVE_ROOM         | Leave current custom room
   0x23    | CLIENT_REQUEST_ROOM_LIST  | Request list of rooms
   0x24    | CLIENT_START_GAME         | Start game (host only)
   0x25    | CLIENT_SET_PLAYER_NAME    | Change player name in lobby
   0x26    | CLIENT_SET_PLAYER_SKIN    | Change player skin in lobby
   0x27    | CLIENT_REQUEST_GLOBAL_LEADERBOARD | Request all-time top scores
   0x30    | CLIENT_ADMIN_AUTH         | Admin authentication request
   0x31    | CLIENT_ADMIN_COMMAND      | Admin command execution

4.3 Server-to-Client Packets

   Type ID | Name                         | Description
   --------|------------------------------|---------------------------
   0x81    | SERVER_ACCEPT                | Connection accepted
   0x82    | SERVER_REJECT                | Connection rejected
   0x83    | SERVER_PLAYER_JOINED         | Another player joined
   0x84    | SERVER_PLAYER_LEFT           | A player disconnected
   0x85    | SERVER_PONG                  | Ping response
   0x87    | SERVER_LOBBY_STATE           | Current lobby state update
   0x88    | SERVER_GAME_START_COUNTDOWN  | Game starting countdown
   0x89    | SERVER_COUNTDOWN_CANCELLED   | Countdown cancelled
   0x8A    | SERVER_GAME_START            | Game session begins
   0x90    | SERVER_ROOM_CREATED          | Custom room created
   0x91    | SERVER_ROOM_LIST             | List of available rooms
   0x92    | SERVER_ROOM_JOINED           | Successfully joined a room
   0x93    | SERVER_ROOM_LEFT             | Player left a custom room
   0x94    | SERVER_ROOM_STATE_UPDATE     | Custom room state changed
   0x95    | SERVER_ROOM_ERROR            | Room operation error
   0x96    | SERVER_PLAYER_NAME_UPDATED   | Player name changed in room
   0x97    | SERVER_PLAYER_SKIN_UPDATED   | Player skin changed in room
   0xA0    | SERVER_SNAPSHOT              | Complete world state snap
   0xA1    | SERVER_DELTA_SNAPSHOT        | Delta-compressed state
   0xB0    | SERVER_ENTITY_SPAWN          | New entity spawned
   0xB1    | SERVER_ENTITY_DESTROY        | Entity destroyed
   0xB2    | SERVER_ENTITY_DAMAGE         | Entity took damage
   0xB3    | SERVER_PROJECTILE_SPAWN      | Projectile fired
   0xB4    | SERVER_EXPLOSION_EVENT       | Visual explosion effect
   0xC0    | SERVER_POWERUP_COLLECTED     | Power-up collected
   0xC1    | SERVER_SCORE_UPDATE          | Player score updated
   0xC2    | SERVER_WAVE_START            | New enemy wave starting
   0xC3    | SERVER_WAVE_COMPLETE         | Wave completed
   0xC4    | SERVER_PLAYER_LEVEL_UP       | Player leveled up
   0xC5    | SERVER_PLAYER_RESPAWN        | Player respawned
   0xC6    | SERVER_GAME_OVER             | Game session ended
   0xC7    | SERVER_LEADERBOARD           | End-game leaderboard
   0xC8    | SERVER_GLOBAL_LEADERBOARD    | All-time global top scores
   0xC9    | SERVER_LEVEL_TRANSITION      | Transition to next game level
   0xCA    | SERVER_LEVEL_READY           | Level loaded, ready for gameplay
   0xD0    | SERVER_ADMIN_AUTH_RESULT     | Admin authentication result
   0xD1    | SERVER_ADMIN_COMMAND_RESULT  | Admin command execution result
   0xD2    | SERVER_ADMIN_NOTIFICATION    | Server-wide admin notification
   0xD3    | SERVER_KICK_NOTIFICATION     | Player kicked by admin

5. Payload Formats

   All multi-byte integer fields are in network byte order (big-endian)
   unless otherwise specified. Floating-point values use IEEE 754
   single precision (32-bit) format.

5.1 Connection Management Payloads

5.1.1 CLIENT_CONNECT (0x01)
   Size: 33 bytes
   - Client Version (1 byte)
   - Player Name (32 bytes, null-padded)

5.1.2 CLIENT_DISCONNECT (0x02)
   Size: 5 bytes
   - Player ID (4 bytes)
   - Reason (1 byte)

5.1.3 CLIENT_PING (0x04)
   Size: 8 bytes
   - Player ID (4 bytes)
   - Client Timestamp (4 bytes)

5.1.4 SERVER_ACCEPT (0x81)
   Size: 8 bytes
   - Assigned Player ID (4 bytes)
   - Server Tick Rate (1 byte)
   - Max Players (1 byte)
   - Map ID (2 bytes)

5.1.5 SERVER_REJECT (0x82)
   Size: 65 bytes
   - Reason Code (1 byte)
   - Reason Message (64 bytes)

5.1.6 CLIENT_UDP_HANDSHAKE (0x08)
   Size: 8 bytes
   - Player ID (4 bytes)
   - Session ID (4 bytes)

5.2 Lobby & Matchmaking Payloads

5.2.1 CLIENT_JOIN_LOBBY (0x05)
   Size: 6 bytes
   - Player ID (4 bytes)
   - Game Mode (1 byte)
   - Difficulty (1 byte)

5.2.2 SERVER_GAME_START (0x8A)
   Size: 22 bytes (Base) + (12 * Player Count)
   - Game Session ID (4 bytes)
   - Game Mode (1 byte)
   - Difficulty (1 byte)
   - Server Tick (4 bytes)
   - Level Seed (4 bytes)
   - UDP Port (2 bytes)
   - Map ID (2 bytes)
   - Scroll Speed (4 bytes, float)
   - Player Spawns (Variable array of PlayerSpawnData)

5.3 Custom Room Management Payloads

5.3.1 CLIENT_CREATE_ROOM (0x20)
   Size: 105 bytes
   - Player ID (4 bytes)
   - Room Name (32 bytes)
   - Password Hash (64 bytes)
   - Game Mode (1 byte)
   - Difficulty (1 byte)
   - Map ID (2 bytes)
   - Max Players (1 byte)

5.4 Player Input Payloads

5.4.1 CLIENT_INPUT (0x10)
   Size: 14 bytes
   - Player ID (4 bytes)
   - Input Flags (2 bytes)
   - Client Tick (4 bytes)
   - Sequence Number (4 bytes)

5.5 World State Payloads

5.5.1 SERVER_SNAPSHOT (0xA0)
   Size: 10 bytes (Base) + (25 * Entity Count)
   - Server Tick (4 bytes)
   - Entity Count (2 bytes)
   - Scroll X (4 bytes, float)
   - Entity States (Variable array of EntityState)

   Entity State Format (25 bytes):
   - Entity ID (4 bytes)
   - Entity Type (1 byte)
   - Position X (4 bytes, float)
   - Position Y (4 bytes, float)
   - Velocity X (2 bytes, int16 scaled 100)
   - Velocity Y (2 bytes, int16 scaled 100)
   - Health (2 bytes)
   - Flags (2 bytes)
   - Last Ack Sequence (4 bytes)

5.5.2 SERVER_EXPLOSION_EVENT (0xB4)
   Size: 16 bytes
   - Source Entity ID (4 bytes)
   - Position X (4 bytes, float)
   - Position Y (4 bytes, float)
   - Effect Scale (4 bytes, float)

5.6 Game Mechanics Payloads

5.6.1 SERVER_LEVEL_TRANSITION (0xC9)
   Size: 2 bytes
   - Next Level ID (2 bytes)

5.6.2 SERVER_LEVEL_READY (0xCA)
   Size: 2 bytes
   - Level ID (2 bytes)

5.6.3 SERVER_GLOBAL_LEADERBOARD (0xC8)
   Size: 1 byte (Base) + (40 * Entry Count)
   - Entry Count (1 byte)
   - Entries (Variable array of GlobalLeaderboardEntry)

   Global Leaderboard Entry (40 bytes):
   - Player Name (32 bytes)
   - Score (4 bytes)
   - Timestamp (4 bytes)

5.7 Admin System Payloads

5.7.1 CLIENT_ADMIN_AUTH (0x30)
   Size: 96 bytes
   - Client ID (4 bytes)
   - Password Hash (64 bytes)
   - Username (28 bytes)

5.7.2 CLIENT_ADMIN_COMMAND (0x31)
   Size: 140 bytes
   - Admin ID (4 bytes)
   - Command Length (1 byte)
   - Command String (135 bytes)

5.7.3 SERVER_ADMIN_AUTH_RESULT (0xD0)
   Size: 69 bytes
   - Success (1 byte)
   - Admin Level (4 bytes)
   - Failure Reason (64 bytes)

5.7.4 SERVER_ADMIN_COMMAND_RESULT (0xD1)
   Size: 257 bytes
   - Success (1 byte)
   - Message (256 bytes)

5.7.5 SERVER_ADMIN_NOTIFICATION (0xD2)
   Size: 128 bytes
   - Type (1 byte)
   - Message (127 bytes)

5.7.6 SERVER_KICK_NOTIFICATION (0xD3)
   Size: 128 bytes
   - Reason (128 bytes)

6. Entity Types

   Code | Type              | Description
   -----|-------------------|----------------------
   0x01 | PLAYER            | Player ship
   0x02 | ENEMY_BASIC       | Standard enemy
   0x03 | ENEMY_ELITE       | Stronger enemy
   0x04 | ENEMY_BOSS        | Boss enemy
   0x05 | PROJECTILE_PLAYER | Player shots
   0x06 | PROJECTILE_ENEMY  | Enemy shots
   0x07 | POWERUP_WEAPON    | Weapon upgrade
   0x08 | POWERUP_SHIELD    | Shield bonus
   0x09 | POWERUP_SCORE     | Score bonus
   0x0A | ENEMY_FAST        | Fast enemy
   0x0B | ENEMY_TANK        | Tank enemy
   0x0C | POWERUP_HEALTH    | Health pack
   0x0D | POWERUP_SPEED     | Speed boost
   0x0E | WALL              | Environment/Obstacle

7. Implementation Notes

7.1 Byte Order & Packing
   - Network Byte Order (Big-Endian) is used for multi-byte integers.
   - All structures are packed to prevent padding.

7.2 Lag Compensation
   - CLIENT_INPUT includes a Sequence Number.
   - SERVER_SNAPSHOT Entity States include Last Ack Sequence.
   - Clients use these for reconciliation/prediction.

7.3 Security
   - Admin passwords are hashed (SHA-256) before transmission.
   - UDP Handshake uses Session IDs to prevent spoofing.

End of Protocol Specification